<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modules.data_module.slans_data &mdash; CavityHub 0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> CavityHub
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">CavityDesignHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CavityHub</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">modules.data_module.slans_data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modules.data_module.slans_data</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">utils.file_reader</span> <span class="kn">import</span> <span class="n">FileReader</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">fr</span> <span class="o">=</span> <span class="n">FileReader</span><span class="p">()</span>


<div class="viewcode-block" id="SLANSData"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData">[docs]</a><span class="k">class</span> <span class="nc">SLANSData</span><span class="p">:</span>
    <span class="c1">##### COMPLETE CODE</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirc</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="n">bc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">dirc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fid</span> <span class="o">=</span> <span class="n">fid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">dirc</span>
        <span class="c1"># print(self.path)</span>

<div class="viewcode-block" id="SLANSData.get_0D_plot_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_0D_plot_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_0D_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;\t\tSTARTED WITH GETTING 0D PLOT DATA&quot;)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="si">}</span><span class="s1">\cavity_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="si">}</span><span class="s1">.svl&#39;</span>
        <span class="c1"># print(filename)</span>

        <span class="n">data_dict</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">svl_reader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">data_dict</span></div>

<div class="viewcode-block" id="SLANSData.get_1D_plot_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_1D_plot_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_1D_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;\t\tSTARTED WITH GETTING 1D PLOT DATA&quot;)</span>
        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># SET MODE COUNT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>

        <span class="c1"># print(self.mode_count)</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;Axis Fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_field_data</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;Surface Fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_surface_field_data</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># print(&quot;\t\tDONE WITH GETTING 1D PLOT DATA&quot;)</span>
        <span class="k">return</span> <span class="n">data_dict</span></div>

<div class="viewcode-block" id="SLANSData.get_1D_plot_title"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_1D_plot_title">[docs]</a>    <span class="k">def</span> <span class="nf">get_1D_plot_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SLANSData.get_2D_plot_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_2D_plot_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_2D_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">STARTED WITH GETTING 2D PLOT DATA&quot;</span><span class="p">)</span>
        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># SET MODE COUNT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_count</span><span class="p">)</span>
        <span class="c1"># FOR NOW, ONLY ONE MODE RESULT IS EXTRACTABLE, CHANGE LATER</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">fields_on_plane_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">Ez</span><span class="p">,</span> <span class="n">Er</span><span class="p">,</span> <span class="n">Emag</span><span class="p">,</span> <span class="n">Hi</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">/Cavity</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="si">}</span><span class="s2">/cavity_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="si">}</span><span class="s2">.pam&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">/Cavity</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="si">}</span><span class="s2">/cavity_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="si">}</span><span class="s2">.pam&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># print(f.read())</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># print([float(x) for x in l.strip().split(&#39; &#39;) if x !=&#39;&#39;])</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

                    <span class="n">Ez</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">Er</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">Emag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="c1">#### line 2 has just three entries</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">Hi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Hi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

            <span class="c1">#### GET R AND Z LIMITS AND INTERVALS</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Getting r and z&quot;</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">Er</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">Er</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nZ</span> <span class="o">=</span> <span class="n">Emag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nR</span> <span class="o">=</span> <span class="n">Emag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ez</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">Er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Er</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">Emag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Emag</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">Hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Hi</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="c1"># print(Ez)</span>

            <span class="c1">#### CREATE MESH GRID</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Crete mesh grid&quot;</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nR</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nZ</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Rmsh</span><span class="p">,</span> <span class="n">Zmsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

            <span class="c1">#### DIRECTION GRID AND DATA</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Direction Grid node_editor&quot;</span><span class="p">)</span>
            <span class="n">Er_mat</span> <span class="o">=</span> <span class="n">Er</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
            <span class="n">Ez_mat</span> <span class="o">=</span> <span class="n">Ez</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
            <span class="n">Emag_mat</span> <span class="o">=</span> <span class="n">Emag</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
            <span class="n">Hi_mat</span> <span class="o">=</span> <span class="n">Hi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>

            <span class="c1">### MASKING</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Masking&quot;</span><span class="p">)</span>
            <span class="n">Emag_mat_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Emag_mat</span><span class="p">)</span>

            <span class="c1"># mask values below a certain threshold</span>
            <span class="n">Ez_mat_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">Emag_mat_masked</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ez_mat</span><span class="p">)</span>
            <span class="n">Er_mat_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">Emag_mat_masked</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Er_mat</span><span class="p">)</span>
            <span class="n">Emag_mat_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">Emag_mat_masked</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Emag_mat</span><span class="p">)</span>
            <span class="n">Hi_mat_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">Emag_mat_masked</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Hi_mat</span><span class="p">)</span>

            <span class="n">Ez_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">Rmsh</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">Zmsh</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">:</span> <span class="n">Ez_mat_masked</span><span class="p">}</span>
            <span class="n">Er_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">Rmsh</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">Zmsh</span><span class="p">,</span> <span class="s2">&quot;Er&quot;</span><span class="p">:</span> <span class="n">Er_mat_masked</span><span class="p">}</span>
            <span class="n">Emag_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">Rmsh</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">Zmsh</span><span class="p">,</span> <span class="s2">&quot;Emag&quot;</span><span class="p">:</span> <span class="n">Emag_mat_masked</span><span class="p">}</span>
            <span class="n">Hi_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">Rmsh</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">Zmsh</span><span class="p">,</span> <span class="s2">&quot;Hi&quot;</span><span class="p">:</span> <span class="n">Hi_mat_masked</span><span class="p">}</span>

            <span class="n">fields_on_plane_data</span><span class="p">[</span><span class="s1">&#39;Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ez_dict</span>
            <span class="n">fields_on_plane_data</span><span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Er_dict</span>
            <span class="n">fields_on_plane_data</span><span class="p">[</span><span class="s1">&#39;Emag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Emag_dict</span>
            <span class="n">fields_on_plane_data</span><span class="p">[</span><span class="s1">&#39;Hi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hi_dict</span>

            <span class="n">data_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields_on_plane_data</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">DONE WITH GETTING 2D PLOT DATA&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_dict</span></div>
        <span class="c1"># plt.set_cmap(&quot;jet&quot;)</span>
        <span class="c1"># plt.contourf(Rmsh, Zmsh, Emag_mat_masked)</span>
        <span class="c1"># plt.quiver(Rmsh, Zmsh, Ez_mat, Er_mat, Emag_mat_masked, scale_units=&#39;width&#39;, scale=5)</span>
        <span class="c1"># plt.show()</span>

<div class="viewcode-block" id="SLANSData.get_2D_plot_title"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_2D_plot_title">[docs]</a>    <span class="k">def</span> <span class="nf">get_2D_plot_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SLANSData.process_line"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.process_line">[docs]</a>    <span class="k">def</span> <span class="nf">process_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="SLANSData.get_surface_field_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_surface_field_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_surface_field_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="c1"># SURFACE FIELDS</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">surface_field_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">\Cavity</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="si">}</span><span class="s2">\cavity_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">.sf&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll</span><span class="p">)))</span>

        <span class="n">surface_field_dict</span><span class="p">[</span><span class="s1">&#39;Es&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

        <span class="k">return</span> <span class="n">surface_field_dict</span></div>

<div class="viewcode-block" id="SLANSData.get_axis_field_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_axis_field_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_axis_field_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="n">axis_field_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">\Cavity</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fid</span><span class="si">}</span><span class="s2">\cavity_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">.af&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># get avg x</span>
        <span class="c1"># avg_x = sum(x) / len(x)</span>
        <span class="c1"># x_shift = [t - avg_x for t in x]</span>

        <span class="n">y_abs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>

        <span class="c1"># RETURN ABSOLUTE FIELD VALUE</span>
        <span class="n">axis_field_data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">axis_field_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">axis_field_data</span><span class="p">[</span><span class="s1">&#39;y_abs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_abs</span>
        <span class="k">return</span> <span class="n">axis_field_data</span></div>
        <span class="c1"># y_norm = [abs(t) / max(y_abs) for t in y_abs]</span>

        <span class="c1"># ax.plot(x_shift, y_abs)</span>

<div class="viewcode-block" id="SLANSData.normal_interp"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.normal_interp">[docs]</a>    <span class="k">def</span> <span class="nf">normal_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">):</span>
        <span class="n">rbf</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">Rbf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">rbf</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ai</span></div>

<div class="viewcode-block" id="SLANSData.get_mode_count"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSData.get_mode_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_mode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_count</span></div></div>


<div class="viewcode-block" id="SLANSDataExtraction"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSDataExtraction">[docs]</a><span class="k">class</span> <span class="nc">SLANSDataExtraction</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="SLANSDataExtraction.multiple_folders_data"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSDataExtraction.multiple_folders_data">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_folders_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_space</span><span class="p">,</span> <span class="n">slans_data_dir</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">save_excel</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="s2">&quot;Yes&quot;</span>

        <span class="k">def</span> <span class="nf">button_clicked</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;File Exist&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Hey Chief, seems you&#39;ve already processed the data for this folder. Do you want to overwrite it?&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>

            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">button_clicked</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">msg</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">msg</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;No&#39;</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">shape_space</span>

            <span class="c1"># data arrays initialization</span>
            <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># data arrays initialization</span>
            <span class="n">Freq_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">E_stored_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Rsh_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Q_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Epk_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Hpk_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Rsh_Q_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Epk_Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Bpk_Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kcc_arr</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">append_geom_parameters</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">Ri</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">Req</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">get_0D_plot_data</span><span class="p">():</span>

                <span class="c1"># directory_list = [os.path.join(slans_data_dir, name) for name in os.listdir(slans_data_dir) if</span>
                <span class="c1">#                   os.path.isdir(os.path.join(slans_data_dir, name))]</span>
                <span class="c1"># print(directory_list)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># if os.path.exists(f&quot;{dir_}\geometric_parameters.json&quot;):</span>
                    <span class="c1">#     with open(f&quot;{dir_}\geometric_parameters.json&quot;, &#39;r&#39;) as f:</span>
                    <span class="c1">#         d = json.load(f)</span>
                    <span class="c1"># else:</span>
                    <span class="c1">#     continue</span>
                    <span class="c1"># key = dir_[dir_.index(&quot;Cavity&quot;):]</span>
                    <span class="n">slans_data</span> <span class="o">=</span> <span class="n">SLANSData</span><span class="p">(</span><span class="n">slans_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">d_0d</span> <span class="o">=</span> <span class="n">slans_data</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>

                        <span class="n">Freq</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">E_stored</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;STORED ENERGY&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">Rsh</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;SHUNT IMPEDANCE&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MOhm</span>
                        <span class="n">Q</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;QUALITY FACTOR&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">Epk</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM ELEC. FIELD&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
                        <span class="n">Hpk</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM MAG. FIELD&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># A/m</span>
                        <span class="c1"># Vacc = d_0d[&#39;ACCELERATION&#39;][mode-1]</span>
                        <span class="n">Eavg</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;AVERAGE E.FIELD ON AXIS&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
                        <span class="n">Rsh_Q</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;EFFECTIVE IMPEDANCE&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Ohm</span>
                        <span class="c1"># Epk_Eacc = d_0d[&#39;KM (Emax/Accel.rate)&#39;][mode-1]  #</span>
                        <span class="c1"># Bpk_Eacc = d_0d[&#39;KH (Hmax*Z0/Accel.rate)&#39;][mode-1]  # mT/(MV/m)</span>

                        <span class="n">L</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;IC&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># normalize to length of cell</span>
                        <span class="n">Vacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Rsh_Q</span> <span class="o">*</span> <span class="n">E_stored</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Freq</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># factor of 2, remember circuit and accelerator definition</span>
                        <span class="c1"># Eacc = Vacc / (374 * 1e-3)  # factor of 2, remember circuit and accelerator definition</span>
                        <span class="c1"># Eacc = Vacc / (374 * 1e-3)  # for 1 cell factor of 2, remember circuit and accelerator definition</span>
                        <span class="n">Eacc</span> <span class="o">=</span> <span class="n">Vacc</span> <span class="o">/</span> <span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># for 1 cell factor of 2, remember circuit and accelerator definition</span>
                        <span class="n">Epk_Eacc</span> <span class="o">=</span> <span class="n">Epk</span> <span class="o">/</span> <span class="n">Eacc</span>
                        <span class="n">Bpk_Eacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Hpk</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="n">Eacc</span>

                        <span class="n">Freq_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Freq</span><span class="p">)</span>
                        <span class="n">E_stored_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_stored</span><span class="p">)</span>
                        <span class="n">Rsh_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Rsh</span><span class="p">)</span>  <span class="c1"># corrected to accelerator definition</span>
                        <span class="n">Q_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
                        <span class="n">Epk_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Epk</span><span class="p">)</span>
                        <span class="n">Hpk_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Hpk</span><span class="p">)</span>
                        <span class="n">Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Eacc</span><span class="p">)</span>
                        <span class="n">Epk_Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Epk_Eacc</span><span class="p">)</span>
                        <span class="n">Bpk_Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bpk_Eacc</span><span class="p">)</span>
                        <span class="n">Rsh_Q_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Rsh_Q</span><span class="p">)</span>  <span class="c1"># corrected to accelerator definition</span>

                        <span class="n">f_0</span><span class="p">,</span> <span class="n">f_pi</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">kcc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_pi</span> <span class="o">-</span> <span class="n">f_0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_pi</span> <span class="o">+</span> <span class="n">f_0</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                            <span class="n">kcc</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">kcc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kcc</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="n">append_geom_parameters</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;IC&quot;</span><span class="p">])</span>
                        <span class="n">key_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="k">pass</span>

            <span class="c1"># sheets = [&#39;Sheet1&#39;, &#39;Sheet2&#39;]</span>
            <span class="k">def</span> <span class="nf">get_1D_plot_data</span><span class="p">():</span>
                <span class="n">new_save</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                    <span class="n">slans_data</span> <span class="o">=</span> <span class="n">SLANSData</span><span class="p">(</span><span class="n">slans_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
                    <span class="n">d_1d</span> <span class="o">=</span> <span class="n">slans_data</span><span class="o">.</span><span class="n">get_1D_plot_data</span><span class="p">()</span>

                    <span class="n">dd</span> <span class="o">=</span> <span class="n">d_1d</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="c1"># print(sheets)</span>

                    <span class="c1"># save excel</span>
                    <span class="k">if</span> <span class="n">save_excel</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="s1">&#39;y_abs&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;y_abs&#39;</span><span class="p">]}</span>
                        <span class="n">df_axis_field</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Es&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;Es&#39;</span><span class="p">]}</span>
                        <span class="n">df_surface_field</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">new_save</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_axis_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_surface_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="n">new_save</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">,</span>
                                                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_axis_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">,</span>
                                                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_surface_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;0D Data&#39;</span><span class="p">:</span>
                <span class="n">get_0D_plot_data</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Epk_Eacc_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bpk_Eacc_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Epk_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kcc_arr</span><span class="p">))</span>

                <span class="c1"># save excel</span>
                <span class="k">if</span> <span class="n">save_excel</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key_list</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="n">Ri</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">L</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="n">Req</span><span class="p">,</span>
                            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Freq_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Freq_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;E_stored_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">E_stored_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Rsh_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Rsh_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Q_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Epk_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Epk_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Hpk_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Hpk_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Eacc_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Rsh/Q_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Rsh_Q_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Epk/Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Epk_Eacc_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Bpk/Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Bpk_Eacc_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;kcc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">kcc_arr</span><span class="p">}</span>

                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># # save to json</span>
                    <span class="c1"># with open(f&#39;{save_excel}.json&#39;, &#39;w&#39;) as f:</span>
                    <span class="c1">#     json.dump(data, f, indent=4, separators=(&#39;,&#39;, &#39;: &#39;))</span>

            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;1D Data&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">):</span>
                    <span class="n">get_1D_plot_data</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hey Chief, seems you&#39;ve already processed the </span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s2"> data for this folder. &quot;</span>
                          <span class="s2">&quot;Delete the file to reprocess or rename save_excel argument&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SLANSDataExtraction.multiple_folders_data_old"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSDataExtraction.multiple_folders_data_old">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_folders_data_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_space</span><span class="p">,</span> <span class="n">slans_data_dir</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">save_excel</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="s2">&quot;Yes&quot;</span>

        <span class="k">def</span> <span class="nf">button_clicked</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;File Exist&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Hey Chief, seems you&#39;ve already processed the data for this folder. Do you want to overwrite it?&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>

            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">button_clicked</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">msg</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">msg</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;No&#39;</span>

        <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">shape_space</span>

            <span class="c1"># data arrays initialization</span>
            <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># data arrays initialization</span>
            <span class="n">E_stored_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Rsh_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Q_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Epk_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Hpk_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Rsh_Q_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Epk_Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Bpk_Eacc_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kcc_arr</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">append_geom_parameters</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">Ri</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">Req</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">get_0D_plot_data</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">slans_data</span> <span class="o">=</span> <span class="n">SLANSData</span><span class="p">(</span><span class="n">slans_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>

                    <span class="n">d_0d</span> <span class="o">=</span> <span class="n">slans_data</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>

                    <span class="n">E_stored</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;STORED ENERGY&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">Rsh</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;SHUNT IMPEDANCE&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MOhm</span>
                    <span class="n">Q</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;QUALITY FACTOR&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">Epk</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM ELEC. FIELD&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
                    <span class="n">Hpk</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM MAG. FIELD&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># A/m</span>
                    <span class="c1"># Vacc = d_0d[&#39;ACCELERATION&#39;][mode-1]</span>
                    <span class="n">Eavg</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;AVERAGE E.FIELD ON AXIS&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
                    <span class="n">Rsh_Q</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;EFFECTIVE IMPEDANCE&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Ohm</span>
                    <span class="c1"># Epk_Eacc = d_0d[&#39;KM (Emax/Accel.rate)&#39;][mode-1]  #</span>
                    <span class="c1"># Bpk_Eacc = d_0d[&#39;KH (Hmax*Z0/Accel.rate)&#39;][mode-1]  # mT/(MV/m)</span>

                    <span class="n">Vacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                        <span class="n">Rsh_Q</span> <span class="o">*</span> <span class="n">E_stored</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">400.79</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># factor of 2, remember circuit and accelerator definition</span>
                    <span class="n">Eacc</span> <span class="o">=</span> <span class="n">Vacc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">374</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># factor of 2, remember circuit and accelerator definition</span>
                    <span class="n">Epk_Eacc</span> <span class="o">=</span> <span class="n">Epk</span> <span class="o">/</span> <span class="p">(</span><span class="n">Eacc</span><span class="p">)</span>
                    <span class="n">Bpk_Eacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Hpk</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="p">(</span><span class="n">Eacc</span><span class="p">)</span>

                    <span class="n">E_stored_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_stored</span><span class="p">)</span>
                    <span class="n">Rsh_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Rsh</span><span class="p">)</span>  <span class="c1"># corrected to accelerator definition</span>
                    <span class="n">Q_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
                    <span class="n">Epk_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Epk</span><span class="p">)</span>
                    <span class="n">Hpk_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Hpk</span><span class="p">)</span>
                    <span class="n">Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Eacc</span><span class="p">)</span>
                    <span class="n">Epk_Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Epk_Eacc</span><span class="p">)</span>
                    <span class="n">Bpk_Eacc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bpk_Eacc</span><span class="p">)</span>
                    <span class="n">Rsh_Q_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Rsh_Q</span><span class="p">)</span>  <span class="c1"># corrected to accelerator definition</span>

                    <span class="n">f_0</span><span class="p">,</span> <span class="n">f_pi</span> <span class="o">=</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">d_0d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="n">mode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">kcc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_pi</span> <span class="o">-</span> <span class="n">f_0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f_pi</span> <span class="o">+</span> <span class="n">f_0</span><span class="p">)</span>
                    <span class="n">kcc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kcc</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">append_geom_parameters</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;IC&quot;</span><span class="p">])</span>
                    <span class="n">key_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># sheets = [&#39;Sheet1&#39;, &#39;Sheet2&#39;]</span>
            <span class="k">def</span> <span class="nf">get_1D_plot_data</span><span class="p">():</span>
                <span class="n">new_save</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                    <span class="n">slans_data</span> <span class="o">=</span> <span class="n">SLANSData</span><span class="p">(</span><span class="n">slans_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
                    <span class="n">d_1d</span> <span class="o">=</span> <span class="n">slans_data</span><span class="o">.</span><span class="n">get_1D_plot_data</span><span class="p">()</span>

                    <span class="n">dd</span> <span class="o">=</span> <span class="n">d_1d</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="c1"># print(sheets)</span>

                    <span class="c1"># save excel</span>
                    <span class="k">if</span> <span class="n">save_excel</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="s1">&#39;y_abs&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;y_abs&#39;</span><span class="p">]}</span>
                        <span class="n">df_axis_field</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Es&#39;</span><span class="p">:</span> <span class="n">dd</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;Es&#39;</span><span class="p">]}</span>
                        <span class="n">df_surface_field</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">new_save</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_axis_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_surface_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="n">new_save</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">,</span>
                                                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_axis_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">,</span>
                                                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                                <span class="n">df_surface_field</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;0D node_editor&#39;</span><span class="p">:</span>
                <span class="n">get_0D_plot_data</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Epk_Eacc_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bpk_Eacc_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Epk_arr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">kcc_arr</span><span class="p">))</span>

                <span class="c1"># save excel</span>
                <span class="k">if</span> <span class="n">save_excel</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key_list</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="n">Ri</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">L</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="n">Req</span><span class="p">,</span>
                            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;E_stored_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">E_stored_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Rsh_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Rsh_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Q_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Q_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Epk_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Epk_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Hpk_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Hpk_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Eacc_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Rsh/Q_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Rsh_Q_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Epk/Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Epk_Eacc_arr</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s1">&#39;Bpk/Eacc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">Bpk_Eacc_arr</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;kcc_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">kcc_arr</span><span class="p">}</span>

                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="s1">&#39;1D node_editor&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Axis_Fields.xlsx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">_Surface_Fields.xlsx&#39;</span><span class="p">):</span>
                    <span class="n">get_1D_plot_data</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hey Chief, seems you&#39;ve already processed the </span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s2"> data for this folder. &quot;</span>
                          <span class="s2">&quot;Delete the file to reprocess or rename save_excel argument&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SLANSDataExtraction.multiple_folders_data_parallel"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSDataExtraction.multiple_folders_data_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_folders_data_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_space</span><span class="p">,</span> <span class="n">slans_data_folder</span><span class="p">,</span> <span class="n">proc_count</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">save_excel</span><span class="p">,</span>
                                       <span class="n">temp_folder</span><span class="p">):</span>

        <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span>
        <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>

        <span class="c1"># create temporary folder</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">shape_space_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">share</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">shape_space_len</span> <span class="o">/</span> <span class="n">proc_count</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="c1"># create temporary shape spaces</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proc_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span> <span class="o">+</span> <span class="n">share</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:]</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">proc_keys_list</span><span class="p">)</span>
            <span class="n">processor_shape_space</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proc_keys_list</span><span class="p">:</span>
                    <span class="n">processor_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">service</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiple_folders_data</span><span class="p">,</span>
                                 <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">processor_shape_space</span><span class="p">,</span> <span class="n">slans_data_folder</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">request</span><span class="p">),</span>
                                 <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;save_excel&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">temp_folder</span><span class="si">}</span><span class="s1">\Proc_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;parallel&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
            <span class="n">service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># join temporary files and delete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_excel</span><span class="p">(</span><span class="s1">&#39;Proc&#39;</span><span class="p">,</span> <span class="n">proc_count</span><span class="p">,</span> <span class="n">save_excel</span><span class="p">,</span> <span class="n">temp_folder</span><span class="p">)</span>

        <span class="c1"># delete temporary folder</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_folder</span><span class="p">)</span></div>

<div class="viewcode-block" id="SLANSDataExtraction.join_excel"><a class="viewcode-back" href="../../../modules.data_module.html#modules.data_module.slans_data.SLANSDataExtraction.join_excel">[docs]</a>    <span class="k">def</span> <span class="nf">join_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generic_name</span><span class="p">,</span> <span class="n">proc_count</span><span class="p">,</span> <span class="n">save_excel</span><span class="p">,</span> <span class="n">temp_folder</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">excel_reader</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">temp_folder</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">generic_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)[</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">proc_count</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">excel_reader</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">temp_folder</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">generic_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_excel</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops! Encountered some error trying to save file: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\Projects\NewFolder\SimulationData\SLANS&quot;</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="s2">&quot;Cavity0&quot;</span>  <span class="c1"># folder name</span>

    <span class="c1"># create ABCIData object</span>
    <span class="n">abci_data</span> <span class="o">=</span> <span class="n">SLANSData</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">fid</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">abci_data</span><span class="o">.</span><span class="n">get_0D_plot_data</span><span class="p">()</span>  <span class="c1"># For the key, either the title of the plot can be given as input or the index</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">])</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Sosoho-abasi Udongwo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
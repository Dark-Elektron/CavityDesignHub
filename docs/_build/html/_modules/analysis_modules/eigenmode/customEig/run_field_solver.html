<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>analysis_modules.eigenmode.customEig.run_field_solver &mdash; CavityDesignHub (CaDH) 0.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> CavityDesignHub (CaDH)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_involved.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">CavityDesignHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">CavityDesignHub (CaDH)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">analysis_modules.eigenmode.customEig.run_field_solver</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for analysis_modules.eigenmode.customEig.run_field_solver</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">exit</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>
<span class="kn">from</span> <span class="nn">utils.shared_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sps</span>
<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">as</span> <span class="nn">spsl</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">spio</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>

<span class="n">m0</span> <span class="o">=</span> <span class="mf">9.1093879e-31</span>
<span class="n">q0</span> <span class="o">=</span> <span class="mf">1.6021773e-19</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
<span class="n">eps0</span> <span class="o">=</span> <span class="mf">8.85418782e-12</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mf">2.99792458e8</span>
<span class="n">eta0</span> <span class="o">=</span> <span class="mf">376.7303134111465</span>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Epk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hpk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eacc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vacc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpk</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beampipe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_left</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldparam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="o">=</span> <span class="n">parent_dir</span>

<div class="viewcode-block" id="Model.set_name"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Model.set_folder"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.set_folder">[docs]</a>    <span class="k">def</span> <span class="nf">set_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span></div>

<div class="viewcode-block" id="Model.create_inputs"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.create_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">create_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create required inputs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remove old files</span>
        <span class="n">files_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;geodata.n&quot;</span><span class="p">,</span> <span class="s2">&quot;initials&quot;</span><span class="p">,</span> <span class="s2">&quot;flevel&quot;</span><span class="p">,</span> <span class="s2">&quot;y00&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">,</span> <span class="s2">&quot;fieldparam&quot;</span><span class="p">,</span> <span class="s2">&quot;counter_flevels.mat&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;counter_initials.mat&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;gene_initials.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_temp.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;initials_temp.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;distance_flevel.mat&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;counter_initialsl.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_initialsl.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;initials_templ.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;distance_flevell.mat&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;counter_initialsr.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_initialsr.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;initials_tempr.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;distance_flevelr.mat&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;dx.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;alphas.mat&quot;</span><span class="p">]</span>
        <span class="c1"># input_files_list = [&quot;initials&quot;, &quot;param&quot;, &quot;fieldparam&quot;, &quot;counter_flevels.mat&quot;,</span>
        <span class="c1">#                     &quot;counter_initials.mat&quot;,</span>
        <span class="c1">#                     &quot;gene_initials.mat&quot;]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># write intset. sample points and set for integration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\intset.mat&quot;</span><span class="p">):</span>
            <span class="n">PP</span><span class="p">,</span> <span class="n">ww</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inttri</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">intset</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PP&quot;</span><span class="p">:</span> <span class="n">PP</span><span class="p">,</span>
                      <span class="s2">&quot;ww&quot;</span><span class="p">:</span> <span class="n">ww</span><span class="p">}</span>
            <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/intset.mat&quot;</span><span class="p">,</span> <span class="n">intset</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="c1"># check if geometry has been written</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;The geometry file geodata.n seems to be missing&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Old input data deleted.&#39;</span><span class="p">)</span>

        <span class="c1"># Inputs for eigenmode solver</span>
        <span class="n">gtype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">epsr</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># relative epsilon</span>
        <span class="n">strech</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Grid constant</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Mesh constant</span>
        <span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># initial velocity</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of impacts</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># initialize fieldparam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldparam</span> <span class="o">=</span> <span class="p">[</span><span class="n">gtype</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">epsr</span><span class="p">,</span> <span class="n">d1</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">strech</span><span class="p">,</span> <span class="n">Z</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldparam</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fieldparam&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># parameters for the MP analysis</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">V0</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># intensity of the EM field</span>
        <span class="c1"># gamma = c0 / freq / (2 * np.pi)  # distance/phase -coefficient</span>
        <span class="n">v00</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">((</span><span class="n">v0</span> <span class="o">*</span> <span class="n">q0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m0</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># initial velocity (relativistic)</span>
        <span class="c1"># v00   = sqrt(2*v0*q/m)                 # (classical)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># compute counter functions</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># tolerance for the ODE solver</span>
        <span class="n">emin</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># not required for eigenmode analysis</span>
        <span class="n">emax</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># not required for eigenmode analysis</span>
        <span class="c1"># self.param = [freq, V0, gamma, v00, N, ctype, tol, emin, emax]</span>
        <span class="c1"># save -ascii param param</span>
        <span class="c1"># df = pd.DataFrame(self.param)</span>
        <span class="c1"># df.to_csv(fr&#39;{self.folder}\param&#39;, index=False, header=False, float_format=&#39;%.7E&#39;)</span>

        <span class="c1"># grid constant for creating a new grid</span>
        <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\geodata.n&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.define_geometry"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.define_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">define_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_cells: int</span>
<span class="sd">            Number of cavity cells</span>
<span class="sd">        mid_cell: array like</span>
<span class="sd">            Mid cell cell geometric parameters</span>
<span class="sd">        end_cell_left: array like</span>
<span class="sd">            Left end cell cell geometric parameters</span>
<span class="sd">        end_cell_right: array like</span>
<span class="sd">            Right end cell cell geometric parameters</span>
<span class="sd">        beampipe: {&quot;none&quot;, &quot;both&quot;, &quot;left&quot;, &quot;right&quot;}</span>
<span class="sd">            Which sides to include beampipes</span>
<span class="sd">        plot: bool</span>
<span class="sd">            Show geometry after definition or not</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">=</span> <span class="n">n_cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span> <span class="o">=</span> <span class="n">mid_cell</span>

        <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_left</span> <span class="o">=</span> <span class="n">mid_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_left</span> <span class="o">=</span> <span class="n">end_cell_left</span>

        <span class="k">if</span> <span class="n">end_cell_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">end_cell_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">mid_cell</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">end_cell_left</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">mid_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span> <span class="o">=</span> <span class="n">end_cell_right</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beampipe</span> <span class="o">=</span> <span class="n">beampipe</span>

        <span class="c1"># check if folder exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;There was a problem creating the directory for the simulation files. Please check folder.&quot;</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\geodata.n&quot;</span>
        <span class="n">write_cavity_for_custom_eig_solver</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="p">,</span> <span class="n">beampipe</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_inputs</span><span class="p">()</span></div>

<div class="viewcode-block" id="Model.generate_mesh"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.generate_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">generate_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridcons</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">epsr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate mesh</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gridcons: float</span>
<span class="sd">            Maximum element width</span>
<span class="sd">        epsr:</span>
<span class="sd">            Relative permittivity</span>
<span class="sd">        plot:</span>
<span class="sd">            Show mesh after generation or not</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Then the edges, the third column secifies the type of an edge as follows:</span>
        <span class="c1">#   1 : nxE = 0 on boundary</span>
        <span class="c1">#   3 : nxH = 0 on boundary</span>
        <span class="c1">#   0 : for stretching (open boundary condition?)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Geometry data geodata.n missing. No geometry to mesh&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Meshing geometry&quot;</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">gn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>

        <span class="n">PEC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gn</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># electric walls</span>
        <span class="n">WIN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gn</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># dielectric walls</span>
        <span class="n">PMC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gn</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># magnetic walls</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">WIN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Dielectric boundary found in a cavity.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># specify the job for the eigenvalue solver</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PMC</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;A cavity with magnetic walls.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">PEC</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">PMC</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;A cavity with electric walls.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Invalid surface boundary conditions. Please check the geometry file.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">job</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/job.mat&#39;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gz</span><span class="p">,</span> <span class="n">gr</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Patches: first the edges are listed, last three values give relative epsilon, relative mu and patch type,</span>
        <span class="c1"># 0 = can stretch, 1-n = regulars</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ne</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">epsr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">esize</span> <span class="o">=</span> <span class="n">gridcons</span>

        <span class="c1"># save model.mat</span>
        <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="n">nodes</span><span class="p">,</span>
                 <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">edges</span><span class="p">,</span>
                 <span class="s2">&quot;patches&quot;</span><span class="p">:</span> <span class="n">patches</span><span class="p">,</span>
                 <span class="s2">&quot;esize&quot;</span><span class="p">:</span> <span class="n">esize</span>
                 <span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/model.mat&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="c1"># start the mesh generator</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span><span class="si">}</span><span class="s2">\exe\own_exe\2dgen_bin.exe&quot;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="c1"># subprocess.call(fr&quot;{self.parent_dir}\exe\own_exe\2dgen_bin.exe&quot;, cwd=self.folder)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;..\..\..\exe\own_exe\2dgen_bin.exe&quot;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">))</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;..\..\..\exe\own_exe\2dgen_bin.exe&quot;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="c1"># subprocess.call(f&quot;{self.folder}/2dgen_bin.exe&quot;, cwd=self.folder)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\mesh.mat&quot;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Meshing completed.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_mesh</span><span class="p">()</span></div>

<div class="viewcode-block" id="Model.plot_mesh"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.plot_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot generated mesh</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\mesh.mat&quot;</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">([</span><span class="s1">&#39;The mesh does not exists. There might have been an error in generating the mesh.&#39;</span><span class="p">])</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\fieldparam&quot;</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Parameter file fieldparam does not exist.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># gtype = self.fieldparam[0]</span>
        <span class="c1"># if gtype == 1:</span>
        <span class="c1">#     ic(&#39;\tPlotting the mesh.&#39;)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     ic(&#39;\tPlotting the mesh. Blue area for streching.&#39;)</span>

        <span class="c1"># plots 2D mesh in mesh.mat, which includes coord and etopol -arrays</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">]</span>
        <span class="n">etopol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;etopol&#39;</span><span class="p">]</span>
        <span class="n">alue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;alue&#39;</span><span class="p">]</span>
        <span class="n">tyyppi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;tyyppi&#39;</span><span class="p">]</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>

        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">x_min</span><span class="p">],</span> <span class="p">[</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">],</span> <span class="s1">&#39;k.&#39;</span><span class="p">)</span>

        <span class="n">koko</span><span class="p">,</span> <span class="n">pois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">etopol</span><span class="p">)</span>
        <span class="n">ala</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">koko</span><span class="p">))</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="n">koko</span><span class="p">))</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">koko</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">koko</span><span class="p">):</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">etopol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">etopol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">n3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">etopol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y3</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">n3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">Y</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

            <span class="n">osa</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
            <span class="n">ala</span> <span class="o">=</span> <span class="n">ala</span> <span class="o">+</span> <span class="n">osa</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">alue</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tyyppi</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tyyppi</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># no bouncing</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)):</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">coord</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">boundary</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[(</span><span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="s1">&#39;b*&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">boundary</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;w*&#39;</span><span class="p">)</span>
        <span class="n">ala</span> <span class="o">=</span> <span class="n">ala</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z axis [m]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r axis [m]&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Model.run_field_solver"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.run_field_solver">[docs]</a>    <span class="k">def</span> <span class="nf">run_field_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">req_mode_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Function program cavity_field(s)</span>
        <span class="c1"># -----------------------------------------------------------------------</span>
        <span class="c1"># Runs the field solver for computing the EM fields in a cavity with</span>
        <span class="c1"># magnetic ends.</span>
        <span class="c1"># INPUT  s : 1 - display messages, 0 - display only a few messages</span>
        <span class="c1">#</span>
        <span class="c1"># -----------------------------------------------------------------------</span>
        <span class="c1"># CALLS TO : print.m, make_model_cavity.m, plot_mesh.m, eigen.m,</span>
        <span class="c1">#            calculate_fields.m, plot_FEM_fields.m, clear_window.m</span>
        <span class="c1"># 10/04/00 : Pasi Yla-Oijala, Rolf Nevanlinna Institute</span>
        <span class="c1"># ------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;No mesh found. Generating mesh with default settings.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_mesh</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">show_plots</span><span class="p">)</span>

        <span class="c1"># load geodata.n</span>
        <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>

        <span class="c1"># if self.epsr &gt; 1:</span>
        <span class="c1">#     ic(&#39;Relative permittivity &gt; 1?&#39;)</span>
        <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># calculate freq from mid cell length</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">c0</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;calculated freq from length: &quot;</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>

        <span class="n">eigen_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen</span><span class="p">(</span><span class="n">n_modes</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">req_mode_num</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">freq</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eigen_freq</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Warning: Error in eigen frequency more than 1#.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;No frequency to compare with.&quot;</span><span class="p">)</span>

        <span class="c1"># compute and plot the fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fields</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show_plots</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Plotting fields&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_FEM_fields</span><span class="p">(</span><span class="s1">&#39;contour&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.eigen"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.eigen">[docs]</a>    <span class="k">def</span> <span class="nf">eigen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_modes</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">req_mode_num</span><span class="p">,</span> <span class="n">search</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform eigenmode simulation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_modes: int</span>
<span class="sd">            Number of modes</span>
<span class="sd">        freq: float</span>
<span class="sd">            Frequency to find eigenvalues around</span>
<span class="sd">        req_mode_num: int</span>
<span class="sd">            Required mode number</span>
<span class="sd">        search: null</span>
<span class="sd">            Redundant for now</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">req_mode_num</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">req_mode_num</span> <span class="o">&gt;</span> <span class="n">n_modes</span><span class="p">:</span>
                <span class="n">req_mode_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">req_mode_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span>

        <span class="c1"># maara = 10  Means number of modes in original code</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/offset.mat&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="c1"># !eigenC_bin</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eigenCpath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span><span class="si">}</span><span class="s1">\exe\own_exe\eigenC_bin.exe&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eigenCpath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;..\..\..\exe\own_exe\eigenC_bin.exe&#39;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">eigenCpath</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">eigenCpath</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="c1"># subprocess.call(eigenCpath, cwd=cwd)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Done running eigenC_bin.exe&quot;</span><span class="p">)</span>

        <span class="n">cinfo</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\cinfo.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;cinfo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cinfo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Eigenvalue solver failed.&#39;</span><span class="p">)</span>

        <span class="c1"># load o_eigen</span>
        <span class="c1"># I think eigen2_bin only writes out the matrices necessary for the computation of the eigenvalues and</span>
        <span class="c1"># does not actually solve the eigenvalue problem</span>
        <span class="n">o_eigen</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\o_eigen.mat&quot;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;ia&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># matlab indices to python</span>
        <span class="n">ja</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;ja&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Aarvot</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;Aarvot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Barvot</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;Barvot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;nf&#39;</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">siirto</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;siirto&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">AA</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Aarvot</span><span class="p">,</span> <span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">ja</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Barvot</span><span class="p">,</span> <span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">ja</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="n">k0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">eps0</span><span class="p">)</span>
        <span class="n">d2</span><span class="p">,</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">spsl</span><span class="o">.</span><span class="n">eigs</span><span class="p">(</span><span class="n">AA</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">BB</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n_modes</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">k0</span><span class="p">)</span>

        <span class="c1"># imaginary component of eigenvectors are zero</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">real</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">eigen_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">eps0</span><span class="p">)))</span>
            <span class="c1"># sort array</span>
            <span class="n">sort_ind</span> <span class="o">=</span> <span class="n">eigen_frequencies</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span> <span class="o">=</span> <span class="n">eigen_frequencies</span><span class="p">[</span><span class="n">sort_ind</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k2</span><span class="p">[</span><span class="n">sort_ind</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">u2</span><span class="p">[:,</span> <span class="n">sort_ind</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">req_mode_num</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">req_mode_num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">eigen_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="n">req_mode_num</span><span class="p">)</span>
                <span class="c1"># find eigenvalue with min error.</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k0</span> <span class="o">-</span> <span class="n">k2</span><span class="p">))</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k0</span> <span class="o">-</span> <span class="n">k2</span><span class="p">))</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
                <span class="c1"># new frequency</span>
                <span class="n">eigen_freq</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">eps0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">eps0</span><span class="p">)))</span>
            <span class="n">eigen_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">req_mode_num</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">req_mode_num</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># param = pd.read_csv(fr&quot;{self.folder}\param&quot;, sep=&#39;\s+&#39;, header=None).to_numpy().T[0]</span>
        <span class="c1"># self.param[0] = eigen_freq</span>
        <span class="c1"># df = pd.DataFrame(self.param)</span>
        <span class="c1"># df.to_csv(fr&#39;{self.folder}\param&#39;, index=False, header=False, float_format=&#39;%.7E&#39;)</span>

        <span class="c1"># fieldparam = pd.read_csv(fr&quot;{self.folder}\fieldparam&quot;, sep=&#39;\s+&#39;, header=None).to_numpy().T[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span> <span class="o">=</span> <span class="n">eigen_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldparam</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eigen_freq</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldparam</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fieldparam&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">kama0</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                 <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span>
                 <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">k</span>
                 <span class="p">}</span>

        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/kama0.mat&quot;</span><span class="p">,</span> <span class="n">kama0</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Done with eigen&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">eigen_freq</span></div>

<div class="viewcode-block" id="Model.calculate_fields"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_fields">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the fields from the eigenvectors</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">Computing the fields.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Geometry file geodata.n does not exist.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\mesh.mat&quot;</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">The mesh does not exists. Choose Mesh Generator in menu Run.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\kama0.mat&quot;</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">The fields do not exist. Choose Field Solver in menu Run.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>
        <span class="n">gridcons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># load mesh</span>
        <span class="c1"># mesh = spio.loadmat(fr&quot;{self.folder}\mesh.mat&quot;)</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;coord&#39;</span><span class="p">]</span>
        <span class="n">etopol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;etopol&#39;</span><span class="p">]</span>
        <span class="n">alue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;alue&#39;</span><span class="p">]</span>
        <span class="n">tyyppi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;tyyppi&#39;</span><span class="p">]</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>

        <span class="n">z1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gz</span><span class="p">)</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gz</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>

        <span class="n">zmaara</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">,</span> <span class="n">gridcons</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">zmaara</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">zmaara</span> <span class="o">=</span> <span class="n">zmaara</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">rmaara</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">gridcons</span><span class="p">))))</span>

        <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zmaara</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zmaara</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># (z2-z1)/(zmaara - 1) included so that end pint is included</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zmaara</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rmaara</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># (z2-z1)/(zmaara - 1) included so that end pint is included</span>

        <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">I1</span><span class="p">,</span> <span class="n">I2</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">I1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zz</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">alue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-10</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">rind</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">zind</span> <span class="o">=</span> <span class="n">ind2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">zr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;alue&#39;</span><span class="p">:</span> <span class="n">alue</span><span class="p">,</span> <span class="s1">&#39;rind&#39;</span><span class="p">:</span> <span class="n">rind</span><span class="p">,</span> <span class="s1">&#39;zind&#39;</span><span class="p">:</span> <span class="n">zind</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\zr.mat&#39;</span><span class="p">,</span> <span class="n">zr</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="c1"># compute the fields at generated points</span>
        <span class="c1"># !copy /y kama0.mat kama.mat</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\kama0.mat&#39;</span><span class="p">,</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\kama.mat&#39;</span><span class="p">)</span>

        <span class="n">cwd</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">multipacPath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_dir</span><span class="si">}</span><span class="s1">\exe\own_exe\Multipac.exe&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multipacPath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;..\..\..\exe\own_exe\Multipac.exe&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">multipacPath</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">multipacPath</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
            <span class="c1"># subprocess.call([multipacPath, &#39;fields&#39;, &#39;-b&#39;], cwd=cwd)</span>

        <span class="n">Er</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\Er.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\Ez.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\H.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;I1&#39;</span><span class="p">:</span> <span class="n">I1</span><span class="p">,</span> <span class="s1">&#39;I2&#39;</span><span class="p">:</span> <span class="n">I2</span><span class="p">,</span> <span class="s1">&#39;rr&#39;</span><span class="p">:</span> <span class="n">rr</span><span class="p">,</span> <span class="s1">&#39;zz&#39;</span><span class="p">:</span> <span class="n">zz</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;Er&#39;</span><span class="p">:</span> <span class="n">Er</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">:</span> <span class="n">Ez</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">H</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fields.mat&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>  <span class="c1"># this was not saved as Mat object version 4. Ask why?</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_QoI</span><span class="p">()</span></div>

<div class="viewcode-block" id="Model.plot_FEM_fields"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.plot_FEM_fields">[docs]</a>    <span class="k">def</span> <span class="nf">plot_FEM_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptype</span><span class="p">):</span>
        <span class="n">ok2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/geodata.n&#39;</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fields.mat&#39;</span><span class="p">,</span> <span class="s1">&#39;Er.mat&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez.mat&#39;</span><span class="p">,</span> <span class="s1">&#39;H.mat&#39;</span><span class="p">,</span> <span class="s1">&#39;fieldparam&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ok2</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">ok2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="s1">&#39;contour&#39;</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Plotting the fields. A pcolor plot.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ptype</span> <span class="o">==</span> <span class="s1">&#39;arrow&#39;</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Plotting the fields. An arrow plot.&#39;</span><span class="p">)</span>

            <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_cavity_fields</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.plot_cavity_fields"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.plot_cavity_fields">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cavity_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the computed fields on the input geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ptype: {&#39;contour&#39;, &#39;arrow&#39;}</span>
<span class="sd">            Plot type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># load the field values</span>
        <span class="c1"># load fields Er Ez H I1 I2 zz rr z r</span>
        <span class="c1"># fields = spio.loadmat(fr&quot;{self.folder}\fields.mat&quot;)</span>
        <span class="n">Er</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;I1&#39;</span><span class="p">]</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;I2&#39;</span><span class="p">]</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;zz&#39;</span><span class="p">]</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;rr&#39;</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>

        <span class="c1"># plot the fields</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="s1">&#39;contour&#39;</span><span class="p">:</span>  <span class="c1"># a pcolor plot</span>
            <span class="c1"># ic(I2.shape, I1.shape, Er.shape)</span>
            <span class="n">Er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Er</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ez</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
            <span class="n">EE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Er</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ez</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="n">pcE</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">,</span> <span class="n">EE</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
            <span class="c1"># pcE = axs[0].contourf(zz, rr, EE, cmap=&#39;RdBu&#39;, levels=40)</span>
            <span class="c1"># color = 2 * np.log(np.hypot(Ez, Er))</span>
            <span class="c1"># pcE = axs[0].streamplot(zz, rr, Ez, Er, linewidth=1, cmap=plt.cm.inferno,</span>
            <span class="c1">#               density=2, arrowstyle=&#39;-&gt;&#39;, arrowsize=1.5)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcE</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gz</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">)</span>

            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z axis [m]&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r axis [m]&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Electric field |$E$| [V/m]&#39;</span><span class="p">)</span>

            <span class="n">HH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">pcH</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">,</span> <span class="mf">4e-7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">HH</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcH</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gz</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Magnetic field |$B_\phi$| [T]&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z axis [m]&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r axis [m]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Er</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ez</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># arrow(F,A,gridcons,&#39;f&#39;,&#39;s&#39;,&#39;k&#39;)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">EE</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">EE</span><span class="p">))</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">skip</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">skip</span><span class="p">],</span> <span class="n">Ez</span><span class="p">[</span><span class="n">skip</span><span class="p">],</span> <span class="n">Er</span><span class="p">[</span><span class="n">skip</span><span class="p">],</span> <span class="n">EE</span><span class="p">[</span><span class="n">skip</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                      <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">EE</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">EE</span><span class="p">)),</span>
                      <span class="n">minlength</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gz</span><span class="p">,</span> <span class="n">gr</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z axis [m]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;r axis [m]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Electric field |$E$| [V/m]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Model.calculate_QoI"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_QoI">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_QoI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Calculating QoIs&quot;</span><span class="p">)</span>

        <span class="c1"># geodata = pd.read_csv(fr&quot;{self.folder}\geodata.n&quot;, sep=&#39;\s+&#39;, header=None).to_numpy()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># load the field values</span>
        <span class="c1"># fields = spio.loadmat(fr&quot;{self.folder}\fields.mat&quot;)</span>
        <span class="n">Er</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;I1&#39;</span><span class="p">]</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;I2&#39;</span><span class="p">]</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;zz&#39;</span><span class="p">]</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;rr&#39;</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>  <span class="c1"># flattened zz array</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>  <span class="c1"># flattened rr array</span>

        <span class="c1"># plot the fields</span>
        <span class="n">Er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Er</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ez</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

        <span class="c1"># check electric fields</span>
        <span class="n">EE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Er</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ez</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">HH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I1</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">I2</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Calculate accelerating field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis</span> <span class="o">=</span> <span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">rr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># &amp; zz&gt;=-L_half_cell &amp; zz &lt;= L_half_cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis_abs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis</span><span class="p">)</span>
        <span class="n">z_slice</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># z_active = z_slice[(z_slice &gt;= -L_half_cell) &amp; (z_slice &lt;= L_half_cell)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Vacc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_vacc</span><span class="p">(</span><span class="n">z_slice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Eacc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vacc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

        <span class="n">z_e_surf</span><span class="p">,</span> <span class="n">r_e_surf</span><span class="p">,</span> <span class="n">E_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_surface_field</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">)</span>
        <span class="n">z_h_surf</span><span class="p">,</span> <span class="n">r_h_surf</span><span class="p">,</span> <span class="n">H_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_surface_field</span><span class="p">(</span><span class="n">HH</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Epk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">E_surf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hpk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">H_surf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">epk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_epk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Epk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eacc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bpk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bpk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eacc</span><span class="p">)</span>

        <span class="c1"># plt.plot(np.array(z_e), E_surf/np.max(E_surf))</span>
        <span class="c1"># plt.plot(np.array(z_h), H_surf/np.max(H_surf))</span>
        <span class="c1"># plt.show()</span>

        <span class="c1"># calculate energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_U</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">HH</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">)</span>
        <span class="c1"># calculate R/Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_rq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vacc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
        <span class="c1"># calculate loss factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_loss_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">)</span>
        <span class="c1"># calculate surface resistance using copper conductivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_surface_resistance_copper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_disspated_power</span><span class="p">(</span><span class="n">H_surf</span><span class="p">,</span> <span class="n">z_h_surf</span><span class="p">,</span> <span class="n">r_h_surf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_q</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_g</span><span class="p">()</span>

        <span class="c1"># ic(self.eig_freq, self.epk, self.bpk, self.R_Q, self.k_loss,</span>
        <span class="c1">#    self.Rs, self.Pds, self.Q0, self.G)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_qois</span><span class="p">()</span></div>
        <span class="c1"># write_cst_paramters(self.name, self.mid_cell, self.end_cell_left, self.end_cell_right,</span>
        <span class="c1">#                     projectDir=self.folder, cell_type=&quot;None&quot;)</span>

<div class="viewcode-block" id="Model.calculate_U"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_U">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_U</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">HH</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the energy :math:`U_n` of eigenmode :math:`n` from either electric or magnetic field.</span>

<span class="sd">        .. math::</span>
<span class="sd">           U_n = \\frac{1}{2} \int_{z_\min}^{z_\max} \int_{r_\min}^{r_\max} \int_{0}^{2\pi} D_n \cdot E_n \mathrm{d}V</span>
<span class="sd">           = \\frac{1}{2}\int_{z_\min}^{z_\max} \int_{r_\min}^{r_\max} \int_{0}^{2\pi} B_n \cdot H_n \mathrm{d}V</span>

<span class="sd">           D_n \cdot E_n = \epsilon_0 E^2; ~B_n \cdot H_n = \mu_0 H^2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EE: 2D array</span>
<span class="sd">            Array of electric field magnitude in 2D space</span>
<span class="sd">        HH:</span>
<span class="sd">            Array of magnetic field magnitude in 2D space</span>
<span class="sd">        zz: 2D array</span>
<span class="sd">            Grid points z coordinate</span>
<span class="sd">        rr: 2D array</span>
<span class="sd">            Grid points r coordinate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        U: float</span>
<span class="sd">            Energy over the shape volume</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># calculate volume which is area under contour curve</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># ic(z, r)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">HH</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rr</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">UE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">eps0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">EE</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rr</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">UE</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">U</span></div>

<div class="viewcode-block" id="Model.calculate_surface_resistance_copper"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_surface_resistance_copper">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_surface_resistance_copper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the surface resistance for Copper with conductivity</span>

<span class="sd">        of :math:`\sigma = 5.96 \\times 10^7 \mathrm{S/m}` at eigen frequency</span>

<span class="sd">        .. math::</span>
<span class="sd">           R_\mathrm{s} = \\sqrt{\\frac{\mu \omega}{2 \sigma}}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Rs: float</span>
<span class="sd">            Surface resistance of copper at operating frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma_Cu</span> <span class="o">=</span> <span class="mf">5.96e7</span>
        <span class="n">Rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">mu0</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_Cu</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Rs</span></div>

<div class="viewcode-block" id="Model.calculate_disspated_power"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_disspated_power">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_disspated_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H_surf</span><span class="p">,</span> <span class="n">z_surf</span><span class="p">,</span> <span class="n">r_surf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the dissipated power from the cavity walls</span>

<span class="sd">        .. math::</span>
<span class="sd">           P_\mathrm{ds} = \\frac{1}{2} R_\mathrm{s} \int_{z_\min}^{z_\max} \int_{0}^{2\pi} |H_\\theta|^2 \mathrm{d}s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        H_surf</span>
<span class="sd">        z_surf</span>
<span class="sd">        r_surf</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dr_surf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r_surf</span><span class="p">)</span>
        <span class="n">dz_surf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_surf</span><span class="p">)</span>

        <span class="c1"># Pds = self.Rs * np.pi * np.trapz(abs(H_surf) ** 2 * r_surf, z_surf)</span>
        <span class="n">H2r_surf</span> <span class="o">=</span> <span class="n">H_surf</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">r_surf</span>
        <span class="n">Pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">H2r_surf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">H2r_surf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dr_surf</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz_surf</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">dA_l</span> <span class="o">=</span> <span class="n">r_surf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dr_surf</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz_surf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dA_r</span> <span class="o">=</span> <span class="n">r_surf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dr_surf</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz_surf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dA</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_surf</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">r_surf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dr_surf</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz_surf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">A_l</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dA_l</span><span class="p">)</span>
        <span class="n">A_r</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dA_r</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dA</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">A_l</span><span class="p">,</span> <span class="n">A_r</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Pds</span></div>

<div class="viewcode-block" id="Model.calculate_q"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_q">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pds</span></div>

<div class="viewcode-block" id="Model.calculate_g"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_g">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the geometry or form factor for the cavity</span>

<span class="sd">        .. math::</span>
<span class="sd">           G = Q_0 \cdot R_\mathrm{s} = \\frac{\omega U_n}{P_\mathrm{ds}}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span></div>

<div class="viewcode-block" id="Model.get_surface_field"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.get_surface_field">[docs]</a>    <span class="k">def</span> <span class="nf">get_surface_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_array</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the surface field values. Works by looping through the 2D field array and returning the first and last</span>
<span class="sd">        non-zero elements in each row</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rr: 2D array</span>
<span class="sd">            r coordinates</span>
<span class="sd">        zz: 2D array</span>
<span class="sd">            z coordinates</span>
<span class="sd">        field_array: array</span>
<span class="sd">            Field values on grid</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># copy rr to avoid making changes to it</span>
        <span class="n">rr_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
        <span class="n">rr_copy</span><span class="p">[</span><span class="n">field_array</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># this line alters rr hence the copy</span>
        <span class="n">r_surf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">rr_copy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">indx_r_surf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">rr_copy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">z_surf</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">surf_field</span> <span class="o">=</span> <span class="n">field_array</span><span class="p">[</span><span class="n">indx_r_surf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_surf</span><span class="p">))]</span>

        <span class="k">return</span> <span class="n">z_surf</span><span class="p">,</span> <span class="n">r_surf</span><span class="p">,</span> <span class="n">surf_field</span></div>

<div class="viewcode-block" id="Model.find_resonance"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.find_resonance">[docs]</a>    <span class="k">def</span> <span class="nf">find_resonance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
        <span class="n">maara</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># number of eigenvalues</span>
        <span class="n">raja</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># error tolerance</span>

        <span class="n">EKENTTA</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">HKENTTA</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
        <span class="n">e0</span> <span class="o">=</span> <span class="mf">8.85418782e-12</span>
        <span class="n">k0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu0</span> <span class="o">*</span> <span class="n">e0</span><span class="p">)</span>  <span class="c1"># &quot;correct&quot; eigenvalue</span>

        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;----------- E-walls ------------&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39; Eigenvalue   error     shift&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;job&#39;</span><span class="p">:</span> <span class="n">EKENTTA</span><span class="p">}</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;It&#39;s here here1&quot;</span><span class="p">)</span>

        <span class="c1"># save job job -v4</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/job.mat&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;It&#39;s here here2&quot;</span><span class="p">)</span>
        <span class="n">ind</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">u1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raja</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;It&#39;s here here3&quot;</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">k1</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u1</span>
        <span class="c1"># load o_eigen</span>
        <span class="n">o_eigen</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/o_eigen.mat&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># save kama1 index -v4</span>
        <span class="c1"># save kama1 u -v4 -append</span>
        <span class="c1"># save kama1 k -v4 -append</span>
        <span class="n">kama1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/kama1.mat&quot;</span><span class="p">,</span> <span class="n">kama1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;----------- H-walls ------------&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39; Eigenvalue   error     shift&#39;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;job&#39;</span><span class="p">:</span> <span class="n">HKENTTA</span><span class="p">}</span>

        <span class="c1"># save job job -v4</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/job.mat&quot;</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="n">ind</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raja</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">k2</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span>
        <span class="c1"># load o_eigen</span>
        <span class="n">o_eigen</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/o_eigen.mat&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># save kama2 index -v4</span>
        <span class="c1"># save kama2 u -v4 -append</span>
        <span class="c1"># save kama2 k -v4 -append</span>
        <span class="n">kama2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/kama1.mat&quot;</span><span class="p">,</span> <span class="n">kama2</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span></div>

<div class="viewcode-block" id="Model.calculate_vacc"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_vacc">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_vacc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">E_z_axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the accelerating voltage of the accelerating mode</span>

<span class="sd">        .. math::</span>
<span class="sd">           V_\mathrm{cav} = \\vert \int_{z_\min}^{z_\max} E_z(r=0, z) \mathrm{e}^{jk_0 z}\\vert \mathrm{d}z</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E_z_axis: array</span>
<span class="sd">            :math:`z` component of electric field on axis :math:`r=0`</span>
<span class="sd">        z: array</span>
<span class="sd">            :math:`z` coordinate points along axis :math:`r=0`</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vacc: float</span>
<span class="sd">            Accelerating voltage along axis :math:`r=0`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># calculate Vacc</span>
        <span class="n">E_axis</span> <span class="o">=</span> <span class="n">E_z_axis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span> <span class="o">/</span> <span class="n">c0</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">Vacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">E_axis</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Vacc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.calculate_rq"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_rq">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_rq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Vacc</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the :math:`R/Q_\parallel` of the accelerating mode.</span>

<span class="sd">        .. math::</span>
<span class="sd">           R/Q = \\frac{|V_{\parallel, n(0, z)}|^2}{\omega_n U_n}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Vacc: float</span>
<span class="sd">            Accelerating voltage.</span>
<span class="sd">        U: float</span>
<span class="sd">            Stored energy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">Vacc</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span> <span class="o">*</span> <span class="n">U</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.calculate_epk"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_epk">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_epk</span><span class="p">(</span><span class="n">Epk</span><span class="p">,</span> <span class="n">Eacc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the peak surface electric field to accelerating field ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Epk: float</span>
<span class="sd">            Peak electric field</span>
<span class="sd">        Eacc: float</span>
<span class="sd">            Accelerating electric field</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Epk/Eacc: float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Epk</span> <span class="o">/</span> <span class="n">Eacc</span></div>

<div class="viewcode-block" id="Model.calculate_bpk"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_bpk">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_bpk</span><span class="p">(</span><span class="n">Hpk</span><span class="p">,</span> <span class="n">Eacc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the peak surface magnetic field to accelerating field ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Hpk: float</span>
<span class="sd">            Peak wall surface magnetic field</span>
<span class="sd">        Eacc: float</span>
<span class="sd">            Accelerating electric field</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bpk/Eacc: float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">Hpk</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.calculate_loss_factor"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_loss_factor">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_loss_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R_Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates fundamental mode loss factor</span>

<span class="sd">        .. math::</span>
<span class="sd">          k_{\parallel, n}  = \\frac{|V_{\parallel, n}(0, 0)|^2}{4 U_n} = \\frac{\omega_n}{4} \\frac{R}{Q}_n</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        R_Q: float</span>
<span class="sd">            R/Q of cavity geometry</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k_loss: float</span>
<span class="sd">            Mode loss factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">R_Q</span> <span class="o">*</span> <span class="mf">1e-12</span>  <span class="c1"># [V/pC]</span></div>

<div class="viewcode-block" id="Model.calculate_volume"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.calculate_volume">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EE</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the volume of the volume of revolution of the cavity profile</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EE: array like</span>
<span class="sd">            Electric field array</span>
<span class="sd">        zz: array like</span>
<span class="sd">            z coordinates on grid</span>
<span class="sd">        rr: array like</span>
<span class="sd">            r coordinates on grid</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        V: float</span>
<span class="sd">            Volume of revolution of cavity profile</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">rr_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
        <span class="n">rr_copy</span><span class="p">[</span><span class="n">EE</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">V</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">rr_copy</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">V</span></div>

<div class="viewcode-block" id="Model.save_qois"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.save_qois">[docs]</a>    <span class="k">def</span> <span class="nf">save_qois</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the quantities of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">update_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span><span class="o">*</span><span class="mf">1e3</span><span class="p">),</span>
                 <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">update_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_cell_left</span><span class="o">*</span><span class="mf">1e3</span><span class="p">),</span>
                 <span class="s1">&#39;OC_R&#39;</span><span class="p">:</span> <span class="n">update_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_cell_right</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\geometric_parameters.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>

        <span class="n">Req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span>

        <span class="c1"># cel to cell coupling factor</span>
        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">)</span>
        <span class="n">f_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen_frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kcc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f_diff</span> <span class="o">/</span> <span class="n">f_add</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># field flatness</span>
        <span class="c1"># get max in each cell</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis_abs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">E_abs_peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_z_axis_abs</span><span class="p">[</span><span class="n">peaks</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">E_abs_peaks</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_abs_peaks</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Req [mm]&quot;</span><span class="p">:</span> <span class="n">Req</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="s2">&quot;Normalization Length [mm]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid_cell</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="s2">&quot;freq [MHz]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig_freq</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s2">&quot;Q []&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span>
            <span class="s2">&quot;E [MV/m]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span>
            <span class="s2">&quot;Vacc [MV]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vacc</span><span class="p">,</span>
            <span class="s2">&quot;Eacc [MV/m]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eacc</span><span class="p">,</span>
            <span class="s2">&quot;Epk [MV/m]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Epk</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s2">&quot;Hpk [A/m]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hpk</span><span class="p">,</span>
            <span class="s2">&quot;Bpk [mT]&quot;</span><span class="p">:</span> <span class="n">mu0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hpk</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="s2">&quot;kcc [%]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kcc</span><span class="p">,</span>
            <span class="s2">&quot;ff [%]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span>
            <span class="s2">&quot;Rsh [Ohm]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Q0</span><span class="p">,</span>
            <span class="s2">&quot;R/Q [Ohm]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span>
            <span class="s2">&quot;Epk/Eacc []&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">epk</span><span class="p">,</span>
            <span class="s2">&quot;Bpk/Eacc [mT/MV/m]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpk</span><span class="p">,</span>
            <span class="s2">&quot;G [Ohm]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
            <span class="s2">&quot;GR/Q [Ohm^2]&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span>
        <span class="p">}</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\qois.json&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Model.save_fields"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.save_fields">[docs]</a>    <span class="k">def</span> <span class="nf">save_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wall</span><span class="p">,</span> <span class="n">job</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save mode fields</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wall</span>
<span class="sd">        job</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fieldfile1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\fieldfile1.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span>
                                 <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">fieldfile1</span>

        <span class="c1"># compute the peak electric field on the boundary or the rf power</span>
        <span class="c1"># load job</span>
        <span class="k">if</span> <span class="n">wall</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">job</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">E0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_cavity_field</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_coupler_field</span><span class="p">(</span><span class="n">wall</span><span class="p">)</span>

        <span class="c1"># normalize the fields</span>
        <span class="n">my0</span> <span class="o">=</span> <span class="mf">4e-7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">er</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">file</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">file</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">file</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">file</span><span class="p">[</span><span class="n">er</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">er</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> <span class="n">E0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">ez</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">ez</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> <span class="n">E0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file</span><span class="p">[</span><span class="n">bp</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">my0</span> <span class="o">*</span> <span class="n">file</span><span class="p">[</span><span class="n">bp</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> <span class="n">E0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fieldfile1</span> <span class="o">=</span> <span class="n">file</span>

        <span class="k">if</span> <span class="n">wall</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># save -ascii fieldfile1.n fieldfile1</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fieldfile1</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fieldfile1.n&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wall</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># save -ascii fieldfileE.n fieldfile1</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fieldfile1</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fieldfileE.n&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wall</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># save -ascii fieldfileH.n fieldfile1</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fieldfile1</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\fieldfileH.n&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.7E</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.peak_cavity_field"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.peak_cavity_field">[docs]</a>    <span class="k">def</span> <span class="nf">peak_cavity_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># load mesh and field solution</span>
        <span class="c1"># load mesh</span>
        <span class="c1"># load kama0</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\mesh.mat&quot;</span><span class="p">)</span>
        <span class="n">kama0</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\kama0.mat&quot;</span><span class="p">)</span>

        <span class="c1"># compute the field on the boundary</span>
        <span class="c1"># load geodata.n</span>
        <span class="n">geodata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\geodata.n&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span>
                              <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">geodata</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># r = r(ind)-5e-4</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.75e-4</span>  <span class="c1"># move points inside</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">geodata</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="n">rind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">zind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="n">alue</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># save zr z -v4</span>
        <span class="c1"># save zr r -append</span>
        <span class="c1"># save zr alue -append</span>
        <span class="c1"># save zr rind -append</span>
        <span class="c1"># save zr zind -append</span>

        <span class="n">zr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;alue&#39;</span><span class="p">:</span> <span class="n">alue</span><span class="p">,</span> <span class="s1">&#39;rind&#39;</span><span class="p">:</span> <span class="n">rind</span><span class="p">,</span> <span class="s1">&#39;zind&#39;</span><span class="p">:</span> <span class="n">zind</span><span class="p">}</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\zr.mat&#39;</span><span class="p">,</span> <span class="n">zr</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>

        <span class="c1"># compute the field at generated points</span>
        <span class="c1"># !copy /y kama0.mat kama.mat</span>
        <span class="c1"># !Multipac fields</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">multipacPath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\Multipac.exe&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">multipacPath</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">multipacPath</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>

        <span class="n">Er</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\Er.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;Er&#39;</span><span class="p">]</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\Ez.mat&quot;</span><span class="p">)[</span><span class="s1">&#39;Ez&#39;</span><span class="p">]</span>

        <span class="n">ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Er</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ez</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">E0</span></div>

<div class="viewcode-block" id="Model.search"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.search">[docs]</a>    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">korig</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">raja</span><span class="p">):</span>
        <span class="n">offset1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9</span>
        <span class="n">offset2</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">offset3</span> <span class="o">=</span> <span class="mf">0.9</span>

        <span class="n">laskuri</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">k1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset1</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset2</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k3</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset3</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ero2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">korig</span><span class="p">))</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">korig</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">ero1</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k1</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero1</span><span class="p">)</span>
        <span class="n">ero2</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero2</span><span class="p">)</span>
        <span class="n">ero3</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k3</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero3</span><span class="p">)</span>
        <span class="c1"># ic([s1 s2 s3])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;?????????????????????????????&#39;</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">([</span><span class="n">k1</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">k3</span><span class="p">[</span><span class="n">ind</span><span class="p">]])</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Can&#39;t compress enough&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s3</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">jatka</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">jatka</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jatka</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;problem, have not stretched enough, trying to fix&#39;</span><span class="p">)</span>
                <span class="n">offset1</span> <span class="o">=</span> <span class="n">offset1</span> <span class="o">-</span> <span class="mf">0.9</span>

                <span class="n">k3</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">offset3</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k1</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="n">offset1</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span>
                <span class="n">k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset1</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ero1</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k1</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero3</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">jatka</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;succeeded&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jatka</span> <span class="o">=</span> <span class="n">jatka</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">jatka</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;FAILED&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ero2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">raja</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">offset3</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset1</span> <span class="o">+</span> <span class="n">offset3</span><span class="p">)</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
            <span class="k">elif</span> <span class="n">s2</span> <span class="o">!=</span> <span class="n">s3</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">offset1</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset2</span> <span class="o">+</span> <span class="n">offset3</span><span class="p">)</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">s2</span>

            <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">siirto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset2</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ero2</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero2</span><span class="p">)</span>
            <span class="c1">#   #  ic([k(ind), ero2, offset2, siirto])</span>
            <span class="n">ic</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ero2</span><span class="p">,</span> <span class="n">siirto</span><span class="p">])</span>
        <span class="n">offset1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9</span>
        <span class="n">offset2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">offset3</span> <span class="o">=</span> <span class="mf">0.9</span>

        <span class="n">laskuri</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">k1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset1</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">siirto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset2</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">k3</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset3</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ero2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">korig</span><span class="p">))</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">korig</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># ero1 = korig-k1(ind) s1 = np.sign(ero1)</span>
        <span class="c1"># ero2 = korig-k(ind) s2 = np.sign(ero2)</span>
        <span class="c1"># ero3 = korig-k3(ind) s3 = np.sign(ero3)</span>
        <span class="c1"># #ic([s1 s2 s3])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;?????????????????????????????&#39;</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">([</span><span class="n">k1</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">k3</span><span class="p">[</span><span class="n">ind</span><span class="p">]])</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Can&#39;&#39;t compress enough&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s3</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">jatka</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">jatka</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jatka</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;problem, have not stretched enough, trying to fix&#39;</span><span class="p">)</span>
                <span class="n">offset1</span> <span class="o">=</span> <span class="n">offset1</span> <span class="o">-</span> <span class="mf">0.9</span>

                <span class="n">k3</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">offset3</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k1</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="n">offset1</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span>
                <span class="n">k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset1</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">ero1</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k1</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero3</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">jatka</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;succeeded&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jatka</span> <span class="o">=</span> <span class="n">jatka</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">jatka</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;FAILED&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ero2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">raja</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s1</span> <span class="o">!=</span> <span class="n">s2</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">offset3</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset1</span> <span class="o">+</span> <span class="n">offset3</span><span class="p">)</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span>
            <span class="k">elif</span> <span class="n">s2</span> <span class="o">!=</span> <span class="n">s3</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">s2</span>
                <span class="n">offset1</span> <span class="o">=</span> <span class="n">offset2</span>
                <span class="n">offset2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset2</span> <span class="o">+</span> <span class="n">offset3</span><span class="p">)</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">s2</span>

            <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">siirto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eee</span><span class="p">(</span><span class="n">offset2</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ero2</span> <span class="o">=</span> <span class="n">korig</span> <span class="o">-</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ero2</span><span class="p">)</span>
            <span class="c1">#  ic([k(ind), ero2, offset2, siirto])</span>
            <span class="n">ic</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ero2</span><span class="p">,</span> <span class="n">siirto</span><span class="p">])</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="c1"># # -----------------------------------------------------------------------</span>

        <span class="k">return</span> <span class="n">ind</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span></div>

<div class="viewcode-block" id="Model.eee"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.eee">[docs]</a>    <span class="k">def</span> <span class="nf">eee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">maara</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset</span><span class="p">}</span>
        <span class="c1"># save offset offset -v4</span>
        <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">/offset.mat&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="c1"># options.disp = 0</span>

        <span class="c1"># !eigenC_bin</span>

        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;self.eee: started eigenmode analysis&#39;</span><span class="p">)</span>
        <span class="n">eigenCpath</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\eigenC_bin.exe&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">eigenCpath</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">eigenCpath</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;self.eee: finised eigenmode analysis&#39;</span><span class="p">)</span>

        <span class="c1"># load o_eigen</span>
        <span class="c1"># load cinfo</span>
        <span class="n">o_eigen</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/o_eigen.mat&#39;</span><span class="p">)</span>
        <span class="n">cinfo</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">/cinfo.mat&#39;</span><span class="p">)[</span><span class="s1">&#39;cinfo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">cinfo</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;ia&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># mnatlab indices to python</span>
        <span class="n">ja</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;ja&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Aarvot</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;Aarvot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Barvot</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;Barvot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;nf&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">siirto</span> <span class="o">=</span> <span class="n">o_eigen</span><span class="p">[</span><span class="s1">&#39;siirto&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cinfo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;ran out of memory&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;unknown type element found in mesh&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;no compressible area found in mesh&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;could not compress mesh that much&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;could not add element in matrix&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;nodes in mesh were in wrong order&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cinfo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">7</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;unknown job&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;unknown error&#39;</span><span class="p">)</span>

        <span class="n">AA</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Aarvot</span><span class="p">,</span> <span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">ja</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Barvot</span><span class="p">,</span> <span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">ja</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="c1"># ic([offset, siirto])</span>

        <span class="n">d2</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">spsl</span><span class="o">.</span><span class="n">eigs</span><span class="p">(</span><span class="n">AA</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">BB</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">maara</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">show</span><span class="p">])</span>

        <span class="c1"># u = u2</span>
        <span class="c1"># for i = 1:n</span>
        <span class="c1">#   u(i,:) = u2(nf(i),:)</span>
        <span class="c1"># end</span>
        <span class="c1"># # --------------------------------------------------------------------</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">siirto</span></div>

<div class="viewcode-block" id="Model.normalize_u"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.normalize_u">[docs]</a>    <span class="k">def</span> <span class="nf">normalize_u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wall</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Inside normalize_u&quot;</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">wall</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">E0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak_cavity_field</span><span class="p">()</span>
            <span class="c1"># normalize u</span>
            <span class="n">kama0</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s2">\kama0.mat&quot;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">kama0</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">kama0</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">kama0</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">E0</span>

            <span class="n">kama_n</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">}</span>
            <span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="si">}</span><span class="s1">\kama_n.mat&#39;</span><span class="p">,</span> <span class="n">kama_n</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.run"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">req_mode_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_geometry</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">mid_cell</span><span class="p">,</span> <span class="n">end_cell_left</span><span class="p">,</span> <span class="n">end_cell_right</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="n">beampipe</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_mesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_field_solver</span><span class="p">(</span><span class="n">req_mode_num</span><span class="o">=</span><span class="n">req_mode_num</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Analysis ended.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.inttri"><a class="viewcode-back" href="../../../../analysis_modules.eigenmode.customEig.html#analysis_modules.eigenmode.customEig.run_field_solver.Model.inttri">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">inttri</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="c1"># function [X,W] = inttri(p)</span>
        <span class="c1">#</span>
        <span class="c1"># The program gives the sample points X as a (2,n)-matrix and</span>
        <span class="c1"># the weights W as an (n,1)-matrix for an integration over a</span>
        <span class="c1"># planar triangle with the vertices (0,0), (1,0) and (0,1).</span>
        <span class="c1"># The input argument p indicates the maximal degree of the poly-</span>
        <span class="c1"># nomials of two variables which will be integrated exactly</span>
        <span class="c1"># correctly, provided p&lt;20. By a linear transformation, X and</span>
        <span class="c1"># W are obtained from the paper: D.A. Dunavant: High degree</span>
        <span class="c1"># efficient symmetrical gaussian quadrature rules for the</span>
        <span class="c1"># triangle.- International Journal for Num. Methods in Eng.,</span>
        <span class="c1"># vol. 21, 1129-1148(1985).</span>
        <span class="c1"># ----------------------------------------------------------</span>
        <span class="c1"># CALLS TO none</span>
        <span class="c1"># 20 JUNI 1993:  Jukka Sarvas, Rolf Nevanlinna Institute</span>
        <span class="c1"># ----------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">16</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">18</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">19</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mi">19</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">5.00000000000000e-01</span><span class="p">],</span>
            <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.66666666666666e-01</span><span class="p">,</span> <span class="mf">6.66666666666667e-01</span><span class="p">,</span> <span class="mf">1.66666666666667e-01</span><span class="p">,</span> <span class="mf">6.66666666666667e-01</span><span class="p">,</span>
                  <span class="mf">1.66666666666667e-01</span><span class="p">,</span> <span class="mf">1.66666666666666e-01</span><span class="p">,</span> <span class="mf">1.66666666666667e-01</span><span class="p">,</span> <span class="mf">1.66666666666667e-01</span><span class="p">,</span>
                  <span class="mf">1.66666666666667e-01</span><span class="p">],</span>
            <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-0</span><span class="p">,</span> <span class="mf">2.00000000000000e-01</span><span class="p">,</span> <span class="mf">6.00000000000000e-01</span><span class="p">,</span> <span class="mf">2.00000000000000e-01</span><span class="p">,</span>
                  <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">6.00000000000000e-01</span><span class="p">,</span> <span class="mf">2.00000000000000e-01</span><span class="p">,</span> <span class="mf">2.00000000000000e-01</span><span class="p">,</span>
                  <span class="o">-</span><span class="mf">2.81250000000000e-01</span><span class="p">,</span> <span class="mf">2.60416666666667e-01</span><span class="p">,</span> <span class="mf">2.60416666666667e-01</span><span class="p">,</span> <span class="mf">2.60416666666667e-01</span><span class="p">],</span>
            <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.45948490915965e-01</span><span class="p">,</span> <span class="mf">9.15762135097699e-02</span><span class="p">,</span> <span class="mf">1.08103018168070e-01</span><span class="p">,</span> <span class="mf">8.16847572980459e-01</span><span class="p">,</span>
                  <span class="mf">4.45948490915965e-01</span><span class="p">,</span> <span class="mf">9.15762135097710e-02</span><span class="p">,</span> <span class="mf">1.08103018168070e-01</span><span class="p">,</span> <span class="mf">8.16847572980459e-01</span><span class="p">,</span>
                  <span class="mf">4.45948490915965e-01</span><span class="p">,</span> <span class="mf">9.15762135097710e-02</span><span class="p">,</span> <span class="mf">4.45948490915965e-01</span><span class="p">,</span> <span class="mf">9.15762135097699e-02</span><span class="p">,</span>
                  <span class="mf">1.11690794839006e-01</span><span class="p">,</span> <span class="mf">5.49758718276610e-02</span><span class="p">,</span> <span class="mf">1.11690794839006e-01</span><span class="p">,</span> <span class="mf">5.49758718276610e-02</span><span class="p">,</span>
                  <span class="mf">1.11690794839006e-01</span><span class="p">,</span> <span class="mf">5.49758718276610e-02</span><span class="p">],</span>
            <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.70142064105115e-01</span><span class="p">,</span> <span class="mf">1.01286507323457e-01</span><span class="p">,</span> <span class="mf">5.97158717897700e-02</span><span class="p">,</span>
                  <span class="mf">7.97426985353087e-01</span><span class="p">,</span> <span class="mf">4.70142064105115e-01</span><span class="p">,</span> <span class="mf">1.01286507323456e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span>
                  <span class="mf">5.97158717897700e-02</span><span class="p">,</span> <span class="mf">7.97426985353087e-01</span><span class="p">,</span> <span class="mf">4.70142064105115e-01</span><span class="p">,</span> <span class="mf">1.01286507323456e-01</span><span class="p">,</span>
                  <span class="mf">4.70142064105115e-01</span><span class="p">,</span> <span class="mf">1.01286507323457e-01</span><span class="p">,</span> <span class="mf">1.12500000000000e-01</span><span class="p">,</span> <span class="mf">6.61970763942530e-02</span><span class="p">,</span>
                  <span class="mf">6.29695902724135e-02</span><span class="p">,</span> <span class="mf">6.61970763942530e-02</span><span class="p">,</span> <span class="mf">6.29695902724135e-02</span><span class="p">,</span> <span class="mf">6.61970763942530e-02</span><span class="p">,</span>
                  <span class="mf">6.29695902724135e-02</span><span class="p">],</span>
            <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.49286745170911e-01</span><span class="p">,</span> <span class="mf">6.30890144915021e-02</span><span class="p">,</span> <span class="mf">5.01426509658179e-01</span><span class="p">,</span> <span class="mf">8.73821971016996e-01</span><span class="p">,</span>
                  <span class="mf">2.49286745170910e-01</span><span class="p">,</span> <span class="mf">6.30890144915020e-02</span><span class="p">,</span> <span class="mf">6.36502499121399e-01</span><span class="p">,</span> <span class="mf">3.10352451033784e-01</span><span class="p">,</span>
                  <span class="mf">5.31450498448170e-02</span><span class="p">,</span> <span class="mf">5.31450498448170e-02</span><span class="p">,</span> <span class="mf">3.10352451033784e-01</span><span class="p">,</span> <span class="mf">6.36502499121399e-01</span><span class="p">,</span>
                  <span class="mf">5.01426509658179e-01</span><span class="p">,</span> <span class="mf">8.73821971016996e-01</span><span class="p">,</span> <span class="mf">2.49286745170910e-01</span><span class="p">,</span> <span class="mf">6.30890144915020e-02</span><span class="p">,</span>
                  <span class="mf">2.49286745170911e-01</span><span class="p">,</span> <span class="mf">6.30890144915021e-02</span><span class="p">,</span> <span class="mf">5.31450498448170e-02</span><span class="p">,</span> <span class="mf">5.31450498448170e-02</span><span class="p">,</span>
                  <span class="mf">3.10352451033784e-01</span><span class="p">,</span> <span class="mf">6.36502499121399e-01</span><span class="p">,</span> <span class="mf">6.36502499121399e-01</span><span class="p">,</span> <span class="mf">3.10352451033784e-01</span><span class="p">,</span>
                  <span class="mf">5.83931378631895e-02</span><span class="p">,</span> <span class="mf">2.54224531851035e-02</span><span class="p">,</span> <span class="mf">5.83931378631895e-02</span><span class="p">,</span> <span class="mf">2.54224531851035e-02</span><span class="p">,</span>
                  <span class="mf">5.83931378631895e-02</span><span class="p">,</span> <span class="mf">2.54224531851035e-02</span><span class="p">,</span> <span class="mf">4.14255378091870e-02</span><span class="p">,</span> <span class="mf">4.14255378091870e-02</span><span class="p">,</span>
                  <span class="mf">4.14255378091870e-02</span><span class="p">,</span> <span class="mf">4.14255378091870e-02</span><span class="p">,</span> <span class="mf">4.14255378091870e-02</span><span class="p">,</span> <span class="mf">4.14255378091870e-02</span><span class="p">],</span>
            <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">2.60345966079040e-01</span><span class="p">,</span> <span class="mf">6.51301029022160e-02</span><span class="p">,</span> <span class="mf">4.79308067841920e-01</span><span class="p">,</span>
                  <span class="mf">8.69739794195568e-01</span><span class="p">,</span> <span class="mf">2.60345966079040e-01</span><span class="p">,</span> <span class="mf">6.51301029022160e-02</span><span class="p">,</span> <span class="mf">6.38444188569810e-01</span><span class="p">,</span>
                  <span class="mf">3.12865496004874e-01</span><span class="p">,</span> <span class="mf">4.86903154253160e-02</span><span class="p">,</span> <span class="mf">4.86903154253160e-02</span><span class="p">,</span> <span class="mf">3.12865496004874e-01</span><span class="p">,</span>
                  <span class="mf">6.38444188569810e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.79308067841920e-01</span><span class="p">,</span> <span class="mf">8.69739794195568e-01</span><span class="p">,</span>
                  <span class="mf">2.60345966079040e-01</span><span class="p">,</span> <span class="mf">6.51301029022160e-02</span><span class="p">,</span> <span class="mf">2.60345966079040e-01</span><span class="p">,</span> <span class="mf">6.51301029022160e-02</span><span class="p">,</span>
                  <span class="mf">4.86903154253160e-02</span><span class="p">,</span> <span class="mf">4.86903154253160e-02</span><span class="p">,</span> <span class="mf">3.12865496004874e-01</span><span class="p">,</span> <span class="mf">6.38444188569810e-01</span><span class="p">,</span>
                  <span class="mf">6.38444188569810e-01</span><span class="p">,</span> <span class="mf">3.12865496004874e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.47850222338410e-02</span><span class="p">,</span> <span class="mf">8.78076287166040e-02</span><span class="p">,</span>
                  <span class="mf">2.66736178044190e-02</span><span class="p">,</span> <span class="mf">8.78076287166040e-02</span><span class="p">,</span> <span class="mf">2.66736178044190e-02</span><span class="p">,</span> <span class="mf">8.78076287166040e-02</span><span class="p">,</span>
                  <span class="mf">2.66736178044190e-02</span><span class="p">,</span> <span class="mf">3.85568804451285e-02</span><span class="p">,</span> <span class="mf">3.85568804451285e-02</span><span class="p">,</span> <span class="mf">3.85568804451285e-02</span><span class="p">,</span>
                  <span class="mf">3.85568804451285e-02</span><span class="p">,</span> <span class="mf">3.85568804451285e-02</span><span class="p">,</span> <span class="mf">3.85568804451285e-02</span><span class="p">],</span>
            <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.59292588292723e-01</span><span class="p">,</span> <span class="mf">1.70569307751760e-01</span><span class="p">,</span> <span class="mf">5.05472283170311e-02</span><span class="p">,</span>
                  <span class="mf">8.14148234145540e-02</span><span class="p">,</span> <span class="mf">6.58861384496480e-01</span><span class="p">,</span> <span class="mf">8.98905543365938e-01</span><span class="p">,</span> <span class="mf">4.59292588292723e-01</span><span class="p">,</span>
                  <span class="mf">1.70569307751760e-01</span><span class="p">,</span> <span class="mf">5.05472283170310e-02</span><span class="p">,</span> <span class="mf">7.28492392955404e-01</span><span class="p">,</span> <span class="mf">2.63112829634638e-01</span><span class="p">,</span>
                  <span class="mf">8.39477740995800e-03</span><span class="p">,</span> <span class="mf">8.39477740995800e-03</span><span class="p">,</span> <span class="mf">2.63112829634638e-01</span><span class="p">,</span> <span class="mf">7.28492392955404e-01</span><span class="p">,</span>
                  <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">8.14148234145540e-02</span><span class="p">,</span> <span class="mf">6.58861384496480e-01</span><span class="p">,</span> <span class="mf">8.98905543365938e-01</span><span class="p">,</span>
                  <span class="mf">4.59292588292723e-01</span><span class="p">,</span> <span class="mf">1.70569307751760e-01</span><span class="p">,</span> <span class="mf">5.05472283170310e-02</span><span class="p">,</span> <span class="mf">4.59292588292723e-01</span><span class="p">,</span>
                  <span class="mf">1.70569307751760e-01</span><span class="p">,</span> <span class="mf">5.05472283170311e-02</span><span class="p">,</span> <span class="mf">8.39477740995800e-03</span><span class="p">,</span> <span class="mf">8.39477740995800e-03</span><span class="p">,</span>
                  <span class="mf">2.63112829634638e-01</span><span class="p">,</span> <span class="mf">7.28492392955404e-01</span><span class="p">,</span> <span class="mf">7.28492392955404e-01</span><span class="p">,</span> <span class="mf">2.63112829634638e-01</span><span class="p">,</span>
                  <span class="mf">7.21578038388935e-02</span><span class="p">,</span> <span class="mf">4.75458171336425e-02</span><span class="p">,</span> <span class="mf">5.16086852673590e-02</span><span class="p">,</span> <span class="mf">1.62292488115990e-02</span><span class="p">,</span>
                  <span class="mf">4.75458171336425e-02</span><span class="p">,</span> <span class="mf">5.16086852673590e-02</span><span class="p">,</span> <span class="mf">1.62292488115990e-02</span><span class="p">,</span> <span class="mf">4.75458171336425e-02</span><span class="p">,</span>
                  <span class="mf">5.16086852673590e-02</span><span class="p">,</span> <span class="mf">1.62292488115990e-02</span><span class="p">,</span> <span class="mf">1.36151570872175e-02</span><span class="p">,</span> <span class="mf">1.36151570872175e-02</span><span class="p">,</span>
                  <span class="mf">1.36151570872175e-02</span><span class="p">,</span> <span class="mf">1.36151570872175e-02</span><span class="p">,</span> <span class="mf">1.36151570872175e-02</span><span class="p">,</span> <span class="mf">1.36151570872175e-02</span><span class="p">],</span>
            <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.89682519198737e-01</span><span class="p">,</span> <span class="mf">4.37089591492936e-01</span><span class="p">,</span> <span class="mf">1.88203535619032e-01</span><span class="p">,</span>
                  <span class="mf">4.47295133944519e-02</span><span class="p">,</span> <span class="mf">2.06349616025250e-02</span><span class="p">,</span> <span class="mf">1.25820817014127e-01</span><span class="p">,</span> <span class="mf">6.23592928761935e-01</span><span class="p">,</span>
                  <span class="mf">9.10540973211095e-01</span><span class="p">,</span> <span class="mf">4.89682519198738e-01</span><span class="p">,</span> <span class="mf">4.37089591492937e-01</span><span class="p">,</span> <span class="mf">1.88203535619033e-01</span><span class="p">,</span>
                  <span class="mf">4.47295133944530e-02</span><span class="p">,</span> <span class="mf">7.41198598784498e-01</span><span class="p">,</span> <span class="mf">2.21962989160766e-01</span><span class="p">,</span> <span class="mf">3.68384120547360e-02</span><span class="p">,</span>
                  <span class="mf">3.68384120547360e-02</span><span class="p">,</span> <span class="mf">2.21962989160766e-01</span><span class="p">,</span> <span class="mf">7.41198598784498e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span>
                  <span class="mf">2.06349616025250e-02</span><span class="p">,</span> <span class="mf">1.25820817014127e-01</span><span class="p">,</span> <span class="mf">6.23592928761935e-01</span><span class="p">,</span> <span class="mf">9.10540973211095e-01</span><span class="p">,</span>
                  <span class="mf">4.89682519198738e-01</span><span class="p">,</span> <span class="mf">4.37089591492937e-01</span><span class="p">,</span> <span class="mf">1.88203535619033e-01</span><span class="p">,</span> <span class="mf">4.47295133944530e-02</span><span class="p">,</span>
                  <span class="mf">4.89682519198737e-01</span><span class="p">,</span> <span class="mf">4.37089591492936e-01</span><span class="p">,</span> <span class="mf">1.88203535619032e-01</span><span class="p">,</span> <span class="mf">4.47295133944519e-02</span><span class="p">,</span>
                  <span class="mf">3.68384120547360e-02</span><span class="p">,</span> <span class="mf">3.68384120547360e-02</span><span class="p">,</span> <span class="mf">2.21962989160766e-01</span><span class="p">,</span> <span class="mf">7.41198598784498e-01</span><span class="p">,</span>
                  <span class="mf">7.41198598784498e-01</span><span class="p">,</span> <span class="mf">2.21962989160766e-01</span><span class="p">,</span> <span class="mf">4.85678981413995e-02</span><span class="p">,</span> <span class="mf">1.56673501135695e-02</span><span class="p">,</span>
                  <span class="mf">3.89137705023870e-02</span><span class="p">,</span> <span class="mf">3.98238694636050e-02</span><span class="p">,</span> <span class="mf">1.27888378293490e-02</span><span class="p">,</span> <span class="mf">1.56673501135695e-02</span><span class="p">,</span>
                  <span class="mf">3.89137705023870e-02</span><span class="p">,</span> <span class="mf">3.98238694636050e-02</span><span class="p">,</span> <span class="mf">1.27888378293490e-02</span><span class="p">,</span> <span class="mf">1.56673501135695e-02</span><span class="p">,</span>
                  <span class="mf">3.89137705023870e-02</span><span class="p">,</span> <span class="mf">3.98238694636050e-02</span><span class="p">,</span> <span class="mf">1.27888378293490e-02</span><span class="p">,</span> <span class="mf">2.16417696886445e-02</span><span class="p">,</span>
                  <span class="mf">2.16417696886445e-02</span><span class="p">,</span> <span class="mf">2.16417696886445e-02</span><span class="p">,</span> <span class="mf">2.16417696886445e-02</span><span class="p">,</span> <span class="mf">2.16417696886445e-02</span><span class="p">,</span>
                  <span class="mf">2.16417696886445e-02</span><span class="p">],</span>
            <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.85577633383658e-01</span><span class="p">,</span> <span class="mf">1.09481575485037e-01</span><span class="p">,</span> <span class="mf">2.88447332326850e-02</span><span class="p">,</span>
                   <span class="mf">7.81036849029926e-01</span><span class="p">,</span> <span class="mf">4.85577633383657e-01</span><span class="p">,</span> <span class="mf">1.09481575485037e-01</span><span class="p">,</span> <span class="mf">5.50352941820999e-01</span><span class="p">,</span>
                   <span class="mf">7.28323904597411e-01</span><span class="p">,</span> <span class="mf">9.23655933587501e-01</span><span class="p">,</span> <span class="mf">3.07939838764121e-01</span><span class="p">,</span> <span class="mf">2.46672560639903e-01</span><span class="p">,</span>
                   <span class="mf">6.68032510122000e-02</span><span class="p">,</span> <span class="mf">1.41707219414880e-01</span><span class="p">,</span> <span class="mf">2.50035347626860e-02</span><span class="p">,</span> <span class="mf">9.54081540029900e-03</span><span class="p">,</span>
                   <span class="mf">1.41707219414880e-01</span><span class="p">,</span> <span class="mf">2.50035347626860e-02</span><span class="p">,</span> <span class="mf">9.54081540029900e-03</span><span class="p">,</span> <span class="mf">3.07939838764121e-01</span><span class="p">,</span>
                   <span class="mf">2.46672560639903e-01</span><span class="p">,</span> <span class="mf">6.68032510122000e-02</span><span class="p">,</span> <span class="mf">5.50352941820999e-01</span><span class="p">,</span> <span class="mf">7.28323904597411e-01</span><span class="p">,</span>
                   <span class="mf">9.23655933587501e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">2.88447332326850e-02</span><span class="p">,</span> <span class="mf">7.81036849029926e-01</span><span class="p">,</span>
                   <span class="mf">4.85577633383657e-01</span><span class="p">,</span> <span class="mf">1.09481575485037e-01</span><span class="p">,</span> <span class="mf">4.85577633383658e-01</span><span class="p">,</span> <span class="mf">1.09481575485037e-01</span><span class="p">,</span>
                   <span class="mf">1.41707219414880e-01</span><span class="p">,</span> <span class="mf">2.50035347626860e-02</span><span class="p">,</span> <span class="mf">9.54081540029900e-03</span><span class="p">,</span> <span class="mf">1.41707219414880e-01</span><span class="p">,</span>
                   <span class="mf">2.50035347626860e-02</span><span class="p">,</span> <span class="mf">9.54081540029900e-03</span><span class="p">,</span> <span class="mf">3.07939838764121e-01</span><span class="p">,</span> <span class="mf">2.46672560639903e-01</span><span class="p">,</span>
                   <span class="mf">6.68032510122000e-02</span><span class="p">,</span> <span class="mf">5.50352941820999e-01</span><span class="p">,</span> <span class="mf">7.28323904597411e-01</span><span class="p">,</span> <span class="mf">9.23655933587501e-01</span><span class="p">,</span>
                   <span class="mf">5.50352941820999e-01</span><span class="p">,</span> <span class="mf">7.28323904597411e-01</span><span class="p">,</span> <span class="mf">9.23655933587501e-01</span><span class="p">,</span> <span class="mf">3.07939838764121e-01</span><span class="p">,</span>
                   <span class="mf">2.46672560639903e-01</span><span class="p">,</span> <span class="mf">6.68032510122000e-02</span><span class="p">,</span> <span class="mf">4.54089951913770e-02</span><span class="p">,</span> <span class="mf">1.83629788782335e-02</span><span class="p">,</span>
                   <span class="mf">2.26605297177640e-02</span><span class="p">,</span> <span class="mf">1.83629788782335e-02</span><span class="p">,</span> <span class="mf">2.26605297177640e-02</span><span class="p">,</span> <span class="mf">1.83629788782335e-02</span><span class="p">,</span>
                   <span class="mf">2.26605297177640e-02</span><span class="p">,</span> <span class="mf">3.63789584227100e-02</span><span class="p">,</span> <span class="mf">1.41636212655285e-02</span><span class="p">,</span> <span class="mf">4.71083348186650e-03</span><span class="p">,</span>
                   <span class="mf">3.63789584227100e-02</span><span class="p">,</span> <span class="mf">1.41636212655285e-02</span><span class="p">,</span> <span class="mf">4.71083348186650e-03</span><span class="p">,</span> <span class="mf">3.63789584227100e-02</span><span class="p">,</span>
                   <span class="mf">1.41636212655285e-02</span><span class="p">,</span> <span class="mf">4.71083348186650e-03</span><span class="p">,</span> <span class="mf">3.63789584227100e-02</span><span class="p">,</span> <span class="mf">1.41636212655285e-02</span><span class="p">,</span>
                   <span class="mf">4.71083348186650e-03</span><span class="p">,</span> <span class="mf">3.63789584227100e-02</span><span class="p">,</span> <span class="mf">1.41636212655285e-02</span><span class="p">,</span> <span class="mf">4.71083348186650e-03</span><span class="p">,</span>
                   <span class="mf">3.63789584227100e-02</span><span class="p">,</span> <span class="mf">1.41636212655285e-02</span><span class="p">,</span> <span class="mf">4.71083348186650e-03</span><span class="p">],</span>
            <span class="s1">&#39;12&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.88217389773805e-01</span><span class="p">,</span> <span class="mf">4.39724392294461e-01</span><span class="p">,</span> <span class="mf">2.71210385012116e-01</span><span class="p">,</span> <span class="mf">1.27576145541586e-01</span><span class="p">,</span>
                   <span class="mf">2.13173504532110e-02</span><span class="p">,</span> <span class="mf">2.35652204523900e-02</span><span class="p">,</span> <span class="mf">1.20551215411079e-01</span><span class="p">,</span> <span class="mf">4.57579229975768e-01</span><span class="p">,</span>
                   <span class="mf">7.44847708916828e-01</span><span class="p">,</span> <span class="mf">9.57365299093579e-01</span><span class="p">,</span> <span class="mf">4.88217389773805e-01</span><span class="p">,</span> <span class="mf">4.39724392294460e-01</span><span class="p">,</span>
                   <span class="mf">2.71210385012116e-01</span><span class="p">,</span> <span class="mf">1.27576145541586e-01</span><span class="p">,</span> <span class="mf">2.13173504532100e-02</span><span class="p">,</span> <span class="mf">6.08943235779788e-01</span><span class="p">,</span>
                   <span class="mf">6.95836086787803e-01</span><span class="p">,</span> <span class="mf">8.58014033544073e-01</span><span class="p">,</span> <span class="mf">2.75713269685514e-01</span><span class="p">,</span> <span class="mf">2.81325580989940e-01</span><span class="p">,</span>
                   <span class="mf">1.16251915907597e-01</span><span class="p">,</span> <span class="mf">1.15343494534698e-01</span><span class="p">,</span> <span class="mf">2.28383322222570e-02</span><span class="p">,</span> <span class="mf">2.57340505483300e-02</span><span class="p">,</span>
                   <span class="mf">1.15343494534698e-01</span><span class="p">,</span> <span class="mf">2.28383322222570e-02</span><span class="p">,</span> <span class="mf">2.57340505483300e-02</span><span class="p">,</span> <span class="mf">2.75713269685514e-01</span><span class="p">,</span>
                   <span class="mf">2.81325580989940e-01</span><span class="p">,</span> <span class="mf">1.16251915907597e-01</span><span class="p">,</span> <span class="mf">6.08943235779788e-01</span><span class="p">,</span> <span class="mf">6.95836086787803e-01</span><span class="p">,</span>
                   <span class="mf">8.58014033544073e-01</span><span class="p">,</span> <span class="mf">2.35652204523900e-02</span><span class="p">,</span> <span class="mf">1.20551215411079e-01</span><span class="p">,</span> <span class="mf">4.57579229975768e-01</span><span class="p">,</span>
                   <span class="mf">7.44847708916828e-01</span><span class="p">,</span> <span class="mf">9.57365299093579e-01</span><span class="p">,</span> <span class="mf">4.88217389773805e-01</span><span class="p">,</span> <span class="mf">4.39724392294460e-01</span><span class="p">,</span>
                   <span class="mf">2.71210385012116e-01</span><span class="p">,</span> <span class="mf">1.27576145541586e-01</span><span class="p">,</span> <span class="mf">2.13173504532100e-02</span><span class="p">,</span> <span class="mf">4.88217389773805e-01</span><span class="p">,</span>
                   <span class="mf">4.39724392294461e-01</span><span class="p">,</span> <span class="mf">2.71210385012116e-01</span><span class="p">,</span> <span class="mf">1.27576145541586e-01</span><span class="p">,</span> <span class="mf">2.13173504532110e-02</span><span class="p">,</span>
                   <span class="mf">1.15343494534698e-01</span><span class="p">,</span> <span class="mf">2.28383322222570e-02</span><span class="p">,</span> <span class="mf">2.57340505483300e-02</span><span class="p">,</span> <span class="mf">1.15343494534698e-01</span><span class="p">,</span>
                   <span class="mf">2.28383322222570e-02</span><span class="p">,</span> <span class="mf">2.57340505483300e-02</span><span class="p">,</span> <span class="mf">2.75713269685514e-01</span><span class="p">,</span> <span class="mf">2.81325580989940e-01</span><span class="p">,</span>
                   <span class="mf">1.16251915907597e-01</span><span class="p">,</span> <span class="mf">6.08943235779788e-01</span><span class="p">,</span> <span class="mf">6.95836086787803e-01</span><span class="p">,</span> <span class="mf">8.58014033544073e-01</span><span class="p">,</span>
                   <span class="mf">6.08943235779788e-01</span><span class="p">,</span> <span class="mf">6.95836086787803e-01</span><span class="p">,</span> <span class="mf">8.58014033544073e-01</span><span class="p">,</span> <span class="mf">2.75713269685514e-01</span><span class="p">,</span>
                   <span class="mf">2.81325580989940e-01</span><span class="p">,</span> <span class="mf">1.16251915907597e-01</span><span class="p">,</span> <span class="mf">1.28655332202275e-02</span><span class="p">,</span> <span class="mf">2.18462722690190e-02</span><span class="p">,</span>
                   <span class="mf">3.14291121089425e-02</span><span class="p">,</span> <span class="mf">1.73980564653545e-02</span><span class="p">,</span> <span class="mf">3.08313052577950e-03</span><span class="p">,</span> <span class="mf">1.28655332202275e-02</span><span class="p">,</span>
                   <span class="mf">2.18462722690190e-02</span><span class="p">,</span> <span class="mf">3.14291121089425e-02</span><span class="p">,</span> <span class="mf">1.73980564653545e-02</span><span class="p">,</span> <span class="mf">3.08313052577950e-03</span><span class="p">,</span>
                   <span class="mf">1.28655332202275e-02</span><span class="p">,</span> <span class="mf">2.18462722690190e-02</span><span class="p">,</span> <span class="mf">3.14291121089425e-02</span><span class="p">,</span> <span class="mf">1.73980564653545e-02</span><span class="p">,</span>
                   <span class="mf">3.08313052577950e-03</span><span class="p">,</span> <span class="mf">2.01857788831905e-02</span><span class="p">,</span> <span class="mf">1.11783866011515e-02</span><span class="p">,</span> <span class="mf">8.65811555432950e-03</span><span class="p">,</span>
                   <span class="mf">2.01857788831905e-02</span><span class="p">,</span> <span class="mf">1.11783866011515e-02</span><span class="p">,</span> <span class="mf">8.65811555432950e-03</span><span class="p">,</span> <span class="mf">2.01857788831905e-02</span><span class="p">,</span>
                   <span class="mf">1.11783866011515e-02</span><span class="p">,</span> <span class="mf">8.65811555432950e-03</span><span class="p">,</span> <span class="mf">2.01857788831905e-02</span><span class="p">,</span> <span class="mf">1.11783866011515e-02</span><span class="p">,</span>
                   <span class="mf">8.65811555432950e-03</span><span class="p">,</span> <span class="mf">2.01857788831905e-02</span><span class="p">,</span> <span class="mf">1.11783866011515e-02</span><span class="p">,</span> <span class="mf">8.65811555432950e-03</span><span class="p">,</span>
                   <span class="mf">2.01857788831905e-02</span><span class="p">,</span> <span class="mf">1.11783866011515e-02</span><span class="p">,</span> <span class="mf">8.65811555432950e-03</span><span class="p">],</span>
            <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">4.95048184939704e-01</span><span class="p">,</span> <span class="mf">4.68716635109574e-01</span><span class="p">,</span> <span class="mf">4.14521336801276e-01</span><span class="p">,</span>
                   <span class="mf">2.29399572042832e-01</span><span class="p">,</span> <span class="mf">1.14424495196330e-01</span><span class="p">,</span> <span class="mf">2.48113913634590e-02</span><span class="p">,</span> <span class="mf">9.90363012059100e-03</span><span class="p">,</span>
                   <span class="mf">6.25667297808520e-02</span><span class="p">,</span> <span class="mf">1.70957326397447e-01</span><span class="p">,</span> <span class="mf">5.41200855914337e-01</span><span class="p">,</span> <span class="mf">7.71151009607340e-01</span><span class="p">,</span>
                   <span class="mf">9.50377217273082e-01</span><span class="p">,</span> <span class="mf">4.95048184939705e-01</span><span class="p">,</span> <span class="mf">4.68716635109574e-01</span><span class="p">,</span> <span class="mf">4.14521336801277e-01</span><span class="p">,</span>
                   <span class="mf">2.29399572042831e-01</span><span class="p">,</span> <span class="mf">1.14424495196330e-01</span><span class="p">,</span> <span class="mf">2.48113913634590e-02</span><span class="p">,</span> <span class="mf">6.36351174561660e-01</span><span class="p">,</span>
                   <span class="mf">6.90169159986905e-01</span><span class="p">,</span> <span class="mf">8.51409537834241e-01</span><span class="p">,</span> <span class="mf">2.68794997058761e-01</span><span class="p">,</span> <span class="mf">2.91730066734288e-01</span><span class="p">,</span>
                   <span class="mf">1.26357385491669e-01</span><span class="p">,</span> <span class="mf">9.48538283795790e-02</span><span class="p">,</span> <span class="mf">1.81007732788070e-02</span><span class="p">,</span> <span class="mf">2.22330766740900e-02</span><span class="p">,</span>
                   <span class="mf">9.48538283795790e-02</span><span class="p">,</span> <span class="mf">1.81007732788070e-02</span><span class="p">,</span> <span class="mf">2.22330766740900e-02</span><span class="p">,</span> <span class="mf">2.68794997058761e-01</span><span class="p">,</span>
                   <span class="mf">2.91730066734288e-01</span><span class="p">,</span> <span class="mf">1.26357385491669e-01</span><span class="p">,</span> <span class="mf">6.36351174561660e-01</span><span class="p">,</span> <span class="mf">6.90169159986905e-01</span><span class="p">,</span>
                   <span class="mf">8.51409537834241e-01</span><span class="p">,</span> <span class="mf">3.33333333333333e-01</span><span class="p">,</span> <span class="mf">9.90363012059100e-03</span><span class="p">,</span> <span class="mf">6.25667297808520e-02</span><span class="p">,</span>
                   <span class="mf">1.70957326397447e-01</span><span class="p">,</span> <span class="mf">5.41200855914337e-01</span><span class="p">,</span> <span class="mf">7.71151009607340e-01</span><span class="p">,</span> <span class="mf">9.50377217273082e-01</span><span class="p">,</span>
                   <span class="mf">4.95048184939705e-01</span><span class="p">,</span> <span class="mf">4.68716635109574e-01</span><span class="p">,</span> <span class="mf">4.14521336801277e-01</span><span class="p">,</span> <span class="mf">2.29399572042831e-01</span><span class="p">,</span>
                   <span class="mf">1.14424495196330e-01</span><span class="p">,</span> <span class="mf">2.48113913634590e-02</span><span class="p">,</span> <span class="mf">4.95048184939704e-01</span><span class="p">,</span> <span class="mf">4.68716635109574e-01</span><span class="p">,</span>
                   <span class="mf">4.14521336801276e-01</span><span class="p">,</span> <span class="mf">2.29399572042832e-01</span><span class="p">,</span> <span class="mf">1.14424495196330e-01</span><span class="p">,</span> <span class="mf">2.48113913634590e-02</span><span class="p">,</span>
                   <span class="mf">9.48538283795790e-02</span><span class="p">,</span> <span class="mf">1.81007732788070e-02</span><span class="p">,</span> <span class="mf">2.22330766740900e-02</span><span class="p">,</span> <span class="mf">9.48538283795790e-02</span><span class="p">,</span>
                   <span class="mf">1.81007732788070e-02</span><span class="p">,</span> <span class="mf">2.22330766740900e-02</span><span class="p">,</span> <span class="mf">2.68794997058761e-01</span><span class="p">,</span> <span class="mf">2.91730066734288e-01</span><span class="p">,</span>
                   <span class="mf">1.26357385491669e-01</span><span class="p">,</span> <span class="mf">6.36351174561660e-01</span><span class="p">,</span> <span class="mf">6.90169159986905e-01</span><span class="p">,</span> <span class="mf">8.51409537834241e-01</span><span class="p">,</span>
                   <span class="mf">6.36351174561660e-01</span><span class="p">,</span> <span class="mf">6.90169159986905e-01</span><span class="p">,</span> <span class="mf">8.51409537834241e-01</span><span class="p">,</span> <span class="mf">2.68794997058761e-01</span><span class="p">,</span>
                   <span class="mf">2.91730066734288e-01</span><span class="p">,</span> <span class="mf">1.26357385491669e-01</span><span class="p">,</span> <span class="mf">2.62604617004010e-02</span><span class="p">,</span> <span class="mf">5.64007260466500e-03</span><span class="p">,</span>
                   <span class="mf">1.57117591812270e-02</span><span class="p">,</span> <span class="mf">2.35362512520970e-02</span><span class="p">,</span> <span class="mf">2.36817932681775e-02</span><span class="p">,</span> <span class="mf">1.55837645228970e-02</span><span class="p">,</span>
                   <span class="mf">3.98788573253700e-03</span><span class="p">,</span> <span class="mf">5.64007260466500e-03</span><span class="p">,</span> <span class="mf">1.57117591812270e-02</span><span class="p">,</span> <span class="mf">2.35362512520970e-02</span><span class="p">,</span>
                   <span class="mf">2.36817932681775e-02</span><span class="p">,</span> <span class="mf">1.55837645228970e-02</span><span class="p">,</span> <span class="mf">3.98788573253700e-03</span><span class="p">,</span> <span class="mf">5.64007260466500e-03</span><span class="p">,</span>
                   <span class="mf">1.57117591812270e-02</span><span class="p">,</span> <span class="mf">2.35362512520970e-02</span><span class="p">,</span> <span class="mf">2.36817932681775e-02</span><span class="p">,</span> <span class="mf">1.55837645228970e-02</span><span class="p">,</span>
                   <span class="mf">3.98788573253700e-03</span><span class="p">,</span> <span class="mf">1.84242013643660e-02</span><span class="p">,</span> <span class="mf">8.70073165191100e-03</span><span class="p">,</span> <span class="mf">7.76089341952250e-03</span><span class="p">,</span>
                   <span class="mf">1.84242013643660e-02</span><span class="p">,</span> <span class="mf">8.70073165191100e-03</span><span class="p">,</span> <span class="mf">7.76089341952250e-03</span><span class="p">,</span> <span class="mf">1.84242013643660e-02</span><span class="p">,</span>
                   <span class="mf">8.70073165191100e-03</span><span class="p">,</span> <span class="mf">7.76089341952250e-03</span><span class="p">,</span> <span class="mf">1.84242013643660e-02</span><span class="p">,</span> <span class="mf">8.70073165191100e-03</span><span class="p">,</span>
                   <span class="mf">7.76089341952250e-03</span><span class="p">,</span> <span class="mf">1.84242013643660e-02</span><span class="p">,</span> <span class="mf">8.70073165191100e-03</span><span class="p">,</span> <span class="mf">7.76089341952250e-03</span><span class="p">,</span>
                   <span class="mf">1.84242013643660e-02</span><span class="p">,</span> <span class="mf">8.70073165191100e-03</span><span class="p">,</span> <span class="mf">7.76089341952250e-03</span><span class="p">],</span>
            <span class="s2">&quot;14&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.8896391036217808e-001</span><span class="p">,</span> <span class="mf">4.1764471934045408e-001</span><span class="p">,</span> <span class="mf">2.7347752830883808e-001</span><span class="p">,</span> <span class="mf">1.7720553241254400e-001</span><span class="p">,</span>
                   <span class="mf">6.1799883090871952e-002</span><span class="p">,</span> <span class="mf">1.9390961248700980e-002</span><span class="p">,</span> <span class="mf">2.2072179275642996e-002</span><span class="p">,</span> <span class="mf">1.6471056131909198e-001</span><span class="p">,</span>
                   <span class="mf">4.5304494338232296e-001</span><span class="p">,</span> <span class="mf">6.4558893517491304e-001</span><span class="p">,</span> <span class="mf">8.7640023381825504e-001</span><span class="p">,</span> <span class="mf">9.6121807750259808e-001</span><span class="p">,</span>
                   <span class="mf">4.8896391036217896e-001</span><span class="p">,</span> <span class="mf">4.1764471934045392e-001</span><span class="p">,</span> <span class="mf">2.7347752830883896e-001</span><span class="p">,</span> <span class="mf">1.7720553241254300e-001</span><span class="p">,</span>
                   <span class="mf">6.1799883090873000e-002</span><span class="p">,</span> <span class="mf">1.9390961248701000e-002</span><span class="p">,</span> <span class="mf">7.7060855477499600e-001</span><span class="p">,</span> <span class="mf">5.7022229084668320e-001</span><span class="p">,</span>
                   <span class="mf">6.8698016780808800e-001</span><span class="p">,</span> <span class="mf">8.7975717137017088e-001</span><span class="p">,</span> <span class="mf">1.7226668782135598e-001</span><span class="p">,</span> <span class="mf">3.3686145979634492e-001</span><span class="p">,</span>
                   <span class="mf">2.9837288213625800e-001</span><span class="p">,</span> <span class="mf">1.1897449769695700e-001</span><span class="p">,</span> <span class="mf">5.7124757403647992e-002</span><span class="p">,</span> <span class="mf">9.2916249356971984e-002</span><span class="p">,</span>
                   <span class="mf">1.4646950055654000e-002</span><span class="p">,</span> <span class="mf">1.2683309328720000e-003</span><span class="p">,</span> <span class="mf">5.7124757403647992e-002</span><span class="p">,</span> <span class="mf">9.2916249356971984e-002</span><span class="p">,</span>
                   <span class="mf">1.4646950055654000e-002</span><span class="p">,</span> <span class="mf">1.2683309328720000e-003</span><span class="p">,</span> <span class="mf">1.7226668782135598e-001</span><span class="p">,</span> <span class="mf">3.3686145979634492e-001</span><span class="p">,</span>
                   <span class="mf">2.9837288213625800e-001</span><span class="p">,</span> <span class="mf">1.1897449769695700e-001</span><span class="p">,</span> <span class="mf">7.7060855477499600e-001</span><span class="p">,</span> <span class="mf">5.7022229084668320e-001</span><span class="p">,</span>
                   <span class="mf">6.8698016780808800e-001</span><span class="p">,</span> <span class="mf">8.7975717137017088e-001</span><span class="p">,</span> <span class="mf">2.2072179275642996e-002</span><span class="p">,</span> <span class="mf">1.6471056131909198e-001</span><span class="p">,</span>
                   <span class="mf">4.5304494338232296e-001</span><span class="p">,</span> <span class="mf">6.4558893517491304e-001</span><span class="p">,</span> <span class="mf">8.7640023381825504e-001</span><span class="p">,</span> <span class="mf">9.6121807750259808e-001</span><span class="p">,</span>
                   <span class="mf">4.8896391036217896e-001</span><span class="p">,</span> <span class="mf">4.1764471934045392e-001</span><span class="p">,</span> <span class="mf">2.7347752830883896e-001</span><span class="p">,</span> <span class="mf">1.7720553241254300e-001</span><span class="p">,</span>
                   <span class="mf">6.1799883090873000e-002</span><span class="p">,</span> <span class="mf">1.9390961248701000e-002</span><span class="p">,</span> <span class="mf">4.8896391036217808e-001</span><span class="p">,</span> <span class="mf">4.1764471934045408e-001</span><span class="p">,</span>
                   <span class="mf">2.7347752830883808e-001</span><span class="p">,</span> <span class="mf">1.7720553241254400e-001</span><span class="p">,</span> <span class="mf">6.1799883090871952e-002</span><span class="p">,</span> <span class="mf">1.9390961248700980e-002</span><span class="p">,</span>
                   <span class="mf">5.7124757403647992e-002</span><span class="p">,</span> <span class="mf">9.2916249356971984e-002</span><span class="p">,</span> <span class="mf">1.4646950055654000e-002</span><span class="p">,</span> <span class="mf">1.2683309328720000e-003</span><span class="p">,</span>
                   <span class="mf">5.7124757403647992e-002</span><span class="p">,</span> <span class="mf">9.2916249356971984e-002</span><span class="p">,</span> <span class="mf">1.4646950055654000e-002</span><span class="p">,</span> <span class="mf">1.2683309328720000e-003</span><span class="p">,</span>
                   <span class="mf">1.7226668782135598e-001</span><span class="p">,</span> <span class="mf">3.3686145979634492e-001</span><span class="p">,</span> <span class="mf">2.9837288213625800e-001</span><span class="p">,</span> <span class="mf">1.1897449769695700e-001</span><span class="p">,</span>
                   <span class="mf">7.7060855477499600e-001</span><span class="p">,</span> <span class="mf">5.7022229084668320e-001</span><span class="p">,</span> <span class="mf">6.8698016780808800e-001</span><span class="p">,</span> <span class="mf">8.7975717137017088e-001</span><span class="p">,</span>
                   <span class="mf">7.7060855477499600e-001</span><span class="p">,</span> <span class="mf">5.7022229084668320e-001</span><span class="p">,</span> <span class="mf">6.8698016780808800e-001</span><span class="p">,</span> <span class="mf">8.7975717137017088e-001</span><span class="p">,</span>
                   <span class="mf">1.7226668782135598e-001</span><span class="p">,</span> <span class="mf">3.3686145979634492e-001</span><span class="p">,</span> <span class="mf">2.9837288213625800e-001</span><span class="p">,</span> <span class="mf">1.1897449769695700e-001</span><span class="p">,</span>
                   <span class="mf">1.0941790684714502e-002</span><span class="p">,</span> <span class="mf">1.6394176772062500e-002</span><span class="p">,</span> <span class="mf">2.5887052253645996e-002</span><span class="p">,</span> <span class="mf">2.1081294368496500e-002</span><span class="p">,</span>
                   <span class="mf">7.2168498348885008e-003</span><span class="p">,</span> <span class="mf">2.4617018011999996e-003</span><span class="p">,</span> <span class="mf">1.0941790684714502e-002</span><span class="p">,</span> <span class="mf">1.6394176772062500e-002</span><span class="p">,</span>
                   <span class="mf">2.5887052253645996e-002</span><span class="p">,</span> <span class="mf">2.1081294368496500e-002</span><span class="p">,</span> <span class="mf">7.2168498348885008e-003</span><span class="p">,</span> <span class="mf">2.4617018011999996e-003</span><span class="p">,</span>
                   <span class="mf">1.0941790684714502e-002</span><span class="p">,</span> <span class="mf">1.6394176772062500e-002</span><span class="p">,</span> <span class="mf">2.5887052253645996e-002</span><span class="p">,</span> <span class="mf">2.1081294368496500e-002</span><span class="p">,</span>
                   <span class="mf">7.2168498348885008e-003</span><span class="p">,</span> <span class="mf">2.4617018011999996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">,</span> <span class="mf">1.2332876606282000e-002</span><span class="p">,</span> <span class="mf">1.9285755393530500e-002</span><span class="p">,</span>
                   <span class="mf">7.2181540567669984e-003</span><span class="p">,</span> <span class="mf">2.5051144192504996e-003</span><span class="p">],</span>
            <span class="s1">&#39;17&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.3333333333333332e-001</span><span class="p">,</span> <span class="mf">4.9717054055677400e-001</span><span class="p">,</span> <span class="mf">4.8217632262462408e-001</span><span class="p">,</span> <span class="mf">4.5023996902078096e-001</span><span class="p">,</span>
                   <span class="mf">4.0026623937739688e-001</span><span class="p">,</span> <span class="mf">2.5214126797095200e-001</span><span class="p">,</span> <span class="mf">1.6204700465846200e-001</span><span class="p">,</span> <span class="mf">7.5875882260746080e-002</span><span class="p">,</span>
                   <span class="mf">1.5654726967821994e-002</span><span class="p">,</span> <span class="mf">5.6589188864519992e-003</span><span class="p">,</span> <span class="mf">3.5647354750751004e-002</span><span class="p">,</span> <span class="mf">9.9520061958437008e-002</span><span class="p">,</span>
                   <span class="mf">1.9946752124520604e-001</span><span class="p">,</span> <span class="mf">4.9571746405809496e-001</span><span class="p">,</span> <span class="mf">6.7590599068307696e-001</span><span class="p">,</span> <span class="mf">8.4824823547850784e-001</span><span class="p">,</span>
                   <span class="mf">9.6869054606435600e-001</span><span class="p">,</span> <span class="mf">4.9717054055677400e-001</span><span class="p">,</span> <span class="mf">4.8217632262462496e-001</span><span class="p">,</span> <span class="mf">4.5023996902078208e-001</span><span class="p">,</span>
                   <span class="mf">4.0026623937739704e-001</span><span class="p">,</span> <span class="mf">2.5214126797095300e-001</span><span class="p">,</span> <span class="mf">1.6204700465846100e-001</span><span class="p">,</span> <span class="mf">7.5875882260746000e-002</span><span class="p">,</span>
                   <span class="mf">1.5654726967822000e-002</span><span class="p">,</span> <span class="mf">6.5549320380942296e-001</span><span class="p">,</span> <span class="mf">5.7233759053202008e-001</span><span class="p">,</span> <span class="mf">6.2600119028622704e-001</span><span class="p">,</span>
                   <span class="mf">7.9642721497407104e-001</span><span class="p">,</span> <span class="mf">7.5235100593773008e-001</span><span class="p">,</span> <span class="mf">9.0462550409560800e-001</span><span class="p">,</span> <span class="mf">3.3431986736365804e-001</span><span class="p">,</span>
                   <span class="mf">2.9222153779694400e-001</span><span class="p">,</span> <span class="mf">3.1957488542319000e-001</span><span class="p">,</span> <span class="mf">1.9070422419229200e-001</span><span class="p">,</span> <span class="mf">1.8048321164874596e-001</span><span class="p">,</span>
                   <span class="mf">8.0711313679564016e-002</span><span class="p">,</span> <span class="mf">1.0186928826919000e-002</span><span class="p">,</span> <span class="mf">1.3544087167103600e-001</span><span class="p">,</span> <span class="mf">5.4423924290583000e-002</span><span class="p">,</span>
                   <span class="mf">1.2868560833637000e-002</span><span class="p">,</span> <span class="mf">6.7165782413524000e-002</span><span class="p">,</span> <span class="mf">1.4663182224828000e-002</span><span class="p">,</span> <span class="mf">1.0186928826919000e-002</span><span class="p">,</span>
                   <span class="mf">1.3544087167103600e-001</span><span class="p">,</span> <span class="mf">5.4423924290583000e-002</span><span class="p">,</span> <span class="mf">1.2868560833637000e-002</span><span class="p">,</span> <span class="mf">6.7165782413524000e-002</span><span class="p">,</span>
                   <span class="mf">1.4663182224828000e-002</span><span class="p">,</span> <span class="mf">3.3431986736365804e-001</span><span class="p">,</span> <span class="mf">2.9222153779694400e-001</span><span class="p">,</span> <span class="mf">3.1957488542319000e-001</span><span class="p">,</span>
                   <span class="mf">1.9070422419229200e-001</span><span class="p">,</span> <span class="mf">1.8048321164874596e-001</span><span class="p">,</span> <span class="mf">8.0711313679564016e-002</span><span class="p">,</span> <span class="mf">6.5549320380942296e-001</span><span class="p">,</span>
                   <span class="mf">5.7233759053202008e-001</span><span class="p">,</span> <span class="mf">6.2600119028622704e-001</span><span class="p">,</span> <span class="mf">7.9642721497407104e-001</span><span class="p">,</span> <span class="mf">7.5235100593773008e-001</span><span class="p">,</span>
                   <span class="mf">9.0462550409560800e-001</span><span class="p">,</span> <span class="mf">3.3333333333333332e-001</span><span class="p">,</span> <span class="mf">5.6589188864519992e-003</span><span class="p">,</span> <span class="mf">3.5647354750751004e-002</span><span class="p">,</span>
                   <span class="mf">9.9520061958437008e-002</span><span class="p">,</span> <span class="mf">1.9946752124520604e-001</span><span class="p">,</span> <span class="mf">4.9571746405809496e-001</span><span class="p">,</span> <span class="mf">6.7590599068307696e-001</span><span class="p">,</span>
                   <span class="mf">8.4824823547850784e-001</span><span class="p">,</span> <span class="mf">9.6869054606435600e-001</span><span class="p">,</span> <span class="mf">4.9717054055677400e-001</span><span class="p">,</span> <span class="mf">4.8217632262462496e-001</span><span class="p">,</span>
                   <span class="mf">4.5023996902078208e-001</span><span class="p">,</span> <span class="mf">4.0026623937739704e-001</span><span class="p">,</span> <span class="mf">2.5214126797095300e-001</span><span class="p">,</span> <span class="mf">1.6204700465846100e-001</span><span class="p">,</span>
                   <span class="mf">7.5875882260746000e-002</span><span class="p">,</span> <span class="mf">1.5654726967822000e-002</span><span class="p">,</span> <span class="mf">4.9717054055677400e-001</span><span class="p">,</span> <span class="mf">4.8217632262462408e-001</span><span class="p">,</span>
                   <span class="mf">4.5023996902078096e-001</span><span class="p">,</span> <span class="mf">4.0026623937739688e-001</span><span class="p">,</span> <span class="mf">2.5214126797095200e-001</span><span class="p">,</span> <span class="mf">1.6204700465846200e-001</span><span class="p">,</span>
                   <span class="mf">7.5875882260746080e-002</span><span class="p">,</span> <span class="mf">1.5654726967821994e-002</span><span class="p">,</span> <span class="mf">1.0186928826919000e-002</span><span class="p">,</span> <span class="mf">1.3544087167103600e-001</span><span class="p">,</span>
                   <span class="mf">5.4423924290583000e-002</span><span class="p">,</span> <span class="mf">1.2868560833637000e-002</span><span class="p">,</span> <span class="mf">6.7165782413524000e-002</span><span class="p">,</span> <span class="mf">1.4663182224828000e-002</span><span class="p">,</span>
                   <span class="mf">1.0186928826919000e-002</span><span class="p">,</span> <span class="mf">1.3544087167103600e-001</span><span class="p">,</span> <span class="mf">5.4423924290583000e-002</span><span class="p">,</span> <span class="mf">1.2868560833637000e-002</span><span class="p">,</span>
                   <span class="mf">6.7165782413524000e-002</span><span class="p">,</span> <span class="mf">1.4663182224828000e-002</span><span class="p">,</span> <span class="mf">3.3431986736365804e-001</span><span class="p">,</span> <span class="mf">2.9222153779694400e-001</span><span class="p">,</span>
                   <span class="mf">3.1957488542319000e-001</span><span class="p">,</span> <span class="mf">1.9070422419229200e-001</span><span class="p">,</span> <span class="mf">1.8048321164874596e-001</span><span class="p">,</span> <span class="mf">8.0711313679564016e-002</span><span class="p">,</span>
                   <span class="mf">6.5549320380942296e-001</span><span class="p">,</span> <span class="mf">5.7233759053202008e-001</span><span class="p">,</span> <span class="mf">6.2600119028622704e-001</span><span class="p">,</span> <span class="mf">7.9642721497407104e-001</span><span class="p">,</span>
                   <span class="mf">7.5235100593773008e-001</span><span class="p">,</span> <span class="mf">9.0462550409560800e-001</span><span class="p">,</span> <span class="mf">6.5549320380942296e-001</span><span class="p">,</span> <span class="mf">5.7233759053202008e-001</span><span class="p">,</span>
                   <span class="mf">6.2600119028622704e-001</span><span class="p">,</span> <span class="mf">7.9642721497407104e-001</span><span class="p">,</span> <span class="mf">7.5235100593773008e-001</span><span class="p">,</span> <span class="mf">9.0462550409560800e-001</span><span class="p">,</span>
                   <span class="mf">3.3431986736365804e-001</span><span class="p">,</span> <span class="mf">2.9222153779694400e-001</span><span class="p">,</span> <span class="mf">3.1957488542319000e-001</span><span class="p">,</span> <span class="mf">1.9070422419229200e-001</span><span class="p">,</span>
                   <span class="mf">1.8048321164874596e-001</span><span class="p">,</span> <span class="mf">8.0711313679564016e-002</span><span class="p">,</span> <span class="mf">1.6718599645401496e-002</span><span class="p">,</span> <span class="mf">2.5467077202534996e-003</span><span class="p">,</span>
                   <span class="mf">7.3354322638190000e-003</span><span class="p">,</span> <span class="mf">1.2175439176836000e-002</span><span class="p">,</span> <span class="mf">1.5553775434484498e-002</span><span class="p">,</span> <span class="mf">1.5628555609310000e-002</span><span class="p">,</span>
                   <span class="mf">1.2407827169832500e-002</span><span class="p">,</span> <span class="mf">7.0280365352784992e-003</span><span class="p">,</span> <span class="mf">1.5973380868895002e-003</span><span class="p">,</span> <span class="mf">2.5467077202534996e-003</span><span class="p">,</span>
                   <span class="mf">7.3354322638190000e-003</span><span class="p">,</span> <span class="mf">1.2175439176836000e-002</span><span class="p">,</span> <span class="mf">1.5553775434484498e-002</span><span class="p">,</span> <span class="mf">1.5628555609310000e-002</span><span class="p">,</span>
                   <span class="mf">1.2407827169832500e-002</span><span class="p">,</span> <span class="mf">7.0280365352784992e-003</span><span class="p">,</span> <span class="mf">1.5973380868895002e-003</span><span class="p">,</span> <span class="mf">2.5467077202534996e-003</span><span class="p">,</span>
                   <span class="mf">7.3354322638190000e-003</span><span class="p">,</span> <span class="mf">1.2175439176836000e-002</span><span class="p">,</span> <span class="mf">1.5553775434484498e-002</span><span class="p">,</span> <span class="mf">1.5628555609310000e-002</span><span class="p">,</span>
                   <span class="mf">1.2407827169832500e-002</span><span class="p">,</span> <span class="mf">7.0280365352784992e-003</span><span class="p">,</span> <span class="mf">1.5973380868895002e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span>
                   <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span> <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span>
                   <span class="mf">3.3328160020824996e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span> <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span>
                   <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span> <span class="mf">3.3328160020824996e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span>
                   <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span> <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span>
                   <span class="mf">3.3328160020824996e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span> <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span>
                   <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span> <span class="mf">3.3328160020824996e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span>
                   <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span> <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span>
                   <span class="mf">3.3328160020824996e-003</span><span class="p">,</span> <span class="mf">4.0598276594965000e-003</span><span class="p">,</span> <span class="mf">1.3402871141581498e-002</span><span class="p">,</span> <span class="mf">9.2299966054110000e-003</span><span class="p">,</span>
                   <span class="mf">4.2384342671640000e-003</span><span class="p">,</span> <span class="mf">9.1463983850125008e-003</span><span class="p">,</span> <span class="mf">3.3328160020824996e-003</span><span class="p">],</span>
            <span class="s1">&#39;19&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.3333333333333332e-001</span><span class="p">,</span> <span class="mf">4.8960998707300704e-001</span><span class="p">,</span> <span class="mf">4.5453689269789208e-001</span><span class="p">,</span> <span class="mf">4.0141668064943096e-001</span><span class="p">,</span>
                   <span class="mf">2.5555165440309700e-001</span><span class="p">,</span> <span class="mf">1.7707794215212902e-001</span><span class="p">,</span> <span class="mf">1.1006105322795214e-001</span><span class="p">,</span> <span class="mf">5.5528624251839048e-002</span><span class="p">,</span>
                   <span class="mf">1.2621863777228030e-002</span><span class="p">,</span> <span class="mf">2.0780025853987000e-002</span><span class="p">,</span> <span class="mf">9.0926214604214992e-002</span><span class="p">,</span> <span class="mf">1.9716663870113800e-001</span><span class="p">,</span>
                   <span class="mf">4.8889669119380496e-001</span><span class="p">,</span> <span class="mf">6.4584411569574096e-001</span><span class="p">,</span> <span class="mf">7.7987789354409584e-001</span><span class="p">,</span> <span class="mf">8.8894275149632096e-001</span><span class="p">,</span>
                   <span class="mf">9.7475627244554304e-001</span><span class="p">,</span> <span class="mf">4.8960998707300600e-001</span><span class="p">,</span> <span class="mf">4.5453689269789296e-001</span><span class="p">,</span> <span class="mf">4.0141668064943104e-001</span><span class="p">,</span>
                   <span class="mf">2.5555165440309800e-001</span><span class="p">,</span> <span class="mf">1.7707794215213002e-001</span><span class="p">,</span> <span class="mf">1.1006105322795200e-001</span><span class="p">,</span> <span class="mf">5.5528624251839992e-002</span><span class="p">,</span>
                   <span class="mf">1.2621863777228998e-002</span><span class="p">,</span> <span class="mf">6.0063379479464496e-001</span><span class="p">,</span> <span class="mf">5.5760326158878384e-001</span><span class="p">,</span> <span class="mf">7.2098702581736496e-001</span><span class="p">,</span>
                   <span class="mf">5.9452706895587104e-001</span><span class="p">,</span> <span class="mf">8.3933147368083808e-001</span><span class="p">,</span> <span class="mf">7.0108797892617304e-001</span><span class="p">,</span> <span class="mf">8.2293132406985696e-001</span><span class="p">,</span>
                   <span class="mf">9.2434425262078384e-001</span><span class="p">,</span> <span class="mf">3.9575478735694296e-001</span><span class="p">,</span> <span class="mf">3.0792998388043608e-001</span><span class="p">,</span> <span class="mf">2.6456694840652000e-001</span><span class="p">,</span>
                   <span class="mf">3.5853935220595100e-001</span><span class="p">,</span> <span class="mf">1.5780740596859500e-001</span><span class="p">,</span> <span class="mf">7.5050596975911008e-002</span><span class="p">,</span> <span class="mf">1.4242160111338298e-001</span><span class="p">,</span>
                   <span class="mf">6.5494628082938000e-002</span><span class="p">,</span> <span class="mf">3.6114178484120000e-003</span><span class="p">,</span> <span class="mf">1.3446675453078000e-001</span><span class="p">,</span> <span class="mf">1.4446025776115000e-002</span><span class="p">,</span>
                   <span class="mf">4.6933578838178000e-002</span><span class="p">,</span> <span class="mf">2.8611203505670000e-003</span><span class="p">,</span> <span class="mf">2.2386142409791600e-001</span><span class="p">,</span> <span class="mf">3.4647074816760000e-002</span><span class="p">,</span>
                   <span class="mf">1.0161119296278000e-002</span><span class="p">,</span> <span class="mf">3.6114178484120000e-003</span><span class="p">,</span> <span class="mf">1.3446675453078000e-001</span><span class="p">,</span> <span class="mf">1.4446025776115000e-002</span><span class="p">,</span>
                   <span class="mf">4.6933578838178000e-002</span><span class="p">,</span> <span class="mf">2.8611203505670000e-003</span><span class="p">,</span> <span class="mf">2.2386142409791600e-001</span><span class="p">,</span> <span class="mf">3.4647074816760000e-002</span><span class="p">,</span>
                   <span class="mf">1.0161119296278000e-002</span><span class="p">,</span> <span class="mf">3.9575478735694296e-001</span><span class="p">,</span> <span class="mf">3.0792998388043608e-001</span><span class="p">,</span> <span class="mf">2.6456694840652000e-001</span><span class="p">,</span>
                   <span class="mf">3.5853935220595100e-001</span><span class="p">,</span> <span class="mf">1.5780740596859500e-001</span><span class="p">,</span> <span class="mf">7.5050596975911008e-002</span><span class="p">,</span> <span class="mf">1.4242160111338298e-001</span><span class="p">,</span>
                   <span class="mf">6.5494628082938000e-002</span><span class="p">,</span> <span class="mf">6.0063379479464496e-001</span><span class="p">,</span> <span class="mf">5.5760326158878384e-001</span><span class="p">,</span> <span class="mf">7.2098702581736496e-001</span><span class="p">,</span>
                   <span class="mf">5.9452706895587104e-001</span><span class="p">,</span> <span class="mf">8.3933147368083808e-001</span><span class="p">,</span> <span class="mf">7.0108797892617304e-001</span><span class="p">,</span> <span class="mf">8.2293132406985696e-001</span><span class="p">,</span>
                   <span class="mf">9.2434425262078384e-001</span><span class="p">,</span> <span class="mf">3.3333333333333332e-001</span><span class="p">,</span> <span class="mf">2.0780025853987000e-002</span><span class="p">,</span> <span class="mf">9.0926214604214992e-002</span><span class="p">,</span>
                   <span class="mf">1.9716663870113800e-001</span><span class="p">,</span> <span class="mf">4.8889669119380496e-001</span><span class="p">,</span> <span class="mf">6.4584411569574096e-001</span><span class="p">,</span> <span class="mf">7.7987789354409584e-001</span><span class="p">,</span>
                   <span class="mf">8.8894275149632096e-001</span><span class="p">,</span> <span class="mf">9.7475627244554304e-001</span><span class="p">,</span> <span class="mf">4.8960998707300600e-001</span><span class="p">,</span> <span class="mf">4.5453689269789296e-001</span><span class="p">,</span>
                   <span class="mf">4.0141668064943104e-001</span><span class="p">,</span> <span class="mf">2.5555165440309800e-001</span><span class="p">,</span> <span class="mf">1.7707794215213002e-001</span><span class="p">,</span> <span class="mf">1.1006105322795200e-001</span><span class="p">,</span>
                   <span class="mf">5.5528624251839992e-002</span><span class="p">,</span> <span class="mf">1.2621863777228998e-002</span><span class="p">,</span> <span class="mf">4.8960998707300704e-001</span><span class="p">,</span> <span class="mf">4.5453689269789208e-001</span><span class="p">,</span>
                   <span class="mf">4.0141668064943096e-001</span><span class="p">,</span> <span class="mf">2.5555165440309700e-001</span><span class="p">,</span> <span class="mf">1.7707794215212902e-001</span><span class="p">,</span> <span class="mf">1.1006105322795214e-001</span><span class="p">,</span>
                   <span class="mf">5.5528624251839048e-002</span><span class="p">,</span> <span class="mf">1.2621863777228030e-002</span><span class="p">,</span> <span class="mf">3.6114178484120000e-003</span><span class="p">,</span> <span class="mf">1.3446675453078000e-001</span><span class="p">,</span>
                   <span class="mf">1.4446025776115000e-002</span><span class="p">,</span> <span class="mf">4.6933578838178000e-002</span><span class="p">,</span> <span class="mf">2.8611203505670000e-003</span><span class="p">,</span> <span class="mf">2.2386142409791600e-001</span><span class="p">,</span>
                   <span class="mf">3.4647074816760000e-002</span><span class="p">,</span> <span class="mf">1.0161119296278000e-002</span><span class="p">,</span> <span class="mf">3.6114178484120000e-003</span><span class="p">,</span> <span class="mf">1.3446675453078000e-001</span><span class="p">,</span>
                   <span class="mf">1.4446025776115000e-002</span><span class="p">,</span> <span class="mf">4.6933578838178000e-002</span><span class="p">,</span> <span class="mf">2.8611203505670000e-003</span><span class="p">,</span> <span class="mf">2.2386142409791600e-001</span><span class="p">,</span>
                   <span class="mf">3.4647074816760000e-002</span><span class="p">,</span> <span class="mf">1.0161119296278000e-002</span><span class="p">,</span> <span class="mf">3.9575478735694296e-001</span><span class="p">,</span> <span class="mf">3.0792998388043608e-001</span><span class="p">,</span>
                   <span class="mf">2.6456694840652000e-001</span><span class="p">,</span> <span class="mf">3.5853935220595100e-001</span><span class="p">,</span> <span class="mf">1.5780740596859500e-001</span><span class="p">,</span> <span class="mf">7.5050596975911008e-002</span><span class="p">,</span>
                   <span class="mf">1.4242160111338298e-001</span><span class="p">,</span> <span class="mf">6.5494628082938000e-002</span><span class="p">,</span> <span class="mf">6.0063379479464496e-001</span><span class="p">,</span> <span class="mf">5.5760326158878384e-001</span><span class="p">,</span>
                   <span class="mf">7.2098702581736496e-001</span><span class="p">,</span> <span class="mf">5.9452706895587104e-001</span><span class="p">,</span> <span class="mf">8.3933147368083808e-001</span><span class="p">,</span> <span class="mf">7.0108797892617304e-001</span><span class="p">,</span>
                   <span class="mf">8.2293132406985696e-001</span><span class="p">,</span> <span class="mf">9.2434425262078384e-001</span><span class="p">,</span> <span class="mf">6.0063379479464496e-001</span><span class="p">,</span> <span class="mf">5.5760326158878384e-001</span><span class="p">,</span>
                   <span class="mf">7.2098702581736496e-001</span><span class="p">,</span> <span class="mf">5.9452706895587104e-001</span><span class="p">,</span> <span class="mf">8.3933147368083808e-001</span><span class="p">,</span> <span class="mf">7.0108797892617304e-001</span><span class="p">,</span>
                   <span class="mf">8.2293132406985696e-001</span><span class="p">,</span> <span class="mf">9.2434425262078384e-001</span><span class="p">,</span> <span class="mf">3.9575478735694296e-001</span><span class="p">,</span> <span class="mf">3.0792998388043608e-001</span><span class="p">,</span>
                   <span class="mf">2.6456694840652000e-001</span><span class="p">,</span> <span class="mf">3.5853935220595100e-001</span><span class="p">,</span> <span class="mf">1.5780740596859500e-001</span><span class="p">,</span> <span class="mf">7.5050596975911008e-002</span><span class="p">,</span>
                   <span class="mf">1.4242160111338298e-001</span><span class="p">,</span> <span class="mf">6.5494628082938000e-002</span><span class="p">,</span> <span class="mf">1.6453165694459500e-002</span><span class="p">,</span> <span class="mf">5.1653659456360000e-003</span><span class="p">,</span>
                   <span class="mf">1.1193623631508002e-002</span><span class="p">,</span> <span class="mf">1.5133062934734000e-002</span><span class="p">,</span> <span class="mf">1.5245483901099000e-002</span><span class="p">,</span> <span class="mf">1.2079606370820500e-002</span><span class="p">,</span>
                   <span class="mf">8.0254017934004992e-003</span><span class="p">,</span> <span class="mf">4.0422901308920000e-003</span><span class="p">,</span> <span class="mf">1.0396810137425000e-003</span><span class="p">,</span> <span class="mf">5.1653659456360000e-003</span><span class="p">,</span>
                   <span class="mf">1.1193623631508002e-002</span><span class="p">,</span> <span class="mf">1.5133062934734000e-002</span><span class="p">,</span> <span class="mf">1.5245483901099000e-002</span><span class="p">,</span> <span class="mf">1.2079606370820500e-002</span><span class="p">,</span>
                   <span class="mf">8.0254017934004992e-003</span><span class="p">,</span> <span class="mf">4.0422901308920000e-003</span><span class="p">,</span> <span class="mf">1.0396810137425000e-003</span><span class="p">,</span> <span class="mf">5.1653659456360000e-003</span><span class="p">,</span>
                   <span class="mf">1.1193623631508002e-002</span><span class="p">,</span> <span class="mf">1.5133062934734000e-002</span><span class="p">,</span> <span class="mf">1.5245483901099000e-002</span><span class="p">,</span> <span class="mf">1.2079606370820500e-002</span><span class="p">,</span>
                   <span class="mf">8.0254017934004992e-003</span><span class="p">,</span> <span class="mf">4.0422901308920000e-003</span><span class="p">,</span> <span class="mf">1.0396810137425000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">,</span> <span class="mf">1.9424384524905000e-003</span><span class="p">,</span>
                   <span class="mf">1.2787080306011000e-002</span><span class="p">,</span> <span class="mf">4.4404517866690008e-003</span><span class="p">,</span> <span class="mf">8.0622733808655008e-003</span><span class="p">,</span> <span class="mf">1.2459709087455000e-003</span><span class="p">,</span>
                   <span class="mf">9.1214200594755008e-003</span><span class="p">,</span> <span class="mf">5.1292818680995000e-003</span><span class="p">,</span> <span class="mf">1.8999644276510000e-003</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">:</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">W</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\CUSTOM_EIG&#39;</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;TESLA&#39;</span><span class="p">)</span>
    <span class="n">n_cells</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">midC3795</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">62.22222222222222</span><span class="p">,</span> <span class="mf">66.12612612612612</span><span class="p">,</span> <span class="mf">30.22022022022022</span><span class="p">,</span> <span class="mf">23.113113113113116</span><span class="p">,</span>
                         <span class="mf">71.98698698698699</span><span class="p">,</span> <span class="mf">93.5</span><span class="p">,</span> <span class="mf">171.1929</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">endC3795</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">62.58258258258258</span><span class="p">,</span> <span class="mf">57.53753753753754</span><span class="p">,</span> <span class="mf">17.207207207207208</span><span class="p">,</span> <span class="mf">12.002002002002001</span><span class="p">,</span>
                         <span class="mf">80.38038038038039</span><span class="p">,</span> <span class="mf">93.31191678718535</span><span class="p">,</span> <span class="mf">171.1929</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">midTESLA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mf">57.7</span><span class="p">,</span> <span class="mf">103.3</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">midFCCUROS5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">67.72</span><span class="p">,</span> <span class="mf">57.45</span><span class="p">,</span> <span class="mf">21.75</span><span class="p">,</span> <span class="mf">35.95</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">93.5</span><span class="p">,</span> <span class="mf">166.591</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">midDegen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.052</span><span class="p">,</span> <span class="mf">36.5</span><span class="p">,</span> <span class="mf">7.6</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">57.7</span><span class="p">,</span> <span class="mf">98.58</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">endDegen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.052</span><span class="p">,</span> <span class="mf">36.5</span><span class="p">,</span> <span class="mf">7.6</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">57.7</span><span class="p">,</span> <span class="mf">98.58</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">midNLSF_RE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">49</span><span class="p">,</span> <span class="mf">35.30</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mf">32.0</span><span class="p">,</span> <span class="mf">57.7</span><span class="p">,</span> <span class="mf">98.58</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
    <span class="n">endNLSF_RE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">32.0</span><span class="p">,</span> <span class="mf">57.7</span><span class="p">,</span> <span class="mf">98.58</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="n">mod</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">midNLSF_RE</span><span class="p">,</span> <span class="n">endNLSF_RE</span><span class="p">,</span> <span class="n">beampipe</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Sosoho-abasi Udongwo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
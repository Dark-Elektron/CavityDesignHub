<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>analysis_modules.cavity_analysis.cavity_analysis &mdash; CavityDesignHub (CaDH) 0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> CavityDesignHub (CaDH)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_involved.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">CavityDesignHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CavityDesignHub (CaDH)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">analysis_modules.cavity_analysis.cavity_analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for analysis_modules.cavity_analysis.cavity_analysis</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">spio</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">sci</span>
<span class="kn">import</span> <span class="nn">mplcursors</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>

<span class="kn">from</span> <span class="nn">utils.file_reader</span> <span class="kn">import</span> <span class="n">FileReader</span>
<span class="kn">from</span> <span class="nn">analysis_modules.plot_module.matplotlib_annotation_objects</span> <span class="kn">import</span> <span class="n">DraggableText</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">shared_functions</span>
<span class="kn">from</span> <span class="nn">utils.shared_functions</span> <span class="kn">import</span> <span class="n">ellipse_tangent</span>

<span class="n">fr</span> <span class="o">=</span> <span class="n">FileReader</span><span class="p">()</span>

<span class="n">WP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">:</span> <span class="mf">45.6</span><span class="p">,</span>
          <span class="s1">&#39;I0 [mA]&#39;</span><span class="p">:</span> <span class="mi">1400</span>
          <span class="p">},</span>
    <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
          <span class="s1">&#39;I0 [mA]&#39;</span><span class="p">:</span> <span class="mi">147</span>
          <span class="p">},</span>
    <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
          <span class="s1">&#39;I0 [mA]&#39;</span><span class="p">:</span> <span class="mf">26.7</span>
          <span class="p">},</span>
    <span class="s1">&#39;ttbar&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">:</span> <span class="mf">182.5</span><span class="p">,</span>
              <span class="s1">&#39;I0 [mA]&#39;</span><span class="p">:</span> <span class="mi">5</span>
              <span class="p">}</span>
<span class="p">}</span>

<span class="n">MACHINE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rho [m]&#39;</span><span class="p">:</span> <span class="mi">9937</span><span class="p">}</span>


<div class="viewcode-block" id="plot_settings"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.plot_settings">[docs]</a><span class="k">def</span> <span class="nf">plot_settings</span><span class="p">():</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.title_fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>

    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span></div>


<span class="n">plot_settings</span><span class="p">()</span>


<div class="viewcode-block" id="Cavities"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities">[docs]</a><span class="k">class</span> <span class="nc">Cavities</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cavities object is an object containing several Cavity objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cavities_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs all the necessary attributes of the Cavity object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cavities_list: list, array like</span>
<span class="sd">            List containing Cavity objects.</span>

<span class="sd">        save_folder: str</span>
<span class="sd">            Folder to save generated images, latex, excel, and text files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fm_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hom_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span> <span class="o">=</span> <span class="n">save_folder</span>

        <span class="k">if</span> <span class="n">cavities_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span> <span class="o">=</span> <span class="n">cavities_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">returned_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># V/m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cavities_field</span><span class="p">()</span>

<div class="viewcode-block" id="Cavities.set_cavities_field"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.set_cavities_field">[docs]</a>    <span class="k">def</span> <span class="nf">set_cavities_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets cavities analysis field range.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">cav</span><span class="o">.</span><span class="n">set_Eacc</span><span class="p">(</span><span class="n">Eacc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.set_cavities_slans"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.set_cavities_slans">[docs]</a>    <span class="k">def</span> <span class="nf">set_cavities_slans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set folders to read SLANS results from</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dir_list: list, array like</span>
<span class="sd">            List of SLANS directories for the corresponding cavities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dirc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dir_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dirc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_slans_qois</span><span class="p">(</span><span class="n">dirc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.set_cavities_abci"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.set_cavities_abci">[docs]</a>    <span class="k">def</span> <span class="nf">set_cavities_abci</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set folders to read ABCI results from</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dir_list: list, array like</span>
<span class="sd">            List of ABCI directories for the corresponding cavities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dirc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dir_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_abci_qois</span><span class="p">(</span><span class="n">dirc</span><span class="p">,</span> <span class="n">working_point</span><span class="o">=</span><span class="n">wp</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.compare_power"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.compare_power">[docs]</a>    <span class="k">def</span> <span class="nf">compare_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E_acc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">E_acc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">=</span> <span class="n">E_acc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cavities_field</span><span class="p">()</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="c1"># E_acc_Pin(cavity, op_field[i], ls[i], fig, ax, ax_right, ax_right2)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qois</span><span class="p">(</span><span class="n">cav</span><span class="p">,</span> <span class="n">cav</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">E_acc</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">returned_results</span> <span class="o">=</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Cavities.qois"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.qois">[docs]</a>    <span class="k">def</span> <span class="nf">qois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cavity</span><span class="p">,</span> <span class="n">op_field</span><span class="p">,</span> <span class="n">E_acc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cavity: object</span>
<span class="sd">            Cavity object</span>
<span class="sd">        op_field: float</span>
<span class="sd">            Cavity operating field</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dictionary containing quantities of interest (normed optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">E_acc</span> <span class="o">&gt;=</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E_acc</span> <span class="o">&lt;=</span> <span class="mf">1.01</span> <span class="o">*</span> <span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">))</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">pdyn</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="n">qois</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">r</span><span class="s2">&quot;$N_\mathrm{cav/beam}$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="sa">r</span><span class="s2">&quot;$Q_\mathrm</span><span class="si">{0}</span><span class="s2"> [10^8]$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">Q0</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span><span class="p">),</span>
            <span class="sa">r</span><span class="s2">&quot;$R_\mathrm</span><span class="si">{s}</span><span class="s2"> [\mathrm{n\Omega}]$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">Rs</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="sa">r</span><span class="s2">&quot;$P_\mathrm{stat/cav}$ [W]&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">pstat</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="sa">r</span><span class="s2">&quot;$P_\mathrm{dyn/cav}$ [W]&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">pdyn</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="c1"># r&quot;$P_\mathrm{wp/cav}$ [W]&quot;: np.average(cavity.p_wp[ind]/cavity.n_cav[ind]),</span>
            <span class="sa">r</span><span class="s2">&quot;$P_\mathrm{in/beam}$ [kW]&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">p_in</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
            <span class="c1"># r&quot;$Q_\mathrm{0} \mathrm{[10^8]}$&quot;: np.average(cavity.Q0[ind] * 1e-8),</span>
            <span class="c1"># r&quot;$Rs_\mathrm{0} \mathrm{[10^7]}$&quot;: np.average(cavity.Rs[ind])</span>
        <span class="p">}</span>

        <span class="n">qois_norm_units</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">r</span><span class="s2">&quot;$n_\mathrm{cav/beam}$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="c1"># r&quot;$q_\mathrm{0}$&quot;: np.average(cavity.Q0[ind]),</span>
            <span class="c1"># r&quot;$r_\mathrm{s}$&quot;: np.average(cavity.Rs[ind]),</span>
            <span class="sa">r</span><span class="s2">&quot;$p_\mathrm{stat/cav}$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">pstat</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="sa">r</span><span class="s2">&quot;$p_\mathrm{dyn/cav}$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">pdyn</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="c1"># r&quot;$p_\mathrm{wp/cav}$&quot;: np.average(cavity.p_wp[ind]/cavity.n_cav[ind]),</span>
            <span class="sa">r</span><span class="s2">&quot;$p_\mathrm{in/beam}$&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">p_in</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
            <span class="c1"># r&quot;$Q_\mathrm{0} \mathrm{[10^8]}$&quot;: np.average(cavity.Q0[ind] * 1e-8),</span>
            <span class="c1"># r&quot;$Rs_\mathrm{0} \mathrm{[10^7]}$&quot;: np.average(cavity.Rs[ind])</span>
        <span class="p">}</span>

        <span class="n">ic</span><span class="p">(</span><span class="n">qois</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qois_norm_units</span></div>

<div class="viewcode-block" id="Cavities.qois_fm"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.qois_fm">[docs]</a>    <span class="k">def</span> <span class="nf">qois_fm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the fundamental mode quantities of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dictionary containing fundamental mode quantities of interest (normed optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="sa">r</span><span class="s2">&quot;$E_\mathrm</span><span class="si">{pk}</span><span class="s2">/E_\mathrm</span><span class="si">{acc}</span><span class="s2"> [\cdot]$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">e</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$B_\mathrm</span><span class="si">{pk}</span><span class="s2">/E_\mathrm</span><span class="si">{acc}</span><span class="s2"> \mathrm{[mT/MV/m]}$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$k_\mathrm</span><span class="si">{cc}</span><span class="s2">$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">k_cc</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$R/Q \mathrm{[10^2\Omega]}$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">R_Q</span> <span class="o">*</span> <span class="mf">1e-2</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$G \mathrm{[10^</span><span class="si">{2}</span><span class="s2">\Omega]}$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="mf">1e-2</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$G\cdot R/Q \mathrm{[10^</span><span class="si">{5}</span><span class="s2">\Omega^2]}$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">*</span> <span class="mf">1e-5</span>
            <span class="p">})</span>

        <span class="n">results_norm_units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">results_norm_units</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="sa">r</span><span class="s2">&quot;$e_\mathrm</span><span class="si">{pk}</span><span class="s2">$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">e</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$b_\mathrm</span><span class="si">{pk}</span><span class="s2">$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$k_\mathrm</span><span class="si">{cc}</span><span class="s2">$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">k_cc</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$r/q$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$g$&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$g\cdot r/q $&quot;</span><span class="p">:</span> <span class="n">cav</span><span class="o">.</span><span class="n">GR_Q</span>
            <span class="p">})</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results_norm_units</span></div>

<div class="viewcode-block" id="Cavities.qois_hom"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.qois_hom">[docs]</a>    <span class="k">def</span> <span class="nf">qois_hom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the higher-order modes quantities of interest</span>

<span class="sd">        .. plot::</span>
<span class="sd">           :include-source:</span>

<span class="sd">           import matplotlib.pyplot as plt</span>
<span class="sd">           import numpy as np</span>
<span class="sd">           x = np.random.randn(1000)</span>
<span class="sd">           plt.hist( x, 20)</span>
<span class="sd">           plt.grid()</span>
<span class="sd">           plt.title(r&#39;Normal: $\mu=%.2f, \sigma=%.2f$&#39;%(x.mean(), x.std()))</span>
<span class="sd">           plt.show()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dictionary containing higher-order modes quantities of interest (normed optional).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cavity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="sa">r</span><span class="s2">&quot;$|k_\parallel| \mathrm{[V/pC]}$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">k_loss</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$|k_\perp| \mathrm{[V/pC/m]}$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">k_kick</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{HOM}</span><span class="s2">/cav \mathrm{[kW]}$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">phom</span>
            <span class="p">})</span>

        <span class="n">results_norm_units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cavity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">results_norm_units</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="sa">r</span><span class="s2">&quot;$k_\parallel$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">k_loss</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$k_\perp$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">k_kick</span><span class="p">,</span>
                <span class="sa">r</span><span class="s2">&quot;$p_\mathrm</span><span class="si">{HOM}</span><span class="s2">/cav$&quot;</span><span class="p">:</span> <span class="n">cavity</span><span class="o">.</span><span class="n">phom</span>
            <span class="p">})</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results_norm_units</span></div>

<div class="viewcode-block" id="Cavities.plot_power_comparison"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_power_comparison">[docs]</a>    <span class="k">def</span> <span class="nf">plot_power_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E_acc</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Can be called using ``cavities.plot_power_comparison()``</span>

<span class="sd">        .. math::</span>

<span class="sd">           W^{3 \\beta}_{\delta}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig: matplotlib figure</span>
<span class="sd">        ax_list: list of matplotlib axes object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
            <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">ax_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># def E_acc_Pin(self, cavity, E_acc, op_field, ls=&#39;-&#39;, ):</span>

        <span class="c1"># ax_right2._get_lines.prop_cycler = ax._get_lines.prop_cycler</span>
        <span class="c1"># ax_right2.spines[&quot;right&quot;].set_position((&quot;axes&quot;, 1.2))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cavity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">cavity</span><span class="o">.</span><span class="n">pstat</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">,</span>
                     <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm{static/cav}$&quot;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">cavity</span><span class="o">.</span><span class="n">pdyn</span> <span class="o">/</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">,</span>
                     <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm{dynamic/cav}$&quot;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># p1, = ax1.plot(cavity.E_acc * 1e-6, cavity.p_wp/cavity.n_cav,</span>
            <span class="c1">#                ls=self.ls[i], lw=2, c=&#39;k&#39;, label=r&quot;$P_\mathrm{wp/beam}$&quot; + fr&quot;{cavity.name}&quot;)</span>

            <span class="n">p2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">cavity</span><span class="o">.</span><span class="n">n_cav</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">p3</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">cavity</span><span class="o">.</span><span class="n">p_in</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E_\mathrm</span><span class="si">{acc}</span><span class="s2">$ [MV/m]&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm{stat, dyn}$/cav [W]&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E_\mathrm</span><span class="si">{acc}</span><span class="s2">$ [MV/m]&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$N_\mathrm{cav/beam}$&quot;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E_\mathrm</span><span class="si">{acc}</span><span class="s2">$ [MV/m]&quot;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm{in/cav}$ [kW]&quot;</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cavity</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

            <span class="c1"># ax.axvline(7.13, ls=&#39;--&#39;, c=&#39;k&#39;)</span>
            <span class="c1"># ax.axvline(10, ls=&#39;--&#39;, c=&#39;k&#39;)</span>
            <span class="c1"># ax.axvline(15, ls=&#39;--&#39;, c=&#39;k&#39;)</span>
            <span class="c1"># ax_right2.axhline(500, ls=&#39;--&#39;, c=&#39;k&#39;)</span>
            <span class="c1"># ax_right2.axhline(1000, ls=&#39;--&#39;, c=&#39;k&#39;)</span>
            <span class="c1"># ax.xaxis.set_major_locator(ticker.MultipleLocator(2))</span>
            <span class="c1"># ax.yaxis.set_major_locator(ticker.MultipleLocator(2))</span>
            <span class="c1"># ax_right.yaxis.set_major_locator(ticker.MultipleLocator(100))</span>
            <span class="c1"># ax_right2.yaxis.set_major_locator(ticker.MultipleLocator(200))</span>

            <span class="c1"># ax.yaxis.label.set_color(p1.get_color())</span>
            <span class="c1"># ax_right.yaxis.label.set_color(p2.get_color())</span>
            <span class="c1"># ax_right2.yaxis.label.set_color(p3.get_color())</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
            <span class="c1"># # ax.set_ylim(0, 50)</span>
            <span class="c1"># ax_right.set_ylim(100, 400)f</span>
            <span class="c1"># ax_right2.set_ylim(0, 700)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

            <span class="c1"># tkw = dict(size=4, width=1.5)</span>
            <span class="c1"># ax.tick_params(axis=&#39;y&#39;, colors=p1.get_color(), **tkw)</span>
            <span class="c1"># ax_right.tick_params(axis=&#39;y&#39;, colors=p2.get_color(), **tkw)</span>
            <span class="c1"># ax_right2.tick_params(axis=&#39;y&#39;, colors=p3.get_color(), **tkw)</span>
            <span class="c1"># ax.tick_params(axis=&#39;x&#39;, **tkw)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
            <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
            <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
            <span class="c1"># ax.grid(True, which=&#39;both&#39;, axis=&#39;both&#39;)</span>

        <span class="c1"># dummy lines with NO entries, just to create the black style legend</span>
        <span class="n">dummy_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b_idx</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="n">dummy_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">[</span><span class="n">b_idx</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
        <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
                             <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{stat}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{dyn}</span><span class="s2">$&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">dummy_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))],</span>
                             <span class="p">[</span><span class="n">cavity</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cavity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                             <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>

        <span class="c1"># ax1.legend(ncol=len(cavities))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\mathbf{Z^*}$&quot;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\mathbf{W^*}$&quot;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_power_comparison.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_compare_bar"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_compare_bar">[docs]</a>    <span class="k">def</span> <span class="nf">plot_compare_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots bar chart of power quantities of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># plot barchart</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">returned_results</span><span class="p">])</span>
        <span class="n">data_col_max</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">returned_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># 1 / len(x)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_col_max</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">r</span> <span class="o">+</span> <span class="n">width</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))],</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># label = [&quot;C3794_H (2-Cell)&quot;, &quot;C3795_H (5-Cell)&quot;]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_power_comparison_bar.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_compare_hom_bar"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_compare_hom_bar">[docs]</a>    <span class="k">def</span> <span class="nf">plot_compare_hom_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot bar chart of higher-order mode&#39;s quantities of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># plot barchart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hom_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qois_hom</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hom_results</span><span class="p">])</span>
        <span class="n">data_col_max</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hom_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># 1 / (len(x)+10)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_col_max</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">r</span> <span class="o">+</span> <span class="n">width</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))],</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># label = [&quot;C3794_H (2-Cell)&quot;, &quot;C3795_H (5-Cell)&quot;]</span>
        <span class="c1"># label = [&quot;C3795_ttbar (5-Cell)&quot;, &quot;FCCUROS5_ttbar (5-Cell)&quot;, &quot;TELSA_ttbar (5-Cell)&quot;]</span>
        <span class="c1"># ax.legend(label, loc=&quot;upper left&quot;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_hom_bar.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_compare_fm_bar"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_compare_fm_bar">[docs]</a>    <span class="k">def</span> <span class="nf">plot_compare_fm_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot bar chart of fundamental mode quantities of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># plot barchart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fm_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qois_fm</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_results</span><span class="p">])</span>
        <span class="n">data_col_max</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fm_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># 1 / (len(x)+10)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cav</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_col_max</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">r</span> <span class="o">+</span> <span class="n">width</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))],</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># label = [&quot;C3794_H (2-Cell)&quot;, &quot;C3795_H (5-Cell)&quot;]</span>
        <span class="c1"># label = [&quot;C3795_ttbar (5-Cell)&quot;, &quot;FCCUROS5_ttbar (5-Cell)&quot;, &quot;TELSA_ttbar (5-Cell)&quot;]</span>
        <span class="c1"># ax.legend(label, loc=&quot;upper left&quot;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_fm_bar.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_ql_vs_pin"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_ql_vs_pin">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ql_vs_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot loaded quality factor versus input power for fundamental power coupler (FPC)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>

        <span class="c1"># geometry</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">n_cells</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># 4</span>
        <span class="n">l_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">l_cell_mid</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># m</span>
        <span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">G</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># 273.2 # 0.00948*Q_factor*(f/1300)**0.5</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">b</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">l_cell</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

        <span class="c1"># QOI</span>
        <span class="n">R_Q</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">R_Q</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># 411   # c Ohm linac definition</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">op_freq</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">QOI</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">R_Q</span><span class="p">]</span>

        <span class="c1"># RF</span>
        <span class="c1"># Vrf = [2*0.1e9, 2*0.1e9, 2*0.75e9]  #   #2*0.75e9</span>
        <span class="c1"># Vrf = [2*0.12e9, 2*0.12e9, 2*1e9, 2*0.44e9]  #   #2*0.75e9 update</span>
        <span class="n">Vrf</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">v_rf</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># #ttbar</span>
        <span class="c1"># Eacc = [20e6, 20e6, 20e6]</span>
        <span class="n">Eacc</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">op_field</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># update</span>
        <span class="n">RF</span> <span class="o">=</span> <span class="p">[</span><span class="n">Eacc</span><span class="p">,</span> <span class="n">Vrf</span><span class="p">]</span>

        <span class="c1"># MACHINE</span>
        <span class="c1"># I0 = [1390e-3, 1390e-3, 147e-3, 147e-3]  # mA</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="p">[</span><span class="n">WP</span><span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">wp</span><span class="p">][</span><span class="s1">&#39;I0 [mA]&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="c1"># rho = [10.76e3, 10.76e3, 10.76e3, 10.76e3]  # bending radius</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">MACHINE</span><span class="p">[</span><span class="s1">&#39;rho [m]&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># bending radius</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="p">[</span><span class="n">WP</span><span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">wp</span><span class="p">][</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>  <span class="c1"># Beam energy GeV</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="p">[</span><span class="n">I0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">E0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ql_pin</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">RF</span><span class="p">,</span> <span class="n">QOI</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.plot_cryomodule_comparison"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_cryomodule_comparison">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cryomodule_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot cryomodule power comparison</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n_cav_per_cryomodule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">n_cryomodules_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cryomodules_len_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ncpc</span> <span class="ow">in</span> <span class="n">n_cav_per_cryomodule</span><span class="p">:</span>
                <span class="n">cryomodule_len</span> <span class="o">=</span> <span class="n">cav</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cav</span><span class="o">.</span><span class="n">l_cell_mid</span><span class="p">)</span> <span class="o">*</span> <span class="n">ncpc</span> <span class="o">+</span> <span class="p">(</span><span class="n">ncpc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">cav</span><span class="o">.</span><span class="n">l_cell_mid</span>
                <span class="n">cryomodules_len_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cryomodule_len</span><span class="p">)</span>

                <span class="n">n_cryomodules</span> <span class="o">=</span> <span class="n">cav</span><span class="o">.</span><span class="n">n_cav_op_field</span> <span class="o">/</span> <span class="n">ncpc</span>
                <span class="n">n_cryomodules_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_cryomodules</span><span class="p">)</span>

            <span class="c1"># ic(cryomodules_len_list)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_cav_per_cryomodule</span><span class="p">,</span> <span class="n">cryomodules_len_list</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_cav_per_cryomodule</span><span class="p">,</span> <span class="n">n_cryomodules_list</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">n_cav_per_cryomodule</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">cryomodules_len_list</span><span class="p">,</span> <span class="n">n_cryomodules_list</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">n_cav_per_cryomodule</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$N_\mathrm</span><span class="si">{cav}</span><span class="s2">$/mod.&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$L_\mathrm</span><span class="si">{cryo}</span><span class="s2">$ [m]&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$N_\mathrm</span><span class="si">{cav}</span><span class="s2">$/mod.&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$N_\mathrm</span><span class="si">{cryo}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mplcursors</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_cryo.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_cavities_contour"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_cavities_contour">[docs]</a>    <span class="k">def</span> <span class="nf">plot_cavities_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">n_cells</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot geometric contour of Cavity objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        opt: {&quot;mid&quot;, &quot;end&quot;, &quot;all&quot;}</span>
<span class="sd">            Either plot contour for only mid cells or end cells or the entire cavity</span>
<span class="sd">        n_cells: int</span>
<span class="sd">            Option used only when opt is set to &quot;all&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span> <span class="ow">or</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="c1"># write contour</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_contour</span><span class="p">(</span><span class="n">cav</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">slans_dir</span><span class="si">}</span><span class="s2">\contour.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>

            <span class="n">x_label</span> <span class="o">=</span> <span class="s2">&quot;z [mm]&quot;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;r [mm]&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
            <span class="n">min_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">min_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">max_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">max_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span> <span class="ow">or</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">min_x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">min_y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_contour.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_axis_fields"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_axis_fields">[docs]</a>    <span class="k">def</span> <span class="nf">plot_axis_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot axis fields of cavities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="c1"># normalize fields</span>
            <span class="n">e_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">axis_field</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">])</span>
            <span class="n">e_axis_norm</span> <span class="o">=</span> <span class="n">e_axis</span> <span class="o">/</span> <span class="n">e_axis</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="c1"># shift to mid</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">cav</span><span class="o">.</span><span class="n">axis_field</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
            <span class="n">z_shift</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_shift</span><span class="p">,</span> <span class="n">e_axis_norm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$z$ [mm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$|E_\mathrm</span><span class="si">{axis}</span><span class="s1">|/|E_\mathrm</span><span class="si">{axis}</span><span class="s1">|_\mathrm</span><span class="si">{max}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_axis_fields.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_surface_fields"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_surface_fields">[docs]</a>    <span class="k">def</span> <span class="nf">plot_surface_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot surface fields of cavities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="c1"># normalize fields</span>
            <span class="n">e_surf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">surface_field</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">])</span>
            <span class="n">e_surf_norm</span> <span class="o">=</span> <span class="n">e_surf</span> <span class="o">/</span> <span class="n">e_surf</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e_surf_norm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$L_\mathrm</span><span class="si">{surf}</span><span class="s1">$ [mm]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$|E_\mathrm</span><span class="si">{surf}</span><span class="s1">|/|E_\mathrm</span><span class="si">{surf}</span><span class="s1">|_\mathrm</span><span class="si">{max}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_surface_fields.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_multipac_triplot"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_multipac_triplot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_multipac_triplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folders</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;triplot&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot Multipac triplot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folders: list, array like</span>
<span class="sd">            List of folder to read multipacting results from</span>
<span class="sd">        kind</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This will be changed later so that the multipac results will be in the same location as the SLANS and ABCI</span>
<span class="sd">        results</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
            <span class="c1"># create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;in here&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">]</span>

        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

        <span class="n">Eacc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">Epk_Eacc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">e</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">Eacc</span><span class="p">,</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Eacc_list</span><span class="p">,</span> <span class="n">Epk_Eacc_list</span><span class="p">,</span> <span class="n">folders</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
            <span class="c1"># load_output_data</span>
            <span class="c1"># files</span>
            <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ccounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Acounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Atcounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Efcounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;geodata.n&quot;</span><span class="p">,</span> <span class="s2">&quot;secy1&quot;</span><span class="p">,</span> <span class="s2">&quot;counter_flevels.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;counter_initials.mat&quot;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># files_folder = &quot;D:\Dropbox\multipacting\MPGUI21&quot;</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;.mat&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">A</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Acounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span>
            <span class="n">At</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Atcounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;At&quot;</span><span class="p">]</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Ccounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;C&quot;</span><span class="p">]</span>
            <span class="n">Ef</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Efcounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;Ef&quot;</span><span class="p">]</span>
            <span class="n">flevel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counter_flevels.mat&quot;</span><span class="p">][</span><span class="s2">&quot;flevel&quot;</span><span class="p">]</span>
            <span class="n">initials</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counter_initials.mat&quot;</span><span class="p">][</span><span class="s2">&quot;initials&quot;</span><span class="p">]</span>
            <span class="n">secy1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secy1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">Pow</span> <span class="o">=</span> <span class="n">flevel</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initials</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># number of initials in the bright set</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;param&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># number of impacts</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">flevel</span>
            <span class="n">Efl</span> <span class="o">=</span> <span class="n">flevel</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mf">1.6021773e-19</span>
            <span class="n">Efq</span> <span class="o">=</span> <span class="n">Ef</span> <span class="o">/</span> <span class="n">q</span>

            <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># lower threshold</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># upper threshold</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># maximum secondary yield</span>

            <span class="n">cl</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ok</span><span class="p">,</span> <span class="n">ok1</span><span class="p">,</span> <span class="n">ok2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ok</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Unable to plot the counters. No initial points.&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">ok1</span> <span class="o">*</span> <span class="n">ok2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cl</span> <span class="o">=</span> <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Counter functions or impact energy missing.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if ss &gt; 0:</span>
                    <span class="c1">#     cl = ic(np.array([&#39;Plotting the triplot (counter, enhanced &#39;, &#39;counter and impact energy).&#39;]))</span>

                    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;counter function&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                        <span class="c1"># fig, axs = plt.subplots(3)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">C</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$c_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}/ c_0 $&quot;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                        <span class="c1"># axs[0].set_title(r&#39;$\mathbf{MultiPac 2.1~~~~~Counter function~~~~}$&#39;)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]))</span>

                        <span class="c1"># plot peak operating field</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                    <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;final impact energy&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;final impact energy&#39;</span><span class="p">:</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">Efq</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

                        <span class="c1"># axs[1-s].plot([np.min(Efl) / 1e6, np.max(Efl) / 1e6], [secy1[e1, 0], secy1[e1, 0]], &#39;-r&#39;)</span>
                        <span class="n">e0</span> <span class="o">=</span> <span class="n">sci</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">secy1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">e0</span><span class="p">,</span> <span class="n">e0</span><span class="p">],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">secy1</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">secy1</span><span class="p">[</span><span class="n">e3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="n">e3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;--r&#39;</span><span class="p">)</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$Ef_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                        <span class="c1"># axs[1-s].set_title(&#39;$\mathbf{Final~Impact~Energy~in~eV}$&#39;)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                        <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;enhanced counter function&#39;</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;enhanced counter function&#39;</span><span class="p">:</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$V$ [MV]&#39;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$e_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span> <span class="o">+</span> <span class="s2">&quot;/ c_0$&quot;</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                        <span class="c1"># axs[2-s].set_title(&#39;$\mathbf{Enhanced~counter~function}$&#39;)</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                        <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">kind</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.plot_dispersion"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.plot_dispersion">[docs]</a>    <span class="k">def</span> <span class="nf">plot_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot dispersion curve for the cavities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cav</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cav</span><span class="o">.</span><span class="n">d_slans_all_results</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">cav</span><span class="o">.</span><span class="n">n_cells</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (kcc=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">k_cc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1"> %)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mode Number&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="c1"># save plots</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_all_plots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">_dispersion.png&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.write_contour"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.write_contour">[docs]</a>    <span class="k">def</span> <span class="nf">write_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cav</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">n_cells</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write geometric contour for cavities</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cav: Cavity object</span>
<span class="sd">            Cavity object</span>
<span class="sd">        opt: str</span>

<span class="sd">        n_cells: int</span>
<span class="sd">            Number of cavity cells</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span><span class="p">:</span>
            <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">n_cell</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.001</span>
            <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mf">0.001</span>

            <span class="c1"># calculate shift</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span><span class="p">:</span>
            <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mf">0.001</span>
            <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">L_m</span>

            <span class="n">n_cell</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># calculate shift</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">,</span> <span class="n">L_m</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">,</span> <span class="n">L_el</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC_R&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">,</span> <span class="n">L_er</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-3</span>

            <span class="n">L_bp_l</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>
            <span class="n">L_bp_r</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">L_m</span>

            <span class="n">n_cell</span> <span class="o">=</span> <span class="n">n_cells</span>

            <span class="c1"># calculate shift</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># step in boundary points in mm</span>
        <span class="c1"># shift = 0</span>
        <span class="c1"># shift = L_m  # for end cell</span>

        <span class="c1"># calculate angles outside loop</span>
        <span class="c1"># CALCULATE x1_el, y1_el, x2_el, y2_el</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">],</span>
                <span class="p">[</span><span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">])</span>  <span class="c1"># data = ([h, k, p, q], [a_m, b_m, A_m, B_m])</span>

        <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">,</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">ellipse_tangent</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">a_el</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">A_el</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">B_el</span><span class="p">]),</span>
                                        <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                        <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-12</span><span class="p">)</span>  <span class="c1"># [a_m, b_m-0.3*b_m, L_m-A_m, Req_m-0.7*B_m] initial guess</span>

        <span class="c1"># CALCULATE x1, y1, x2, y2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">],</span>
                <span class="p">[</span><span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">])</span>  <span class="c1"># data = ([h, k, p, q], [a_m, b_m, A_m, B_m])</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">ellipse_tangent</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a_m</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">A_m</span> <span class="o">+</span> <span class="n">L_bp_l</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">B_m</span><span class="p">]),</span>
                                <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-12</span><span class="p">)</span>  <span class="c1"># [a_m, b_m-0.3*b_m, L_m-A_m, Req_m-0.7*B_m] initial guess</span>

        <span class="c1"># CALCULATE x1_er, y1_er, x2_er, y2_er</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">],</span>
                <span class="p">[</span><span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">])</span>  <span class="c1"># data = ([h, k, p, q], [a_m, b_m, A_m, B_m])</span>
        <span class="n">x1er</span><span class="p">,</span> <span class="n">y1er</span><span class="p">,</span> <span class="n">x2er</span><span class="p">,</span> <span class="n">y2er</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">ellipse_tangent</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">a_er</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">A_er</span> <span class="o">+</span> <span class="n">L_bp_r</span><span class="p">,</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">B_er</span><span class="p">]),</span>
                                        <span class="n">args</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                        <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-12</span><span class="p">)</span>  <span class="c1"># [a_m, b_m-0.3*b_m, L_m-A_m, Req_m-0.7*B_m] initial guess</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">slans_dir</span><span class="si">}</span><span class="s1">\contour.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="c1"># SHIFT POINT TO START POINT</span>
            <span class="n">start_point</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># ADD BEAM PIPE LENGTH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cell</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># DRAW ARC:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_el</span> <span class="o">+</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">a_el</span><span class="p">,</span> <span class="n">b_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1el</span><span class="p">,</span> <span class="n">y1el</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2el</span><span class="p">,</span> <span class="n">y2el</span><span class="p">]</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span> <span class="o">-</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">A_el</span><span class="p">,</span> <span class="n">B_el</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                     <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_el</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">n_cell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                        <span class="c1"># half of bounding box is required,</span>
                        <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">],</span>
                                         <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">])</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

                        <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span>

                        <span class="c1"># ARC</span>
                        <span class="c1"># half of bounding box is required,</span>
                        <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_er</span><span class="p">],</span>
                                         <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">])</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span>

                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># calculate new shift</span>
                        <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;if else&quot;</span><span class="p">)</span>
                        <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                        <span class="c1"># half of bounding box is required,</span>
                        <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">],</span>
                                         <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">])</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># ARC</span>
                        <span class="c1"># half of bounding box is required,</span>
                        <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_m</span><span class="p">],</span>
                                         <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
                        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                                <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                        <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># calculate new shift</span>
                        <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="p">(</span><span class="n">L_el</span> <span class="o">+</span> <span class="n">L_m</span><span class="p">)</span>
                        <span class="n">ic</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_cell</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;elif&quot;</span><span class="p">)</span>
                    <span class="c1"># DRAW ARC:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                     <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">],</span>
                                     <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_m</span><span class="p">],</span>
                                     <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span><span class="p">]</span>
                    <span class="n">ic</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># calculate new shift</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;else&quot;</span><span class="p">)</span>
                    <span class="c1"># DRAW ARC:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_m</span> <span class="o">+</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">a_m</span><span class="p">,</span> <span class="n">b_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW LINE CONNECTING ARCS</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">shift</span> <span class="o">+</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># DRAW ARC, FIRST EQUATOR ARC TO NEXT POINT</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span> <span class="o">-</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">A_m</span><span class="p">,</span> <span class="n">B_m</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span>
                                     <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_m</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># EQUATOR ARC TO NEXT POINT</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">A_er</span><span class="p">,</span> <span class="n">B_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Req_er</span> <span class="o">-</span> <span class="n">B_er</span><span class="p">],</span>
                                     <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Req_er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x2er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y2er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># STRAIGHT LINE TO NEXT POINT</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">x1er</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">]</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># ARC</span>
                    <span class="c1"># half of bounding box is required,</span>
                    <span class="c1"># start is the lower coordinate of the bounding box and end is the upper</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span> <span class="o">+</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">a_er</span><span class="p">,</span> <span class="n">b_er</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ri_er</span><span class="p">],</span>
                                     <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">y1er</span><span class="p">])</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found one&quot;</span><span class="p">)</span>
                    <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   1.0000000e+00   1.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># BEAM PIPE</span>
            <span class="c1"># reset shift</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pt before&quot;</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="n">L_bp_r</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="n">Ri_er</span><span class="p">]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   3.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pt after&quot;</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span>

            <span class="c1"># END PATH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">step</span><span class="p">)</span>  <span class="c1"># to add beam pipe to right</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">L_m</span> <span class="o">+</span> <span class="n">L_el</span> <span class="o">+</span> <span class="n">L_er</span> <span class="o">+</span> <span class="n">L_bp_l</span> <span class="o">+</span> <span class="n">L_bp_r</span> <span class="o">-</span> <span class="n">shift</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># lineTo(pt, [2 * n_cell * L_er + L_bp_l - shift, 0], step)</span>
            <span class="c1"># pt = [2 * n_cell * L_er + L_bp_l - shift, 0]</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># CLOSE PATH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.7E</span><span class="si">}</span><span class="s2">   0.0000000e+00   0.0000000e+00</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

        <span class="c1"># plt.show()</span>

<div class="viewcode-block" id="Cavities.ql_pin"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.ql_pin">[docs]</a>    <span class="k">def</span> <span class="nf">ql_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">RF</span><span class="p">,</span> <span class="n">QOI</span><span class="p">,</span> <span class="n">Machine</span><span class="p">,</span> <span class="n">p_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the value of input power as a function of loaded quality factor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        labels: list, array like</span>
<span class="sd">            Descriptive labels on matplotlib plot</span>
<span class="sd">        geometry: list, array like</span>
<span class="sd">            List of grouped geometric input parameters</span>
<span class="sd">        RF: list, array like</span>
<span class="sd">            List of grouped radio-frequency (RF) properties</span>
<span class="sd">        QOI:</span>
<span class="sd">            List of quantities of interest for cavities</span>
<span class="sd">        Machine:</span>
<span class="sd">            List of grouped machine related materials</span>
<span class="sd">        p_data:</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if entries are of same length</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">RF</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">QOI</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">Machine</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">n_cells</span><span class="p">,</span> <span class="n">l_cells</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">]</span>
        <span class="n">E_acc</span><span class="p">,</span> <span class="n">Vrf</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RF</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="c1"># QOI</span>
        <span class="n">f0</span><span class="p">,</span> <span class="n">R_Q</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">QOI</span><span class="p">]</span>

        <span class="c1"># Machine</span>
        <span class="n">I0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Machine</span><span class="p">]</span>

        <span class="n">l_active</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="n">l_cells</span>
        <span class="n">l_cavity</span> <span class="o">=</span> <span class="n">l_active</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">l_cells</span>

        <span class="c1"># CALCULATED</span>
        <span class="n">v_cav</span> <span class="o">=</span> <span class="n">E_acc</span> <span class="o">*</span> <span class="n">l_active</span>

        <span class="n">U_loss</span> <span class="o">=</span> <span class="mf">88.46</span> <span class="o">*</span> <span class="n">E0</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># GeV # energy lost per turn per beam</span>
        <span class="n">v_loss</span> <span class="o">=</span> <span class="n">U_loss</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># V # v loss per beam</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">v_loss</span><span class="p">,</span> <span class="n">Vrf</span><span class="p">,</span> <span class="n">v_loss</span> <span class="o">/</span> <span class="n">Vrf</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">v_loss</span> <span class="o">/</span> <span class="n">Vrf</span><span class="p">)</span>
        <span class="n">delta_f</span> <span class="o">=</span> <span class="o">-</span><span class="n">R_Q</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">*</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_cav</span><span class="p">)</span>  <span class="c1"># optimal df</span>
        <span class="n">QL_0_x</span> <span class="o">=</span> <span class="n">v_cav</span> <span class="o">/</span> <span class="p">(</span><span class="n">R_Q</span> <span class="o">*</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>  <span class="c1"># optimal Q loaded</span>

        <span class="n">QL_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

        <span class="n">xy_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)):</span>
            <span class="n">f1_2</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">QL_0</span><span class="p">)</span>  <span class="c1"># 380.6</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Vrf</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span><span class="p">)</span> <span class="o">*</span> \
                  <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span> <span class="o">*</span> <span class="n">I0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                   <span class="p">((</span><span class="n">delta_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">f1_2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span> <span class="o">*</span> <span class="n">I0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># p_cryo = 8 / (np.sqrt(f0[i] / 500e6))</span>

            <span class="c1"># material/ wall power</span>
            <span class="n">e_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># MV/m</span>

            <span class="c1"># Rs_NbCu_4_5k_400Mhz = 39.5 * np.exp(0.014 * (E_acc[i] * 1e-6 * b[i])) + 27</span>

            <span class="c1"># eta = 1 / 219  # c</span>
            <span class="c1"># Q0 = G[i] * 1e9 / Rs_NbCu_4_5k_400Mhz  # c</span>
            <span class="c1"># print(E_acc[i])</span>
            <span class="c1"># p_wp = (1 / eta) * Vrf[i] * (E_acc[i] * l_active[i] / (R_Q[i] * Q0)) + (1 / eta) * (</span>
            <span class="c1">#         l_cavity[i] * Vrf[i] / (l_active[i] * E_acc[i])) * p_cryo</span>
            <span class="c1"># txt = f&quot;{labels[i]}, &quot; \</span>
            <span class="c1">#       f&quot;{n_cells[i]}-Cell {int(f0[i] / 1e6)} MHz {int(np.ceil(Vrf[i] / (E_acc[i] * l_active[i])))} &quot; \</span>
            <span class="c1">#       f&quot;cav; &quot; + &quot;P$_{\mathrm{in}}$ = &quot; \</span>
            <span class="c1">#       + f&quot;{round(min(pin) * 1e-3, 1)} kW; &quot; \</span>
            <span class="c1">#         &quot;Q$_{\mathrm{L, 0}}^*$ = &quot; \</span>
            <span class="c1">#       + &quot;{:.2e}&quot;.format(QL_0_x[i])</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QL_0</span><span class="p">,</span> <span class="n">pin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QL_0</span><span class="p">,</span> <span class="n">pin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1"># add annotations</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">l_active</span><span class="p">)</span>

            <span class="c1"># annotext = ax.annotate(txt, xy=xy_list[i], xycoords=&#39;figure fraction&#39;, size=8, rotation=0,</span>
            <span class="c1">#                        c=l[0].get_color())</span>

        <span class="k">if</span> <span class="n">p_data</span><span class="p">:</span>
            <span class="c1"># plot QL with penetration</span>
            <span class="n">ax_2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">excel_reader</span><span class="p">(</span><span class="n">p_data</span><span class="p">)</span>
            <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">ax_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_</span><span class="p">[</span><span class="s2">&quot;QL&quot;</span><span class="p">],</span> <span class="n">data_</span><span class="p">[</span><span class="s2">&quot;penetration&quot;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># plot decorations</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Q_{L,0}$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{in}</span><span class="s2"> ~[\mathrm</span><span class="si">{kW}</span><span class="s2">]$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">5e3</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>  <span class="c1">#</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="c1"># ax.grid(which=&#39;both&#39;)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.run_slans"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.run_slans">[docs]</a>    <span class="k">def</span> <span class="nf">run_slans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">cav</span><span class="o">.</span><span class="n">run_slans</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.run_abci"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.run_abci">[docs]</a>    <span class="k">def</span> <span class="nf">run_abci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">cav</span><span class="o">.</span><span class="n">run_abci</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.run_multipacting"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.run_multipacting">[docs]</a>    <span class="k">def</span> <span class="nf">run_multipacting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">:</span>
            <span class="n">cav</span><span class="o">.</span><span class="n">run_multipacting</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavities.linspace"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.linspace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Like np.linspace but uses step instead of num</span>
<span class="sd">        This is inclusive to stop, so if start=1, stop=3, step=0.5</span>
<span class="sd">        Output is: array([1., 1.5, 2., 2.5, 3.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">stop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ll</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">start</span> <span class="o">-</span> <span class="n">stop</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ll</span></div>

<div class="viewcode-block" id="Cavities.lineTo"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.lineTo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">lineTo</span><span class="p">(</span><span class="n">prevPt</span><span class="p">,</span> <span class="n">nextPt</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># vertical line</span>
            <span class="c1"># chwxk id nextPt is greater</span>
            <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">py</span><span class="p">))</span> <span class="o">*</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c1"># horizontal line</span>
            <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">)</span>

            <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="p">))</span> <span class="o">*</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># calculate angle to get appropriate step size for x and y</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nextPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prevPt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
                <span class="n">py</span> <span class="o">=</span> <span class="n">py</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

        <span class="c1"># plt.plot(px, py)</span>

<div class="viewcode-block" id="Cavities.arcTo2"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.arcTo2">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">arcTo2</span><span class="p">(</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">start_angle</span><span class="p">,</span> <span class="n">end_angle</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">x_center</span>  <span class="c1"># x-position of the center</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">y_center</span>  <span class="c1"># y-position of the center</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># radius on the x-axis</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span>  <span class="c1"># radius on the y-axis</span>
        <span class="n">sa</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_angle</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># convert angle to radians</span>
        <span class="n">ea</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_angle</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># convert angle to radians</span>

        <span class="k">if</span> <span class="n">ea</span> <span class="o">&lt;</span> <span class="n">sa</span><span class="p">:</span>
            <span class="c1"># end point of curve</span>
            <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sa</span><span class="p">),</span> <span class="n">v</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            <span class="c1"># t = np.linspace(ea, sa, 100)</span>
            <span class="c1"># check if end angle is included, include if not</span>
            <span class="k">if</span> <span class="n">sa</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sa</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># end point of curve</span>
            <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ea</span><span class="p">),</span> <span class="n">v</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ea</span><span class="p">)</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            <span class="c1"># t = np.linspace(ea, sa, 100)</span>
            <span class="k">if</span> <span class="n">ea</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ea</span><span class="p">)</span>

        <span class="c1"># print(&quot;t0 &quot;, [(u + a * np.cos(t))[0], (v + b * np.sin(t))[0]])</span>
        <span class="c1"># ic([u + a * np.cos(t), v + b * np.sin(t)])</span>
        <span class="c1"># ic()</span>

        <span class="c1"># plt.plot(u + a * np.cos(t), v + b * np.sin(t))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span><span class="p">]</span></div>

<div class="viewcode-block" id="Cavities.arcTo"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.arcTo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">arcTo</span><span class="p">(</span><span class="n">x_center</span><span class="p">,</span> <span class="n">y_center</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">x_center</span>  <span class="c1"># x-position of the center</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">y_center</span>  <span class="c1"># y-position of the center</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># radius on the x-axis</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span>  <span class="c1"># radius on the y-axis</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">inidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pts</span><span class="p">,</span> <span class="n">pts</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">end</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">inbox</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">inidx</span><span class="p">]</span>
        <span class="n">inbox</span> <span class="o">=</span> <span class="n">inbox</span><span class="p">[</span><span class="n">inbox</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>

        <span class="c1"># plt.plot(inbox[:, 0], inbox[:, 1])</span>

        <span class="k">return</span> <span class="n">inbox</span></div>

<div class="viewcode-block" id="Cavities.make_latex_summary_tables"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.make_latex_summary_tables">[docs]</a>    <span class="k">def</span> <span class="nf">make_latex_summary_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{table}</span><span class="s2">[!htb]&quot;</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\centering&quot;</span>
            <span class="n">l3</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\caption{Geometric parameters and QoIs of cavities.}&quot;</span>
            <span class="n">l4</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{tabular}{lccc}</span><span class="s2">&quot;</span>
            <span class="n">l5</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\toprule&quot;</span>
            <span class="n">l6</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l7</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l8</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l9</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$A$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l10</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$B$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l11</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$a$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l12</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$b$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l13</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$R_\mathrm</span><span class="si">{i}</span><span class="s2">$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l14</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$L$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l15</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$R_\mathrm</span><span class="si">{eq}</span><span class="s2">$ [mm] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l16</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$ \alpha [^\circ]$&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l17</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l18</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l19</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$R/Q [\Omega$] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l20</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$G [\Omega$] &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l21</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$G.R/Q [10^4\Omega^2]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">GR_Q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l22</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$E_{\mathrm</span><span class="si">{pk}</span><span class="s2">}/E_{\mathrm</span><span class="si">{acc}</span><span class="s2">}$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l23</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$B_{\mathrm</span><span class="si">{pk}</span><span class="s2">}/E_{\mathrm</span><span class="si">{acc}</span><span class="s2">} [\mathrm{\frac</span><span class="si">{mT}</span><span class="s2">{MV/m}}]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l24</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$|k_\mathrm</span><span class="si">{FM}</span><span class="s2">| \mathrm{[SR/BS]} [\mathrm{V/pC}]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">k_fm</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l25</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$|k_\mathrm{\parallel}| \mathrm{[SR/BS]} [\mathrm{V/pC}]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">k_loss</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l26</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$k_\mathrm{\perp} \mathrm{[SR/BS]} [\mathrm{V/pC/m}]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">k_kick</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l27</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{HOM}</span><span class="s2">\mathrm{/cav} \mathrm{[SR/BS]} [\mathrm</span><span class="si">{W}</span><span class="s2">]$ &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">phom</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l28</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\bottomrule&quot;</span>
            <span class="n">l29</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{tabular}</span><span class="s2">&quot;</span>
            <span class="n">l30</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\label{tab: selected shape}&quot;</span>
            <span class="n">l31</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{table}</span><span class="s2">&quot;</span>

            <span class="n">all_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">,</span> <span class="n">l4</span><span class="p">,</span> <span class="n">l5</span><span class="p">,</span> <span class="n">l6</span><span class="p">,</span> <span class="n">l7</span><span class="p">,</span> <span class="n">l8</span><span class="p">,</span> <span class="n">l9</span><span class="p">,</span> <span class="n">l10</span><span class="p">,</span>
                         <span class="n">l11</span><span class="p">,</span> <span class="n">l12</span><span class="p">,</span> <span class="n">l13</span><span class="p">,</span> <span class="n">l14</span><span class="p">,</span> <span class="n">l15</span><span class="p">,</span> <span class="n">l16</span><span class="p">,</span> <span class="n">l17</span><span class="p">,</span> <span class="n">l18</span><span class="p">,</span> <span class="n">l19</span><span class="p">,</span> <span class="n">l20</span><span class="p">,</span>
                         <span class="n">l21</span><span class="p">,</span> <span class="n">l22</span><span class="p">,</span> <span class="n">l23</span><span class="p">,</span> <span class="n">l24</span><span class="p">,</span> <span class="n">l25</span><span class="p">,</span> <span class="n">l26</span><span class="p">,</span> <span class="n">l27</span><span class="p">,</span> <span class="n">l28</span><span class="p">,</span> <span class="n">l29</span><span class="p">,</span> <span class="n">l30</span><span class="p">,</span>
                         <span class="n">l31</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\MuCol_Study\SimulationData\Summaries\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">_latex_summary.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ll</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Either SLANS or ABCI results not available. Please use &#39;&lt;cav&gt;.set_slans_qois(&lt;folder&gt;)&#39; &quot;</span>
                  <span class="s2">&quot;or &#39;&lt;cav&gt;.set_abci_qois(&lt;folder&gt;)&#39; to fix this.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.make_excel_summary"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.make_excel_summary">[docs]</a>    <span class="k">def</span> <span class="nf">make_excel_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Project&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">project</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;CW/Pulsed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">cw_pulsed</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Material&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">material</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;N_cells&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">n_cells</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Freq [MHz]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">op_freq</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Beta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">beta</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;T_oper [K]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">op_temp</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;I0 [mA]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">I0</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;sigma [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">sigma</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;A_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;B_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;a_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;b_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;L_i [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Req [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;alpha_i [deg]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;A_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;B_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;a_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;b_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;L_el [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="c1"># &#39;Req [mm]&#39;: [round(cav.d_geom_params[&#39;OC&#39;][6], 2) for cav in self.cavities_list],</span>
                    <span class="s1">&#39;alpha__el [deg]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;A_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;B_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;a_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;b_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;L_er [mm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="c1"># &#39;Req [mm]&#39;: [round(cav.d_geom_params[&#39;OC&#39;][6], 2) for cav in self.cavities_list],</span>
                    <span class="s1">&#39;alpha_er [deg]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">cav</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R_shunt [Ohm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R/Q [Ohm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">R_Q</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;k_cc [%]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">k_cc</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;field flatness [%]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">ff</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;L_active [m]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">l_active</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Epk/Eacc []&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">e</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Bpk/Eacc [mT/MV/m]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">b</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;G [Ohm]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">G</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;R/Q.G [Ohm^2]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">GR_Q</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;|k_loss| [V/pC]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">k_loss</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;|k_kick| [V/pC/m]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">k_kick</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;P_HOM/cav [kW]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">phom</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">],</span>
                    <span class="s1">&#39;Reference&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cav</span><span class="o">.</span><span class="n">reference</span> <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="p">]</span>
                    <span class="p">}</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\MuCol_Study\SimulationData\Summaries\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">_excel_summary.xlsx&quot;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Cavities&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Either SLANS or ABCI results not available. Please use &#39;&lt;cav&gt;.set_slans_qois(&lt;folder&gt;)&#39; &quot;</span>
                  <span class="s2">&quot;or &#39;&lt;cav&gt;.set_abci_qois(&lt;folder&gt;)&#39; to fix this.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.add_cavity"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.add_cavity">[docs]</a>    <span class="k">def</span> <span class="nf">add_cavity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cav</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds cavity to cavities</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cav: object</span>
<span class="sd">            Cavity object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cav</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.remove_cavity"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.remove_cavity">[docs]</a>    <span class="k">def</span> <span class="nf">remove_cavity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cav</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes cavity from cavity list</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cav: object</span>
<span class="sd">            Cavity object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cav</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavities.save_all_plots"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavities.save_all_plots">[docs]</a>    <span class="k">def</span> <span class="nf">save_all_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save all plots</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_name: str</span>
<span class="sd">            Name of saved plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># check if folder exists</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\Quick presentation files\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">save_folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\Quick presentation files\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">plot_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">save_folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\Quick presentation files\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">save_folder</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">plot_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cavities_list</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="Cavity"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity">[docs]</a><span class="k">class</span> <span class="nc">Cavity</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cavity class defines cavity parameters and operation settings for several cavity analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">vrf</span><span class="p">,</span> <span class="n">R_Q</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">219</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Unnamed&quot;</span><span class="p">,</span>
                 <span class="n">op_field</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs all the necessary attributes of the Cavity object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_cells: int</span>
<span class="sd">            Number of cells of the cavity</span>
<span class="sd">        l_cell_mid: float</span>
<span class="sd">            Length of the mid cell of the cavity</span>
<span class="sd">        freq: float</span>
<span class="sd">            Fundamental mode frequency of the cavity</span>
<span class="sd">        vrf: float</span>
<span class="sd">            Radio-frequency voltage at which the cavity is designed to operate at</span>
<span class="sd">        R_Q: float</span>
<span class="sd">            R/Q of the cavity. R/Q is the energy stored to power loss ratio of the cavity.</span>
<span class="sd">        G: float</span>
<span class="sd">            Geometric factor of the cavity.</span>
<span class="sd">        Epk_Eacc: float, list, array like</span>
<span class="sd">            Peak electric field to accelerating electric field ratio for the fundamental mode</span>
<span class="sd">        Bpk_Eacc</span>
<span class="sd">            Peak magnetic field to accelerating electric field ratio for the fundamental mode</span>
<span class="sd">        inv_eta: float</span>
<span class="sd">            Inverse of eta which is the refrigerating efficiency of the cryomodule</span>
<span class="sd">        name: str</span>
<span class="sd">            Name given to the cavity. This is the name that will appear in plots.</span>
<span class="sd">        op_field:</span>
<span class="sd">            Electric field value at which the cavity is to operate.</span>
<span class="sd">        wp: float</span>
<span class="sd">            Working point of the cavity.</span>
<span class="sd">        op_temp: str</span>
<span class="sd">            Temperature at which the cavity is designed to operate</span>
<span class="sd">        material: str</span>
<span class="sd">            Cavity wall material</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># geometric parameters</span>
        <span class="c1"># input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_slans_all_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abci_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_cc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_pulsed</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_temp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_temp</span> <span class="o">=</span> <span class="n">op_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;Elliptical&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_loss</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_kick</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_eta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_field</span> <span class="o">=</span> <span class="n">op_field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_wp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdyn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_cryo</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_cavity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cav</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cav_op_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">=</span> <span class="n">n_cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_cell_mid</span> <span class="o">=</span> <span class="n">l_cell_mid</span>  <span class="c1"># m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">=</span> <span class="n">vrf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span> <span class="o">=</span> <span class="n">R_Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_fm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">=</span> <span class="n">freq</span>  <span class="c1"># Hz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Epk_Eacc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Bpk_Eacc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wp</span> <span class="o">=</span> <span class="n">wp</span>  <span class="c1"># working point</span>

        <span class="c1"># calculated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_cell_mid</span>  <span class="c1"># m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cav_op_field</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_field</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span><span class="p">)))</span>
        <span class="c1"># self.l_cavity = self.n_cav * self.n_cells * self.l_active + (self.n_cav - 1) * 6 * self.l_active</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># V/m</span>

        <span class="c1"># cryo parameters</span>
        <span class="c1"># self.eta = 1/219  # 400 MHz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">inv_eta</span>  <span class="c1"># 800 MHz</span>

        <span class="c1"># power parameters</span>
        <span class="c1"># calculated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_sr</span> <span class="o">=</span> <span class="mf">50e6</span>  <span class="c1"># W</span>

<div class="viewcode-block" id="Cavity.set_Eacc"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_Eacc">[docs]</a>    <span class="k">def</span> <span class="nf">set_Eacc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Eacc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the accelerating field range of analysis for the cavity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Eacc: list, array like</span>
<span class="sd">            Accelerating field range of interest</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">=</span> <span class="n">Eacc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_cavity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_cell_mid</span>  <span class="c1"># L_cavity = L_active + 2 λ0</span>

        <span class="n">Rs_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Rs_NbCu_2K_400.79Mhz&quot;</span><span class="p">:</span> <span class="mf">0.57</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mf">28.4</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_NbCu_4.5K_400.79Mhz&quot;</span><span class="p">:</span> <span class="mf">39.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.014</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="mi">27</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_bulkNb_2K_400.79Mhz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.33</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">26.24</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_bulkNb_4.5K_400.79Mhz&quot;</span><span class="p">:</span> <span class="mf">0.0123</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">62.53</span><span class="p">,</span>  <span class="c1"># nOhm</span>

            <span class="s2">&quot;Rs_NbCu_2K_801.58Mhz&quot;</span><span class="p">:</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">92</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_NbCu_4.5K_801.58Mhz&quot;</span><span class="p">:</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.033</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="mi">154</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_bulkNb_2K_801.58Mhz&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">16.4</span> <span class="o">+</span> <span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="mf">0.092</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">800</span> <span class="o">/</span> <span class="mi">704</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># nOhm</span>
            <span class="s2">&quot;Rs_bulkNb_4.5K_801.58Mhz&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mf">62.7</span> <span class="o">+</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.012</span><span class="p">)</span>  <span class="c1"># nOhm</span>
        <span class="p">}</span>

        <span class="c1"># if np.isclose(self.op_freq, 801.58e6):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rs_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op_temp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">Mhz&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="n">Rs_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Rs_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op_temp</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">Mhz&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span> <span class="o">=</span> <span class="n">Rs_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Rs_bulkNb_2K_801.58Mhz&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rs</span>  <span class="c1"># c</span>
        <span class="c1"># ic(&quot;800 MHz&quot;)</span>
        <span class="c1"># elif np.isclose(self.op_freq, 400.79e6):</span>
        <span class="c1">#     self.Rs = Rs_bulkNb_2k_800Mhz</span>
        <span class="c1">#     self.Q0 = self.G * 1e9 / Rs_NbCu_4_5k_400Mhz  # c</span>
        <span class="c1">#     # ic(&quot;400 MHz&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavity.get_Eacc"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.get_Eacc">[docs]</a>    <span class="k">def</span> <span class="nf">get_Eacc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the accelerating field range of the Cavity object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Accelerating field range of cavity. To set the accelerating field range, use</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span></div>

<div class="viewcode-block" id="Cavity.set_op_field"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_op_field">[docs]</a>    <span class="k">def</span> <span class="nf">set_op_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the operating field of the cavity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        op_field: float</span>
<span class="sd">            Electric field value at which the cavity is to operate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_field</span> <span class="o">=</span> <span class="n">op_field</span></div>

<div class="viewcode-block" id="Cavity.get_op_field"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.get_op_field">[docs]</a>    <span class="k">def</span> <span class="nf">get_op_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the operating field of the cavity</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            returns operating field value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_field</span></div>

<div class="viewcode-block" id="Cavity.set_inv_eta"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_inv_eta">[docs]</a>    <span class="k">def</span> <span class="nf">set_inv_eta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inv_eta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_eta</span> <span class="o">=</span> <span class="n">inv_eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">inv_eta</span></div>

<div class="viewcode-block" id="Cavity.get_inv_eta"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.get_inv_eta">[docs]</a>    <span class="k">def</span> <span class="nf">get_inv_eta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_eta</span></div>

<div class="viewcode-block" id="Cavity.set_vrf"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_vrf">[docs]</a>    <span class="k">def</span> <span class="nf">set_vrf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">=</span> <span class="n">vrf</span></div>

<div class="viewcode-block" id="Cavity.get_vrf"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.get_vrf">[docs]</a>    <span class="k">def</span> <span class="nf">get_vrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span></div>

<div class="viewcode-block" id="Cavity.get_power"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.get_power">[docs]</a>    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_sr</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cav</span>  <span class="c1"># maximum synchrotron radiation per beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_cryo</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">/</span> <span class="mf">500e6</span><span class="p">))</span>  <span class="c1"># W/m</span>

        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_cavity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdyn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_active</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pstat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_cavity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_active</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_acc</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_cryo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_wp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdyn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pstat</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_in</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_wp</span></div>

<div class="viewcode-block" id="Cavity.set_slans_qois"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_slans_qois">[docs]</a>    <span class="k">def</span> <span class="nf">set_slans_qois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slans_dir</span> <span class="o">=</span> <span class="n">folder_name</span>
        <span class="n">slans_svl</span> <span class="o">=</span> <span class="s1">&#39;cavity_33.svl&#39;</span>
        <span class="n">qois</span> <span class="o">=</span> <span class="s1">&#39;qois.json&#39;</span>
        <span class="n">geom_params</span> <span class="o">=</span> <span class="s1">&#39;geometric_parameters.json&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">qois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">geom_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d_slans_all_results</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">svl_reader</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">slans_svl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ic(d_qois)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_cell_mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-3</span>
        <span class="c1"># self.op_freq = self.d_qois_slans[&#39;freq [MHz]&#39;] * 1e6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;kcc [%]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;ff [%]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;R/Q [Ohm]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;GR/Q [Ohm^2]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span>
        <span class="c1"># print(G)</span>
        <span class="c1"># self.Q = d_qois[&#39;Q []&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;Epk/Eacc []&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_qois_slans</span><span class="p">[</span><span class="s1">&#39;Bpk/Eacc [mT/MV/m]&#39;</span><span class="p">]</span>

        <span class="c1"># get axis field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_field</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">txt_reader</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\cavity_33_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="si">}</span><span class="s2">.af&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1"># print(self.axis_field)</span>

        <span class="c1"># get surface field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_field</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">txt_reader</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\cavity_33_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="si">}</span><span class="s2">.sf&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span></div>
        <span class="c1"># print(self.surface_field)</span>

<div class="viewcode-block" id="Cavity.set_abci_qois"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.set_abci_qois">[docs]</a>    <span class="k">def</span> <span class="nf">set_abci_qois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_name</span><span class="p">,</span> <span class="n">working_point</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abci_dir</span> <span class="o">=</span> <span class="n">folder_name</span>

        <span class="n">qois</span> <span class="o">=</span> <span class="s1">&#39;qois.json&#39;</span>
        <span class="n">geom_params</span> <span class="o">=</span> <span class="s1">&#39;geometric_parameters.json&#39;</span>

        <span class="n">d_qois</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">qois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">d_qois</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">))</span>

        <span class="n">d_geom_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">geom_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">d_geom_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">))</span>

        <span class="c1"># ic(d_geom_params)</span>

        <span class="n">d_qois</span> <span class="o">=</span> <span class="n">d_qois</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">working_point</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">bunch_length</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k_fm</span> <span class="o">=</span> <span class="n">d_qois</span><span class="p">[</span><span class="s1">&#39;k_FM [V/pC]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_loss</span> <span class="o">=</span> <span class="n">d_qois</span><span class="p">[</span><span class="s1">&#39;|k_loss| [V/pC]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_kick</span> <span class="o">=</span> <span class="n">d_qois</span><span class="p">[</span><span class="s1">&#39;|k_kick| [V/pC/m]&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phom</span> <span class="o">=</span> <span class="n">d_qois</span><span class="p">[</span><span class="s1">&#39;P_HOM [kW]&#39;</span><span class="p">]</span></div>

        <span class="c1"># ic(d_qois)</span>

<div class="viewcode-block" id="Cavity.plot_multipac_triplot"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.plot_multipac_triplot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_multipac_triplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;triplot&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
            <span class="c1"># create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

        <span class="n">Eacc</span><span class="p">,</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># load_output_data</span>
        <span class="c1"># files</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ccounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Acounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Atcounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;Efcounter.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;param&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;geodata.n&quot;</span><span class="p">,</span> <span class="s2">&quot;secy1&quot;</span><span class="p">,</span> <span class="s2">&quot;counter_flevels.mat&quot;</span><span class="p">,</span> <span class="s2">&quot;counter_initials.mat&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># files_folder = &quot;D:\Dropbox\multipacting\MPGUI21&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;.mat&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Acounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span>
        <span class="n">At</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Atcounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;At&quot;</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Ccounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;C&quot;</span><span class="p">]</span>
        <span class="n">Ef</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Efcounter.mat&quot;</span><span class="p">][</span><span class="s2">&quot;Ef&quot;</span><span class="p">]</span>
        <span class="n">flevel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counter_flevels.mat&quot;</span><span class="p">][</span><span class="s2">&quot;flevel&quot;</span><span class="p">]</span>
        <span class="n">initials</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;counter_initials.mat&quot;</span><span class="p">][</span><span class="s2">&quot;initials&quot;</span><span class="p">]</span>
        <span class="n">secy1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;secy1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">Pow</span> <span class="o">=</span> <span class="n">flevel</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initials</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># number of initials in the bright set</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;param&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># number of impacts</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">flevel</span>
        <span class="n">Efl</span> <span class="o">=</span> <span class="n">flevel</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">1.6021773e-19</span>
        <span class="n">Efq</span> <span class="o">=</span> <span class="n">Ef</span> <span class="o">/</span> <span class="n">q</span>

        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># lower threshold</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># upper threshold</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">secy1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># maximum secondary yield</span>

        <span class="n">cl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ok</span><span class="p">,</span> <span class="n">ok1</span><span class="p">,</span> <span class="n">ok2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Unable to plot the counters. No initial points.&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">ok1</span> <span class="o">*</span> <span class="n">ok2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cl</span> <span class="o">=</span> <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Counter functions or impact energy missing.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if ss &gt; 0:</span>
                <span class="c1">#     cl = ic(np.array([&#39;Plotting the triplot (counter, enhanced &#39;, &#39;counter and impact energy).&#39;]))</span>

                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;counter function&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                    <span class="c1"># fig, axs = plt.subplots(3)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">C</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$c_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}/ c_0 $&quot;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                    <span class="c1"># axs[0].set_title(r&#39;$\mathbf{MultiPac 2.1~~~~~Counter function~~~~}$&#39;)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]))</span>

                    <span class="c1"># plot peak operating field</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;final impact energy&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">Efq</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                    <span class="c1"># axs[1].plot([np.min(Efl) / 1e6, np.max(Efl) / 1e6], [secy1[e1, 0], secy1[e1, 0]], &#39;-r&#39;)</span>
                    <span class="n">e0</span> <span class="o">=</span> <span class="n">sci</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">secy1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">e0</span><span class="p">,</span> <span class="n">e0</span><span class="p">],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">secy1</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="n">e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="n">secy1</span><span class="p">[</span><span class="n">e3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secy1</span><span class="p">[</span><span class="n">e3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;--r&#39;</span><span class="p">)</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$Ef_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                    <span class="c1"># axs[1].set_title(&#39;$\mathbf{Final~Impact~Energy~in~eV}$&#39;)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;enhanced counter function&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;triplot&#39;</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Efl</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$V$ [MV]&#39;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Efl</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">),</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$e_&quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span> <span class="o">+</span> <span class="s2">&quot;/ c_0$&quot;</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_\mathrm</span><span class="si">{pk}</span><span class="s1">$ [MV/m]&#39;</span><span class="p">)</span>
                    <span class="c1"># axs[2].set_title(&#39;$\mathbf{Enhanced~counter~function}$&#39;)</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">Epk_Eacc</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV/m&quot;</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">())</span>

                    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavity.ql_pin"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.ql_pin">[docs]</a>    <span class="k">def</span> <span class="nf">ql_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">RF</span><span class="p">,</span> <span class="n">QOI</span><span class="p">,</span> <span class="n">Machine</span><span class="p">,</span> <span class="n">p_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># check if entries are of same length</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">RF</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">QOI</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">Machine</span><span class="p">)</span>
        <span class="n">the_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">the_len</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">it</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not all lists have same length!&#39;</span><span class="p">)</span>

        <span class="n">n_cells</span><span class="p">,</span> <span class="n">l_cells</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">]</span>
        <span class="n">E_acc</span><span class="p">,</span> <span class="n">Vrf</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RF</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cid_pick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_pick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid_motion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_motion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid_button_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_press</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid_button_release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_release</span><span class="p">)</span>

        <span class="c1"># QOI</span>
        <span class="n">f0</span><span class="p">,</span> <span class="n">R_Q</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">QOI</span><span class="p">]</span>

        <span class="c1"># Machine</span>
        <span class="n">I0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Machine</span><span class="p">]</span>

        <span class="n">l_active</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_cells</span> <span class="o">*</span> <span class="n">l_cells</span>
        <span class="n">l_cavity</span> <span class="o">=</span> <span class="n">l_active</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">l_cells</span>

        <span class="c1"># CALCULATED</span>
        <span class="n">v_cav</span> <span class="o">=</span> <span class="n">E_acc</span> <span class="o">*</span> <span class="n">l_active</span>

        <span class="n">U_loss</span> <span class="o">=</span> <span class="mf">88.46</span> <span class="o">*</span> <span class="n">E0</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">rho</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># GeV # energy lost per turn per beam</span>
        <span class="n">v_loss</span> <span class="o">=</span> <span class="n">U_loss</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># V # v loss per beam</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">v_loss</span><span class="p">,</span> <span class="n">Vrf</span><span class="p">,</span> <span class="n">v_loss</span> <span class="o">/</span> <span class="n">Vrf</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">v_loss</span> <span class="o">/</span> <span class="n">Vrf</span><span class="p">)</span>
        <span class="n">delta_f</span> <span class="o">=</span> <span class="o">-</span><span class="n">R_Q</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">*</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v_cav</span><span class="p">)</span>  <span class="c1"># optimal df</span>
        <span class="n">QL_0_x</span> <span class="o">=</span> <span class="n">v_cav</span> <span class="o">/</span> <span class="p">(</span><span class="n">R_Q</span> <span class="o">*</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>  <span class="c1"># optimal Q loaded</span>

        <span class="n">QL_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

        <span class="n">xy_list</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)):</span>
            <span class="n">f1_2</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">QL_0</span><span class="p">)</span>  <span class="c1"># 380.6</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Vrf</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span><span class="p">)</span> <span class="o">*</span> \
                  <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span> <span class="o">*</span> <span class="n">I0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                   <span class="p">((</span><span class="n">delta_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">f1_2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">R_Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">QL_0</span> <span class="o">*</span> <span class="n">I0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># p_cryo = 8 / (np.sqrt(f0[i] / 500e6))</span>

            <span class="c1"># material/ wall power</span>
            <span class="n">e_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># MV/m</span>

            <span class="c1"># Rs_NbCu_4_5k_400Mhz = 39.5 * np.exp(0.014 * (E_acc[i] * 1e-6 * b[i])) + 27</span>

            <span class="c1"># eta = 1 / 219  # c</span>
            <span class="c1"># Q0 = G[i] * 1e9 / Rs_NbCu_4_5k_400Mhz  # c</span>
            <span class="c1"># print(E_acc[i])</span>
            <span class="c1"># p_wp = (1 / eta) * Vrf[i] * (E_acc[i] * l_active[i] / (R_Q[i] * Q0)) + (1 / eta) * (</span>
            <span class="c1">#         l_cavity[i] * Vrf[i] / (l_active[i] * E_acc[i])) * p_cryo</span>

            <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QL_0</span><span class="p">,</span> <span class="n">pin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">E_acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; ~[\mathrm{MV/m}]$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">QL_0</span><span class="p">,</span> <span class="n">pin</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">E_acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; ~[\mathrm{MV/m}]$&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1"># add annotations</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">l_active</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, &quot;</span> \
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_cells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">-Cell </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span><span class="si">}</span><span class="s2"> MHz </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Vrf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">E_acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">l_active</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span><span class="si">}</span><span class="s2"> &quot;</span> \
                  <span class="sa">f</span><span class="s2">&quot;cav/beam&quot;</span> <span class="o">+</span> <span class="s2">&quot; V$_\mathrm</span><span class="si">{RF}</span><span class="s2">\mathrm{/beam}$ =&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">Vrf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> GV &quot;</span> \
                  <span class="o">+</span> <span class="s2">&quot; V$_\mathrm</span><span class="si">{cav}</span><span class="s2">$ =&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">v_cav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> MV &quot;</span> \
                                            <span class="s2">&quot;P$_{\mathrm</span><span class="si">{in}</span><span class="s2">}/\mathrm</span><span class="si">{beam}</span><span class="s2">$ = &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> kW&quot;</span> \
                                                                                   <span class="s2">&quot;Q$_{\mathrm{L, 0}}^*$ = &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">QL_0_x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">annotext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;figure fraction&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">c</span><span class="o">=</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                                   <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">DraggableText</span><span class="p">(</span><span class="n">annotext</span><span class="p">)</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">text_dict</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">annotext</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dt</span>

        <span class="k">if</span> <span class="n">p_data</span><span class="p">:</span>
            <span class="c1"># plot QL with penetration</span>
            <span class="n">ax_2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">excel_reader</span><span class="p">(</span><span class="n">p_data</span><span class="p">)</span>
            <span class="n">data_</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">ax_2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_</span><span class="p">[</span><span class="s2">&quot;QL&quot;</span><span class="p">],</span> <span class="n">data_</span><span class="p">[</span><span class="s2">&quot;penetration&quot;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># plot decorations</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Q_{L,0}$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$P_\mathrm</span><span class="si">{in}</span><span class="s2"> ~[\mathrm</span><span class="si">{kW}</span><span class="s2">]$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">5e3</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$E_\mathrm</span><span class="si">{acc}</span><span class="s2">$&quot;</span><span class="p">)</span>  <span class="c1">#</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="c1"># ax.grid(which=&#39;both&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Cavity.on_motion"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.on_motion">[docs]</a>    <span class="k">def</span> <span class="nf">on_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># vis = self.annot.get_visible()</span>
        <span class="c1"># if isinstance(self.ax, event.inaxes):  # not so good fix</span>
        <span class="c1">#     cont, ind = self.plot_object.contains(event)</span>
        <span class="c1">#     if cont:</span>
        <span class="c1">#         self.update_annot(</span>
        <span class="c1">#             ind[&quot;ind&quot;][0])  # ind returns an array of close points. ind[&#39;ind&#39;][0] returns just the first point</span>
        <span class="c1">#         self.annot.set_visible(True)</span>
        <span class="c1">#         self.fig.canvas.draw_idle()</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         if vis:</span>
        <span class="c1">#             self.annot.set_visible(False)</span>
        <span class="c1">#             self.fig.canvas.draw_idle()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MOTION</span> <span class="o">=</span> <span class="kc">True</span></div>

        <span class="c1"># if self.PRESS and self.MOTION:</span>

<div class="viewcode-block" id="Cavity.run_slans"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.run_slans">[docs]</a>    <span class="k">def</span> <span class="nf">run_slans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Cavity.run_abci"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.run_abci">[docs]</a>    <span class="k">def</span> <span class="nf">run_abci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Cavity.run_multipacting"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.run_multipacting">[docs]</a>    <span class="k">def</span> <span class="nf">run_multipacting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Cavity.plot_ql_vs_pin"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.plot_ql_vs_pin">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ql_vs_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># geometry</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">]</span>
        <span class="n">l_cell</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">l_cell_mid</span><span class="p">]</span>
        <span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">]</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">l_cell</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

        <span class="c1"># QOI</span>
        <span class="n">R_Q</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span><span class="p">]</span>
        <span class="n">QOI</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">R_Q</span><span class="p">]</span>

        <span class="c1"># RF</span>
        <span class="c1"># Vrf = [2*0.1e9, 2*0.1e9, 2*0.75e9]  #   #2*0.75e9</span>
        <span class="c1"># Vrf = [2*0.12e9, 2*0.12e9, 2*1e9, 2*0.44e9]  #   #2*0.75e9 update</span>
        <span class="n">Vrf</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v_rf</span><span class="p">]</span>
        <span class="c1"># Eacc = [20e6, 20e6, 20e6]</span>
        <span class="n">Eacc</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_field</span><span class="p">]</span>
        <span class="n">RF</span> <span class="o">=</span> <span class="p">[</span><span class="n">Eacc</span><span class="p">,</span> <span class="n">Vrf</span><span class="p">]</span>

        <span class="c1"># MACHINE</span>
        <span class="c1"># I0 = [1390e-3, 1390e-3, 147e-3, 147e-3]  # mA</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="p">[</span><span class="n">WP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wp</span><span class="p">][</span><span class="s1">&#39;I0 [mA]&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">]</span>
        <span class="c1"># rho = [10.76e3, 10.76e3, 10.76e3, 10.76e3]  # bending radius</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">MACHINE</span><span class="p">[</span><span class="s1">&#39;rho [m]&#39;</span><span class="p">]]</span>  <span class="c1"># bending radius</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="p">[</span><span class="n">WP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wp</span><span class="p">][</span><span class="s1">&#39;E [GeV]&#39;</span><span class="p">]]</span>  <span class="c1"># Beam energy GeV</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="p">[</span><span class="n">I0</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">E0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ql_pin</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">RF</span><span class="p">,</span> <span class="n">QOI</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cavity.view"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># view cavity contour plot</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Cavity.write_cavity_for_multipac"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.write_cavity_for_multipac">[docs]</a>    <span class="k">def</span> <span class="nf">write_cavity_for_multipac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Cavity.make_latex_summary_tables"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Cavity.make_latex_summary_tables">[docs]</a>    <span class="k">def</span> <span class="nf">make_latex_summary_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l1m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{table}</span><span class="s2">[!htb]&quot;</span>
            <span class="n">l2m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\centering&quot;</span>
            <span class="n">l3m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\caption{Geometric parameters of optimized cavity&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.}&quot;</span>
            <span class="n">l4m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\resizebox{\textwidth}{!}{\begin</span><span class="si">{tabular}{cccccccc}</span><span class="s2">&quot;</span>
            <span class="n">l5m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\toprule&quot;</span>
            <span class="n">l6m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\multicolumn</span><span class="si">{8}{c}</span><span class="s2">{&quot;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; (Mid-cell) -  Geometric Properties} </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l7m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l8m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l9m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$A_\mathrm</span><span class="si">{m}</span><span class="s2">$ [mm] &amp; $B_\mathrm</span><span class="si">{m}</span><span class="s2">$ [mm] &amp; $a_\mathrm</span><span class="si">{m}</span><span class="s2">$ [mm] &amp; $b_\mathrm</span><span class="si">{m}</span><span class="s2">$ [mm] &amp; &quot;</span> \
                  <span class="sa">r</span><span class="s2">&quot;$R_\mathrm{i, m}$ [mm] &amp; $L_\mathrm</span><span class="si">{m}</span><span class="s2">$ [mm] &amp; $R_{eq, m}$ [mm] &amp; $\alpha_\mathrm</span><span class="si">{m}</span><span class="s2"> [^\circ]$ </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l10m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l11m</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l12m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\bottomrule&quot;</span>
            <span class="n">l13m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{tabular}</span><span class="s2">}&quot;</span>
            <span class="n">l14m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\label{tab: geometric cavity end-cell}&quot;</span>
            <span class="n">l15m</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{table}</span><span class="s2">&quot;</span>

            <span class="n">l_break</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">2</span>

            <span class="n">l1e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{table}</span><span class="s2">[!htb]&quot;</span>
            <span class="n">l2e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\centering&quot;</span>
            <span class="n">l3e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\caption{Geometric parameters of optimized cavity&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.}&quot;</span>
            <span class="n">l4e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\resizebox{\textwidth}{!}{\begin</span><span class="si">{tabular}{cccccccc}</span><span class="s2">&quot;</span>
            <span class="n">l5e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\toprule&quot;</span>
            <span class="n">l6e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\multicolumn</span><span class="si">{8}{c}</span><span class="s2">{&quot;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; (End-cell) -  Geometric Properties} </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l7e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l8e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l9e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$A_\mathrm</span><span class="si">{e}</span><span class="s2">$ [mm] &amp; $B_\mathrm</span><span class="si">{e}</span><span class="s2">$ [mm] &amp; $a_\mathrm</span><span class="si">{e}</span><span class="s2">$ [mm] &amp; $b_\mathrm</span><span class="si">{e}</span><span class="s2">$ [mm] &amp; &quot;</span> \
                  <span class="sa">r</span><span class="s2">&quot;$R_\mathrm{i, e}$ [mm] &amp; $L$ [mm] &amp; $R_{eq, e}$ [mm] &amp; $\alpha_\mathrm</span><span class="si">{e}</span><span class="s2"> [^\circ]$ </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l10e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l11e</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> \
                   <span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">fr</span><span class="s2">&quot;&amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_geom_params</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot; </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l12e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\bottomrule&quot;</span>
            <span class="n">l13e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{tabular}</span><span class="s2">}&quot;</span>
            <span class="n">l14e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\label{tab: geometric cavity end-cell}&quot;</span>
            <span class="n">l15e</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{table}</span><span class="s2">&quot;</span>

            <span class="n">l1_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{table}</span><span class="s2">[!htb]&quot;</span>
            <span class="n">l2_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\centering&quot;</span>
            <span class="n">l3_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\caption{QoIs of optimized cavity C$_</span><span class="si">{3795}</span><span class="s2">$.}&quot;</span>
            <span class="n">l4_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\resizebox{\textwidth}{!}{\begin</span><span class="si">{tabular}{cccccccc}</span><span class="s2">&quot;</span>
            <span class="n">l5_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\toprule&quot;</span>
            <span class="n">l6_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\multicolumn</span><span class="si">{8}{c}</span><span class="s2">{C$_</span><span class="si">{3795}</span><span class="s2">$ - QOIs} </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l7_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l8_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l9_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;No. of cells &amp; $R/Q$  &amp; $G$ &amp; $G.R/Q$ &amp; $E_{\mathrm</span><span class="si">{pk}</span><span class="s2">}/E_{\mathrm</span><span class="si">{acc}</span><span class="s2">}$  &amp; &quot;</span> \
                      <span class="sa">r</span><span class="s2">&quot;$B_{\mathrm</span><span class="si">{pk}</span><span class="s2">}/E_{\mathrm</span><span class="si">{acc}</span><span class="s2">}$  &amp; $|k_\mathrm{\parallel}| \mathrm{[SR]}$ &amp; &quot;</span> \
                      <span class="sa">r</span><span class="s2">&quot;$k_\mathrm{\perp} \mathrm{[SR]}$ </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l10_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&amp; [$\Omega$] &amp;[$\Omega$] &amp; $[10^5\Omega^2]$ &amp; [-] &amp; $[\mathrm{\frac</span><span class="si">{mT}</span><span class="s2">{MV/m}}]$ &amp; &quot;</span> \
                       <span class="sa">r</span><span class="s2">&quot;$[\mathrm{V/pC}]^$&amp; $[\mathrm{V/pC/m}]^$ </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l11_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\midrule&quot;</span>
            <span class="n">l12_qois</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R_Q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; &quot;</span> \
                       <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GR_Q</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; &quot;</span> \
                       <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_loss</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_kick</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="n">l13_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\bottomrule&quot;</span>
            <span class="n">l14_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{tabular}</span><span class="s2">}&quot;</span>
            <span class="n">l15_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\label{tab: qois designed cavity}&quot;</span>
            <span class="n">l16_qois</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{table}</span><span class="s2">&quot;</span>

            <span class="n">all_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">l1m</span><span class="p">,</span> <span class="n">l2m</span><span class="p">,</span> <span class="n">l3m</span><span class="p">,</span> <span class="n">l4m</span><span class="p">,</span> <span class="n">l5m</span><span class="p">,</span> <span class="n">l6m</span><span class="p">,</span> <span class="n">l7m</span><span class="p">,</span> <span class="n">l8m</span><span class="p">,</span> <span class="n">l9m</span><span class="p">,</span> <span class="n">l10m</span><span class="p">,</span>
                         <span class="n">l11m</span><span class="p">,</span> <span class="n">l12m</span><span class="p">,</span> <span class="n">l13m</span><span class="p">,</span> <span class="n">l14m</span><span class="p">,</span> <span class="n">l15m</span><span class="p">,</span> <span class="n">l_break</span><span class="p">,</span>
                         <span class="n">l1e</span><span class="p">,</span> <span class="n">l2e</span><span class="p">,</span> <span class="n">l3e</span><span class="p">,</span> <span class="n">l4e</span><span class="p">,</span> <span class="n">l5e</span><span class="p">,</span> <span class="n">l6e</span><span class="p">,</span> <span class="n">l7e</span><span class="p">,</span> <span class="n">l8e</span><span class="p">,</span> <span class="n">l9e</span><span class="p">,</span> <span class="n">l10e</span><span class="p">,</span>
                         <span class="n">l11e</span><span class="p">,</span> <span class="n">l12e</span><span class="p">,</span> <span class="n">l13e</span><span class="p">,</span> <span class="n">l14e</span><span class="p">,</span> <span class="n">l15e</span><span class="p">,</span> <span class="n">l_break</span><span class="p">,</span>
                         <span class="n">l1_qois</span><span class="p">,</span> <span class="n">l2_qois</span><span class="p">,</span> <span class="n">l3_qois</span><span class="p">,</span> <span class="n">l4_qois</span><span class="p">,</span> <span class="n">l5_qois</span><span class="p">,</span> <span class="n">l6_qois</span><span class="p">,</span> <span class="n">l7_qois</span><span class="p">,</span> <span class="n">l8_qois</span><span class="p">,</span> <span class="n">l9_qois</span><span class="p">,</span> <span class="n">l10_qois</span><span class="p">,</span>
                         <span class="n">l11_qois</span><span class="p">,</span> <span class="n">l12_qois</span><span class="p">,</span> <span class="n">l13_qois</span><span class="p">,</span> <span class="n">l14_qois</span><span class="p">,</span> <span class="n">l15_qois</span><span class="p">,</span> <span class="n">l16_qois</span>
                         <span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;D:\Dropbox\Quick presentation files\latex_mid_end_table.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ll</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Either SLANS or ABCI results not available. Please use &#39;&lt;cav&gt;.set_slans_qois(&lt;folder&gt;)&#39; &quot;</span>
                  <span class="s2">&quot;or &#39;&lt;cav&gt;.set_abci_qois(&lt;folder&gt;)&#39; to fix this.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="si">}</span><span class="s2"> [], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="si">}</span><span class="s2"> MHz, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="si">}</span><span class="s2"> [], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="si">}</span><span class="s2"> [mT/MV/m])&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="si">}</span><span class="s2"> [], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op_freq</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="si">}</span><span class="s2"> MHz, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="si">}</span><span class="s2"> [], </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="si">}</span><span class="s2"> [mT/MV/m])&quot;</span></div>


<div class="viewcode-block" id="Machine"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Machine">[docs]</a><span class="k">class</span> <span class="nc">Machine</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="c1"># machine properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bunch_length</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_points</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Machine.add_op_points"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Machine.add_op_points">[docs]</a>    <span class="k">def</span> <span class="nf">add_op_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_point</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op_point</span><span class="p">)</span></div>

<div class="viewcode-block" id="Machine.remove_op_points"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Machine.remove_op_points">[docs]</a>    <span class="k">def</span> <span class="nf">remove_op_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_point</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">op_point</span><span class="p">)</span></div>

<div class="viewcode-block" id="Machine.analyse_machine"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Machine.analyse_machine">[docs]</a>    <span class="k">def</span> <span class="nf">analyse_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Machine.compare_cavities_for_op_point"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.Machine.compare_cavities_for_op_point">[docs]</a>    <span class="k">def</span> <span class="nf">compare_cavities_for_op_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_point</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="OperatingPoint"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint">[docs]</a><span class="k">class</span> <span class="nc">OperatingPoint</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_file_path</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op_file_path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">op_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_from_operating_points</span><span class="p">(</span><span class="n">op_file_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">op_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_operating_point</span><span class="p">(</span><span class="n">op_file_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;E [GeV]&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;I0 [mA]&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrf</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;V [GV]&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_field</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;Eacc [MV/m]&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_temp</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;T [K]&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_sr</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;sigma_SR [mm]&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_bs</span> <span class="o">=</span> <span class="n">op_parameters</span><span class="p">[</span><span class="s2">&quot;sigma_BS [mm]&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cavities</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="OperatingPoint.analyse"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.analyse">[docs]</a>    <span class="k">def</span> <span class="nf">analyse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="OperatingPoint.load_from_operating_points"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.load_from_operating_points">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_from_operating_points</span><span class="p">(</span><span class="n">op_file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op_file_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">op_parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">op_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">op_parameters</span><span class="p">[</span><span class="n">op_file_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span></div>

<div class="viewcode-block" id="OperatingPoint.load_operating_point"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.load_operating_point">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_operating_point</span><span class="p">(</span><span class="n">op_file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">op_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">op_parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">op_parameters</span><span class="o">.</span><span class="n">key</span><span class="p">(),</span> <span class="n">op_parameters</span></div>

<div class="viewcode-block" id="OperatingPoint.set_sigma_sr"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.set_sigma_sr">[docs]</a>    <span class="k">def</span> <span class="nf">set_sigma_sr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_bs</span> <span class="o">=</span> <span class="n">sigma</span></div>

<div class="viewcode-block" id="OperatingPoint.get_sigma_sr"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.get_sigma_sr">[docs]</a>    <span class="k">def</span> <span class="nf">get_sigma_sr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_sr</span></div>

<div class="viewcode-block" id="OperatingPoint.set_sigma_bs"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.set_sigma_bs">[docs]</a>    <span class="k">def</span> <span class="nf">set_sigma_bs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_bs</span> <span class="o">=</span> <span class="n">sigma</span></div>

<div class="viewcode-block" id="OperatingPoint.get_sigma_bs"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.get_sigma_bs">[docs]</a>    <span class="k">def</span> <span class="nf">get_sigma_bs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_bs</span></div>

<div class="viewcode-block" id="OperatingPoint.set_I0"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.set_I0">[docs]</a>    <span class="k">def</span> <span class="nf">set_I0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I0</span> <span class="o">=</span> <span class="n">I0</span></div>

<div class="viewcode-block" id="OperatingPoint.get_I0"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.get_I0">[docs]</a>    <span class="k">def</span> <span class="nf">get_I0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">I0</span></div>

<div class="viewcode-block" id="OperatingPoint.set_energy"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.set_energy">[docs]</a>    <span class="k">def</span> <span class="nf">set_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">e</span></div>

<div class="viewcode-block" id="OperatingPoint.get_energy"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.get_energy">[docs]</a>    <span class="k">def</span> <span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span></div>

<div class="viewcode-block" id="OperatingPoint.add_cavities"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.add_cavities">[docs]</a>    <span class="k">def</span> <span class="nf">add_cavities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cavities</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cavities</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cavities</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cavities</span><span class="p">)</span></div>

<div class="viewcode-block" id="OperatingPoint.remove_cavities"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.remove_cavities">[docs]</a>    <span class="k">def</span> <span class="nf">remove_cavities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cavities</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cavities</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cav</span> <span class="ow">in</span> <span class="n">cavities</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cavities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cav</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cavities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cavities</span><span class="p">)</span></div>

<div class="viewcode-block" id="OperatingPoint.set_beam_properties"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.OperatingPoint.set_beam_properties">[docs]</a>    <span class="k">def</span> <span class="nf">set_beam_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<span class="n">op_folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\OperatingPoints\fcc.json&quot;</span>
<span class="n">Z_op_point</span> <span class="o">=</span> <span class="n">OperatingPoint</span><span class="p">([</span><span class="n">op_folder</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
<span class="n">W_op_point</span> <span class="o">=</span> <span class="n">OperatingPoint</span><span class="p">([</span><span class="n">op_folder</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">])</span>
<span class="n">H_op_point</span> <span class="o">=</span> <span class="n">OperatingPoint</span><span class="p">([</span><span class="n">op_folder</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">])</span>
<span class="n">ttbar_op_point</span> <span class="o">=</span> <span class="n">OperatingPoint</span><span class="p">([</span><span class="n">op_folder</span><span class="p">,</span> <span class="s2">&quot;ttbar&quot;</span><span class="p">])</span>

<span class="n">H_op_point</span><span class="o">.</span><span class="n">add_cavities</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>


<span class="c1">#</span>
<span class="c1"># def QL_Pin(labels, geometry, RF, QOI, Machine, p_data=None):</span>
<span class="c1">#     # check if entries are of same length</span>
<span class="c1">#</span>
<span class="c1">#     it = iter(geometry)</span>
<span class="c1">#     the_len = len(next(it))</span>
<span class="c1">#     if not all(len(l) == the_len for l in it):</span>
<span class="c1">#         raise ValueError(&#39;not all lists have same length!&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     it = iter(RF)</span>
<span class="c1">#     the_len = len(next(it))</span>
<span class="c1">#     if not all(len(l) == the_len for l in it):</span>
<span class="c1">#         raise ValueError(&#39;not all lists have same length!&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     it = iter(QOI)</span>
<span class="c1">#     the_len = len(next(it))</span>
<span class="c1">#     if not all(len(l) == the_len for l in it):</span>
<span class="c1">#         raise ValueError(&#39;not all lists have same length!&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     it = iter(Machine)</span>
<span class="c1">#     the_len = len(next(it))</span>
<span class="c1">#     if not all(len(l) == the_len for l in it):</span>
<span class="c1">#         raise ValueError(&#39;not all lists have same length!&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     n_cells, l_cells, G, b = [np.array(x) for x in geometry]</span>
<span class="c1">#     E_acc, Vrf = [np.array(x) for x in RF]</span>
<span class="c1">#</span>
<span class="c1">#     fig, ax = plt.subplots()</span>
<span class="c1">#</span>
<span class="c1">#     # QOI</span>
<span class="c1">#     f0, R_Q = [np.array(x) for x in QOI]</span>
<span class="c1">#</span>
<span class="c1">#     # Machine</span>
<span class="c1">#     I0, rho, E0 = [np.array(x) for x in Machine]</span>
<span class="c1">#</span>
<span class="c1">#     l_active = 2 * n_cells * l_cells</span>
<span class="c1">#     l_cavity = l_active + 8 * l_cells</span>
<span class="c1">#</span>
<span class="c1">#     # CALCULATED</span>
<span class="c1">#     v_cav = E_acc * l_active</span>
<span class="c1">#</span>
<span class="c1">#     U_loss = 88.46 * E0 ** 4 / rho * 1e-6  # GeV # energy lost per turn per beam</span>
<span class="c1">#     v_loss = 2 * U_loss * 1e9  # V # v loss for two beams</span>
<span class="c1">#</span>
<span class="c1">#     print(v_loss, Vrf, v_loss / Vrf)</span>
<span class="c1">#     phi = np.arccos(v_loss / Vrf)</span>
<span class="c1">#     delta_f = -R_Q * f0 * I0 * np.sin(phi) / (2 * v_cav)  # optimal df</span>
<span class="c1">#     QL_0_x = v_cav / (R_Q * I0 * np.cos(phi))  # optimal Q loaded</span>
<span class="c1">#</span>
<span class="c1">#     QL_0 = np.linspace(1e3, 1e8, 1000000)</span>
<span class="c1">#</span>
<span class="c1">#     xy_list = [(0.3, 0.6), (0.35, 0.25), (0.6, 0.6), (0.77, 0.25)]</span>
<span class="c1">#     for i in range(len(E_acc)):</span>
<span class="c1">#         f1_2 = f0[i] / (2 * QL_0)  # 380.6</span>
<span class="c1">#         ic(R_Q[i], v_cav[i], Vrf[i])</span>
<span class="c1">#         pin = v_cav[i] ** 2 / (4 * R_Q[i] * QL_0) * (</span>
<span class="c1">#                 (1 + ((R_Q[i] * QL_0 * I0[i]) / v_cav[i]) * np.cos(phi[i])) ** 2 + (</span>
<span class="c1">#                 (delta_f[i] / f1_2) + ((R_Q[i] * QL_0 * I0[i]) / v_cav[i]) * np.sin(phi[i])) ** 2)</span>
<span class="c1">#</span>
<span class="c1">#         p_cryo = 8 / (np.sqrt(f0[i] / 500e6))</span>
<span class="c1">#</span>
<span class="c1">#         # material/ wall power</span>
<span class="c1">#         e_acc = np.linspace(0.5, 25, 1000) * 1e6  # MV/m</span>
<span class="c1">#         Rs_NbCu_4_5k_400Mhz = 39.5 * np.exp(0.014 * (E_acc[i] * 1e-6 * b[i])) + 27</span>
<span class="c1">#         eta = 1 / 219  # c</span>
<span class="c1">#         Q0 = G[i] * 1e9 / Rs_NbCu_4_5k_400Mhz  # c</span>
<span class="c1">#         print(E_acc[i])</span>
<span class="c1">#         p_wp = (1 / eta) * Vrf[i] * (E_acc[i] * l_active[i] / (R_Q[i] * Q0)) + (1 / eta) * (</span>
<span class="c1">#                 l_cavity[i] * Vrf[i] / (l_active[i] * E_acc[i])) * p_cryo</span>
<span class="c1">#</span>
<span class="c1">#         if &quot;*&quot; in label[i]:</span>
<span class="c1">#             l = ax.plot(QL_0, pin * 1e-3, label=f&quot;${round(E_acc[i] * 1e-6, 2)}&quot; + &quot; ~[\mathrm{MV/m}]$&quot;, lw=4, ls=&#39;--&#39;)</span>
<span class="c1">#         else:</span>
<span class="c1">#             l = ax.plot(QL_0, pin * 1e-3, label=f&quot;${round(E_acc[i] * 1e-6, 2)}&quot; + &quot; ~[\mathrm{MV/m}]$&quot;, lw=4)</span>
<span class="c1">#</span>
<span class="c1">#         # add annotations</span>
<span class="c1">#         txt = f&quot;{labels[i]}, {n_cells[i]}-Cell 400 MHz \n {int(np.ceil(Vrf[i] / (2 * E_acc[i] * l_active[i]) / 2) * 2)} cav/beam&quot; \</span>
<span class="c1">#               + &quot;\n V$_\mathbf{RF}\mathbf{/beam}$ =&quot; + f&quot;{round(Vrf[i] / 2 * 1e-9, 2)} GV &quot; \</span>
<span class="c1">#               + &quot;\n V$_\mathbf{cav}$ =&quot; + f&quot;{round(v_cav[i] * 1e-6, 1)} MV \n &quot; \</span>
<span class="c1">#                                           &quot;P$_{\mathrm{in}}$ = &quot; + f&quot;{round(min(pin) * 1e-3, 1)} kW \n&quot; \</span>
<span class="c1">#                                                                    &quot;Q$_{\mathrm{L, 0}}^*$ = &quot; + &quot;{:.2e}&quot;.format(</span>
<span class="c1">#             QL_0_x[i])</span>
<span class="c1">#</span>
<span class="c1">#         annotext = ax.annotate(txt, xy=xy_list[i], xycoords=&#39;figure fraction&#39;, size=12, rotation=0, c=l[0].get_color(),</span>
<span class="c1">#                                weight=&#39;bold&#39;)</span>
<span class="c1">#</span>
<span class="c1">#         dt = DraggableText(annotext)</span>
<span class="c1">#         dt.connect()</span>
<span class="c1">#</span>
<span class="c1">#     if p_data:</span>
<span class="c1">#         # plot QL with penetration</span>
<span class="c1">#         ax_2 = ax.twinx()</span>
<span class="c1">#         data = fr.excel_reader(p_data)</span>
<span class="c1">#         data_ = data[list(data.keys())[0]]</span>
<span class="c1">#         ax_2.plot(data_[&quot;QL&quot;], data_[&quot;penetration&quot;], lw=4)</span>
<span class="c1">#</span>
<span class="c1">#     # plot decorations</span>
<span class="c1">#     ax.set_xlabel(&quot;$Q_{L,0}$&quot;)</span>
<span class="c1">#     ax.set_ylabel(&quot;$P_\mathrm{in} ~[\mathrm{kW}]$&quot;)</span>
<span class="c1">#     ax.set_xscale(&#39;log&#39;)</span>
<span class="c1">#     # ax.set_xlim(5e3, 5e7)</span>
<span class="c1">#     # ax.set_ylim(100, 2000)</span>
<span class="c1">#     ax.legend(loc=&#39;lower left&#39;, title=&quot;$E_\mathrm{acc}$&quot;)  #</span>
<span class="c1">#     ax.minorticks_on()</span>
<span class="c1">#     # ax.grid(which=&#39;both&#39;)</span>
<span class="c1">#     fig.show()</span>


<div class="viewcode-block" id="plot_beampipe_decay"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.plot_beampipe_decay">[docs]</a><span class="k">def</span> <span class="nf">plot_beampipe_decay</span><span class="p">(</span><span class="n">freq</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">fc_list</span><span class="p">):</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">187e-3</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">299792458</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">wl</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># m</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">fc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">fc_list</span><span class="p">):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">scimath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">fc</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">beta</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">beta</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="c1"># print(prop)</span>

        <span class="c1"># convert prop to dB</span>
        <span class="n">pdB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">pdB</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.12</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$z ~[\mathrm</span><span class="si">{m}</span><span class="s1">]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\alpha ~[\mathrm</span><span class="si">{dB}</span><span class="s1">]$&#39;</span><span class="p">)</span>

    <span class="c1"># xticks format</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">wl</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">wl</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">wl</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\lambda$&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">wl</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="c1"># ax.set_yticks(list(plt.yticks()[0]) + [-120])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_surface_resistance"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.plot_surface_resistance">[docs]</a><span class="k">def</span> <span class="nf">plot_surface_resistance</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">labellines</span> <span class="kn">import</span> <span class="n">labelLines</span>

    <span class="n">Eacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># MV/m</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">4.88</span>  <span class="c1"># mT/MV/m</span>

    <span class="n">Rs_NbCu_2k_400Mhz</span> <span class="o">=</span> <span class="mf">0.57</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mf">28.4</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_NbCu_4_5k_400Mhz</span> <span class="o">=</span> <span class="mf">39.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.014</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="mi">27</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_bulkNb_2k_400Mhz</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.33</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">26.24</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_bulkNb_4_5k_400Mhz</span> <span class="o">=</span> <span class="mf">0.0123</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">62.53</span>  <span class="c1"># nOhm</span>

    <span class="n">Rs_NbCu_2k_800Mhz</span> <span class="o">=</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">92</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_NbCu_4_5k_800Mhz</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.033</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="mi">154</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_bulkNb_2k_800Mhz</span> <span class="o">=</span> <span class="p">(</span><span class="mf">16.4</span> <span class="o">+</span> <span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="mf">0.092</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">800</span> <span class="o">/</span> <span class="mi">704</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># nOhm</span>
    <span class="n">Rs_bulkNb_4_5k_800Mhz</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mf">62.7</span> <span class="o">+</span> <span class="p">(</span><span class="n">Eacc</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.012</span><span class="p">)</span>  <span class="c1"># nOhm</span>

    <span class="n">sr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rs_NbCu_2k_400Mhz</span><span class="p">,</span> <span class="n">Rs_NbCu_4_5k_400Mhz</span><span class="p">,</span> <span class="n">Rs_bulkNb_2k_400Mhz</span><span class="p">,</span> <span class="n">Rs_bulkNb_4_5k_400Mhz</span><span class="p">,</span>
               <span class="n">Rs_NbCu_2k_800Mhz</span><span class="p">,</span> <span class="n">Rs_NbCu_4_5k_800Mhz</span><span class="p">,</span> <span class="n">Rs_bulkNb_2k_800Mhz</span><span class="p">,</span> <span class="n">Rs_bulkNb_4_5k_800Mhz</span><span class="p">]</span>

    <span class="n">sr_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rs_NbCu_2k_400Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_NbCu_4_5k_400Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_bulkNb_2k_400Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_bulkNb_4_5k_400Mhz&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Rs_NbCu_2k_800Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_NbCu_4_5k_800Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_bulkNb_2k_800Mhz&#39;</span><span class="p">,</span> <span class="s1">&#39;Rs_bulkNb_4_5k_800Mhz&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sr_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;400Mhz&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;800Mhz&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;2k&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;4_5k&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;NbCu&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;tab:orange&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;bulkNb&#39;</span> <span class="ow">in</span> <span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Eacc</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">Eacc</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Eacc</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sr_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">labelLines</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="c1"># plt.legend()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$E$ [MV/m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$R_s [\mathrm{n\Omega}]$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="mucol_study"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.mucol_study">[docs]</a><span class="k">def</span> <span class="nf">mucol_study</span><span class="p">():</span>
    <span class="c1"># MUCOL STUDY</span>

    <span class="c1">#RCS</span>
    <span class="n">V</span> <span class="o">=</span> <span class="mf">20.87</span><span class="o">*</span><span class="mf">1e9</span>

    <span class="n">ILC_LL</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1201.2516</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">284.4373</span><span class="p">,</span>
                    <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.31</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">3.62</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ILC-LL&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                    <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">ICHIRO</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1204.0024</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">283.9091</span><span class="p">,</span>
                    <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.32</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">3.61</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ICHIRO&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                    <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">NLSF</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1148.3234</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">276.6571</span><span class="p">,</span>
                  <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.09</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">3.84</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NLSF&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                  <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">NLSF_A</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1172.6666</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">277.9839</span><span class="p">,</span>
                    <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.07</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">3.77</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NLSF-A&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                    <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">NLSF_B</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1130.0682</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">279.9786</span><span class="p">,</span>
                    <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.07</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">3.83</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NLSF-B&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                    <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">TESLA</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">1022.8792</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">271.3334</span><span class="p">,</span>
                   <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">1.98</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.17</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TESLA&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                   <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">C3795</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">57.7e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">1300e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">521.06</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">272.93</span><span class="p">,</span>
                   <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.05</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.33</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3795&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">30e6</span><span class="p">,</span>
                   <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">parent_dir_slans</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\MuCol_Study\SimulationData\SLANS&quot;</span>
    <span class="n">parent_dir_abci</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\MuCol_Study\SimulationData\ABCI&quot;</span>

    <span class="n">slans_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\LL&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\ICHIRO&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\NLSF&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\NLSF-A&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\NLSF-B&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\TESLA&quot;</span><span class="p">,</span>
                  <span class="c1"># fr&quot;{parent_dir_slans}\C3795_1300MHz&quot;</span>
                  <span class="p">]</span>

    <span class="n">abci_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\LL&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\ICHIRO&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\NLSF&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\NLSF-A&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\NLSF-B&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\TESLA&quot;</span><span class="p">,</span>
                 <span class="c1"># fr&quot;{parent_dir_slans}\C3795_1300MHz&quot;</span>
                 <span class="p">]</span>

    <span class="n">cavities</span> <span class="o">=</span> <span class="n">Cavities</span><span class="p">([</span><span class="n">ILC_LL</span><span class="p">,</span> <span class="n">ICHIRO</span><span class="p">,</span> <span class="n">NLSF</span><span class="p">,</span> <span class="n">NLSF_A</span><span class="p">,</span> <span class="n">NLSF_B</span><span class="p">,</span> <span class="n">TESLA</span><span class="p">],</span> <span class="s1">&#39;TESLA_and_LL_Cavities&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_slans</span><span class="p">(</span><span class="n">slans_dirs</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_abci</span><span class="p">(</span><span class="n">abci_dirs</span><span class="p">)</span>

    <span class="n">E_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># V/m</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">compare_power</span><span class="p">(</span><span class="n">E_acc</span><span class="o">=</span><span class="n">E_acc</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_power_comparison</span><span class="p">(</span><span class="n">E_acc</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_fm_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_hom_bar</span><span class="p">()</span>

    <span class="c1"># print(cavities)</span>
    <span class="c1"># print(c3795_tt)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cavities_contour</span><span class="p">(</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_ql_vs_pin</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cryomodule_comparison</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_axis_fields</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_surface_fields</span><span class="p">()</span>

    <span class="c1"># makr summaries</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_latex_summary_tables</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_excel_summary</span><span class="p">()</span>

    <span class="c1"># multipacting</span>
    <span class="n">multipact_folders</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;D:\Dropbox\multipacting\MPGUI21\C3795&quot;</span><span class="p">]</span>  <span class="c1"># , r&quot;D:\Dropbox\multipacting\MPGUI21\FCCUROS5&quot;,</span>
    <span class="c1"># r&quot;D:\Dropbox\multipacting\MPGUI21\TESLA&quot;]</span>

    <span class="n">to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counter function&#39;</span><span class="p">,</span> <span class="s1">&#39;final impact energy&#39;</span><span class="p">,</span> <span class="s1">&#39;enhanced counter function&#39;</span><span class="p">]</span>
    <span class="c1"># for tp in to_plot:</span>
    <span class="c1"># cavities.plot_multipac_triplot(multipact_folders, &#39;enhanced counter function&#39;)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_dispersion</span><span class="p">()</span></div>
    <span class="c1"># plt.show()</span>


<div class="viewcode-block" id="ttbar_study"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.ttbar_study">[docs]</a><span class="k">def</span> <span class="nf">ttbar_study</span><span class="p">():</span>
    <span class="n">c3794_H</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">187e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">400.79e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">2.1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">152.8</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">198.42</span><span class="p">,</span>
                     <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.05</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">6.39</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">219</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3794&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">11.87e6</span><span class="p">,</span>
                     <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;4.5K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;NbCu&#39;</span><span class="p">)</span>

    <span class="n">c3795_H</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">2.1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">448.12</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">261.63</span><span class="p">,</span>
                     <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.43</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.88</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3795&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">24.72e6</span><span class="p">,</span>
                     <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">c3795_tt</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">8.8e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">448.12</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">261.63</span><span class="p">,</span>
                      <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.43</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.88</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3795&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">24.72e6</span><span class="p">,</span>
                      <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">cFCCUROS5</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">8.8e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">521.06</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">272.93</span><span class="p">,</span>
                       <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.05</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.33</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FCCUROS5&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">24.72e6</span><span class="p">,</span>
                       <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">cTESLA</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">8.8e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">558.684</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">271.72</span><span class="p">,</span>
                    <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.14</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.54</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TESLA&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">24.72e6</span><span class="p">,</span>
                    <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">parent_dir_slans</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\SLANS&quot;</span>
    <span class="n">parent_dir_abci</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\ABCI&quot;</span>

    <span class="c1"># # 2 and 5 cell cavities comparison for H</span>
    <span class="c1"># wp = &#39;H&#39;  # working point</span>
    <span class="c1"># sigma = &#39;SR_2.5mm&#39;</span>
    <span class="c1"># slans_dirs = [fr&quot;{parent_dir_slans}\Cavity3794&quot;, fr&quot;{parent_dir_slans}\CavityC3795&quot;]</span>
    <span class="c1"># abci_dirs = [fr&quot;{parent_dir_abci}\Cavity3794&quot;, fr&quot;{parent_dir_abci}\CavityC3795&quot;]</span>
    <span class="c1"># cavities = Cavities([c3794_H, c3795_H])</span>

    <span class="c1"># 5 cell cavities comparison for ttbar</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="s1">&#39;ttbar&#39;</span>  <span class="c1"># working point</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="s1">&#39;SR_1.67mm&#39;</span>
    <span class="n">slans_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\CavityC3795&quot;</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\CavityFCC_UROS5&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\CavityTESLA_800MHZ&quot;</span><span class="p">]</span>
    <span class="n">abci_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\CavityC3795&quot;</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\CavityFCC_UROS5&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\CavityTESLA_800MHZ&quot;</span><span class="p">]</span>
    <span class="n">cavities</span> <span class="o">=</span> <span class="n">Cavities</span><span class="p">([</span><span class="n">c3795_tt</span><span class="p">,</span> <span class="n">cFCCUROS5</span><span class="p">,</span> <span class="n">cTESLA</span><span class="p">],</span> <span class="s1">&#39;Cavities_C3795_FCCUROS5_TESLA&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_slans</span><span class="p">(</span><span class="n">slans_dirs</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_abci</span><span class="p">(</span><span class="n">abci_dirs</span><span class="p">)</span>

    <span class="n">E_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># V/m</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">compare_power</span><span class="p">(</span><span class="n">E_acc</span><span class="o">=</span><span class="n">E_acc</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_power_comparison</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_fm_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_hom_bar</span><span class="p">()</span>

    <span class="c1"># print(cavities)</span>
    <span class="c1"># print(c3795_tt)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_latex_summary_tables</span><span class="p">()</span>
    <span class="n">c3795_tt</span><span class="o">.</span><span class="n">make_latex_summary_tables</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cavities_contour</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_ql_vs_pin</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cryomodule_comparison</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_axis_fields</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_surface_fields</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_excel_summary</span><span class="p">()</span>

    <span class="c1"># multipacting</span>
    <span class="n">multipact_folders</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;D:\Dropbox\multipacting\MPGUI21\C3795&quot;</span><span class="p">]</span>  <span class="c1"># , r&quot;D:\Dropbox\multipacting\MPGUI21\FCCUROS5&quot;,</span>
    <span class="c1"># r&quot;D:\Dropbox\multipacting\MPGUI21\TESLA&quot;]</span>

    <span class="n">to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counter function&#39;</span><span class="p">,</span> <span class="s1">&#39;final impact energy&#39;</span><span class="p">,</span> <span class="s1">&#39;enhanced counter function&#39;</span><span class="p">]</span>
    <span class="c1"># for tp in to_plot:</span>
    <span class="c1"># cavities.plot_multipac_triplot(multipact_folders, &#39;enhanced counter function&#39;)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_dispersion</span><span class="p">()</span>
    <span class="c1"># plt.show()</span>
    <span class="n">c3795_tt</span><span class="o">.</span><span class="n">plot_ql_vs_pin</span><span class="p">()</span></div>


<div class="viewcode-block" id="h_study"><a class="viewcode-back" href="../../../analysis_modules.cavity_analysis.html#analysis_modules.cavity_analysis.cavity_analysis.h_study">[docs]</a><span class="k">def</span> <span class="nf">h_study</span><span class="p">():</span>
    <span class="n">c3794_H_400</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">187e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">400.79e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">2.1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">152.8</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">198.42</span><span class="p">,</span>
                         <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.05</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">6.39</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">219</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3794_400&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">11.87e6</span><span class="p">,</span>
                         <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;4.5K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;NbCu&#39;</span><span class="p">)</span>

    <span class="n">c3794_H_800</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">2.1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">152.8</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">198.42</span><span class="p">,</span>
                         <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.05</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">6.39</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">219</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3794_800&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">11.87e6</span><span class="p">,</span>
                         <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="c1"># c3795_H_400 = Cavity(5, l_cell_mid=93.5e-3, freq=801.58e6, vrf=2.1e9 / 2, R_Q=448.12, G=261.63,</span>
    <span class="c1">#                      Epk_Eacc=2.43, Bpk_Eacc=4.88, inv_eta=745, name=&quot;C3795&quot;, op_field=24.72e6,</span>
    <span class="c1">#                      op_temp=&#39;4.5K&#39;, material=&#39;NbCu&#39;)</span>

    <span class="n">c3795_H_800</span> <span class="o">=</span> <span class="n">Cavity</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">l_cell_mid</span><span class="o">=</span><span class="mf">93.5e-3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">801.58e6</span><span class="p">,</span> <span class="n">vrf</span><span class="o">=</span><span class="mf">2.1e9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">R_Q</span><span class="o">=</span><span class="mf">448.12</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mf">261.63</span><span class="p">,</span>
                         <span class="n">Epk_Eacc</span><span class="o">=</span><span class="mf">2.43</span><span class="p">,</span> <span class="n">Bpk_Eacc</span><span class="o">=</span><span class="mf">4.88</span><span class="p">,</span> <span class="n">inv_eta</span><span class="o">=</span><span class="mi">745</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C3795_800&quot;</span><span class="p">,</span> <span class="n">op_field</span><span class="o">=</span><span class="mf">24.72e6</span><span class="p">,</span>
                         <span class="n">op_temp</span><span class="o">=</span><span class="s1">&#39;2K&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="s1">&#39;bulkNb&#39;</span><span class="p">)</span>

    <span class="n">parent_dir_slans</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\SLANS&quot;</span>
    <span class="n">parent_dir_abci</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\ABCI&quot;</span>

    <span class="c1"># 2 and 5 cell, 400MHz, 800MHz cavities comparison for H</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="s1">&#39;H&#39;</span>  <span class="c1"># working point</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="s1">&#39;SR_2.5mm&#39;</span>
    <span class="n">slans_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\3794_400&quot;</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\3794_800&quot;</span><span class="p">,</span>
                  <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_slans</span><span class="si">}</span><span class="s2">\C3795_800&quot;</span><span class="p">]</span>
    <span class="n">abci_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\3794_400&quot;</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\3794_800&quot;</span><span class="p">,</span>
                 <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_dir_abci</span><span class="si">}</span><span class="s2">\C3795_800&quot;</span><span class="p">]</span>
    <span class="n">cavities</span> <span class="o">=</span> <span class="n">Cavities</span><span class="p">([</span><span class="n">c3794_H_400</span><span class="p">,</span> <span class="n">c3794_H_800</span><span class="p">,</span> <span class="n">c3795_H_800</span><span class="p">],</span> <span class="s1">&#39;Cavities_C3794_400_800_C3795_800&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_slans</span><span class="p">(</span><span class="n">slans_dirs</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">set_cavities_abci</span><span class="p">(</span><span class="n">abci_dirs</span><span class="p">)</span>

    <span class="n">E_acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># V/m</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">compare_power</span><span class="p">(</span><span class="n">E_acc</span><span class="o">=</span><span class="n">E_acc</span><span class="p">)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_power_comparison</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_fm_bar</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_compare_hom_bar</span><span class="p">()</span>

    <span class="c1"># print(cavities)</span>
    <span class="c1"># print(c3795_tt)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_latex_summary_tables</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cavities_contour</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>

    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_ql_vs_pin</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_cryomodule_comparison</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_axis_fields</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_surface_fields</span><span class="p">()</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">make_excel_summary</span><span class="p">()</span>

    <span class="c1"># multipacting</span>
    <span class="n">multipact_folders</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;D:\Dropbox\multipacting\MPGUI21\C3795&quot;</span><span class="p">]</span>  <span class="c1"># , r&quot;D:\Dropbox\multipacting\MPGUI21\FCCUROS5&quot;,</span>
    <span class="c1"># r&quot;D:\Dropbox\multipacting\MPGUI21\TESLA&quot;]</span>

    <span class="n">to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;counter function&#39;</span><span class="p">,</span> <span class="s1">&#39;final impact energy&#39;</span><span class="p">,</span> <span class="s1">&#39;enhanced counter function&#39;</span><span class="p">]</span>
    <span class="c1"># for tp in to_plot:</span>
    <span class="c1"># cavities.plot_multipac_triplot(multipact_folders, &#39;enhanced counter function&#39;)</span>
    <span class="n">cavities</span><span class="o">.</span><span class="n">plot_dispersion</span><span class="p">()</span></div>
    <span class="c1"># plt.show()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">wp</span> <span class="o">=</span> <span class="s1">&#39;MuCol&#39;</span>  <span class="c1"># working point</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="s1">&#39;SR_23.1mm&#39;</span>
    <span class="n">mucol_study</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Sosoho-abasi Udongwo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>frame_controls.tune_control &mdash; CavityHub 0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> CavityHub
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">CavityDesignHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CavityHub</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">frame_controls.tune_control</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for frame_controls.tune_control</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sps</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">qmc</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">oapackage</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QPropertyAnimation</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSignal</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QColor</span>
<span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
<span class="kn">from</span> <span class="nn">modules.data_module.abci_data</span> <span class="kn">import</span> <span class="n">ABCIData</span>
<span class="c1"># from modules.data_module.slans_data import SLANSDataExtraction</span>
<span class="kn">from</span> <span class="nn">simulation_codes.ABCI.abci_geometry</span> <span class="kn">import</span> <span class="n">ABCIGeometry</span>
<span class="kn">from</span> <span class="nn">ui_files.run_tune</span> <span class="kn">import</span> <span class="n">Ui_w_Tune</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="nn">r</span>
<span class="kn">from</span> <span class="nn">utils.file_reader</span> <span class="kn">import</span> <span class="n">FileReader</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">distutils</span> <span class="kn">import</span> <span class="n">dir_util</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">from</span> <span class="nn">modules.tune_module.tuners.tuner</span> <span class="kn">import</span> <span class="n">Tuner</span>
<span class="kn">from</span> <span class="nn">utils.shared_classes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utils.shared_functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">simulation_codes.SLANS.slans_geom_par</span> <span class="kn">import</span> <span class="n">SLANSGeometry</span>
<span class="n">slans_geom</span> <span class="o">=</span> <span class="n">SLANSGeometry</span><span class="p">()</span>  <span class="c1"># parallel implementaion of code, consider making the two separate classes 1</span>
<span class="kn">from</span> <span class="nn">simulation_codes.SLANS.slans_geometry</span> <span class="kn">import</span> <span class="n">SLANSGeometry</span>
<span class="n">slans_geom_seq</span> <span class="o">=</span> <span class="n">SLANSGeometry</span><span class="p">()</span>

<span class="n">file_color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="print_"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.print_">[docs]</a><span class="k">def</span> <span class="nf">print_</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file_color</span><span class="p">))</span></div>


<span class="n">fr</span> <span class="o">=</span> <span class="n">FileReader</span><span class="p">()</span>
<span class="n">abci_geom</span> <span class="o">=</span> <span class="n">ABCIGeometry</span><span class="p">()</span>
<span class="c1"># slans_data_extraction = SLANSDataExtraction()</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">Tuner</span><span class="p">()</span>

<span class="n">AN_DURATION</span> <span class="o">=</span> <span class="mi">200</span>


<div class="viewcode-block" id="TuneControl"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl">[docs]</a><span class="k">class</span> <span class="nc">TuneControl</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_Tune</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span> <span class="o">=</span> <span class="n">Ui_w_Tune</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_Tune</span><span class="p">)</span>

        <span class="c1"># Create main window object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_ui</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">ui</span>

        <span class="c1"># get logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">log</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pg_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pygraph_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_ended</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes_id</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress_bar</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ui effects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui_effects</span><span class="p">()</span>

        <span class="c1"># evolution algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_control</span> <span class="o">=</span> <span class="n">OptimizationControl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="p">)</span>

<div class="viewcode-block" id="TuneControl.initUI"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.initUI">[docs]</a>    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># expand/collapse sections widgets</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Expansion</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Expansion</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Expansion</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Outer_Cell</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Outer_Cell</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Outer_Cell</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Tune_Settings</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Tune_Settings</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># disable expansion section for now. Feature to come later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># tuner initial state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuner_routine</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SLANS&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Iteration_Settings</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># initial loaded shape spaces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_inner_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_outer_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># initial show/hide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_hide</span><span class="p">()</span>

        <span class="c1"># show/hide convergence plot</span>
        <span class="c1"># self.animate_width(self.tuneUI.cb_Monitor_Convergence, self.tuneUI.w_PyqtGraph, 0, 500, True)</span>

        <span class="c1"># create pause and resume icons to avoid creating them over and over again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause_icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause_icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/icons/icons/PNG/pause.png&quot;</span><span class="p">),</span> <span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resume_icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resume_icon</span><span class="o">.</span><span class="n">addPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/icons/icons/PNG/resume.png&quot;</span><span class="p">),</span> <span class="n">QIcon</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">QIcon</span><span class="o">.</span><span class="n">Off</span><span class="p">)</span>

        <span class="c1"># # initially set pause icon</span>
        <span class="c1"># self.tuneUI.pb_Pause_Resume.setIcon(self.pause_icon)</span>

        <span class="c1"># process state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pause_resume_stop_routine</span><span class="p">()</span>

        <span class="c1"># set default boundary condition to magnetic wall at both ends</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBC</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBC</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># create progress bar object and add to widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Simulation_Controls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">gl_Simulation_Controls</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="c1"># disable convergence monitor checkbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.signals"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.signals">[docs]</a>    <span class="k">def</span> <span class="nf">signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># signals/slots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Shape_Space_Generation_Algorithm</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_hide</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Run</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_shape_space</span><span class="p">())</span>

        <span class="c1"># tune variable</span>
        <span class="c1"># self.tuneUI.cb_Tune_Option.currentTextChanged.connect(lambda: self.change_tune_option(self.tuneUI.cb_Tune_Option.currentText()))</span>

        <span class="c1"># cell parameters control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Outer_Cell</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Expansion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuner_routine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuner_routine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuner_routine</span><span class="p">())</span>

        <span class="c1"># change cavity display image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_cavity_image</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_cavity_image</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBP</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_cavity_image</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_cavity_image</span><span class="p">())</span>

        <span class="c1"># collapse other settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Tune_Settings</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">animate_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Tune_Settings</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># disable secondary settings if Tuner is SLANS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Iteration_Settings</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SLANS&#39;</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Iteration_Settings</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># control to ensure that SLANS mid cell tuner is always set to tune for Req and end cell tuner is always set to L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slans_tuners_control</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slans_tuners_control</span><span class="p">())</span>

        <span class="c1"># expand/collapse convergence plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_width</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_PyqtGraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

        <span class="c1"># cancel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Cancel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">==</span> <span class="s1">&#39;running&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">())</span></div>

        <span class="c1"># change variable value</span>
        <span class="c1"># self.tuneUI.le_Tune_Variable.textChanged.connect(lambda: self.tuneUI.le_Tune_Variable_End_Cell.setText(self.tuneUI.le_Tune_Variable.text())</span>
        <span class="c1">#                                                  if self.tuneUI.cb_Tune_Option.currentIndex() == 1</span>
        <span class="c1">#                                                  else None)</span>

<div class="viewcode-block" id="TuneControl.tuner_routine"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.tuner_routine">[docs]</a>    <span class="k">def</span> <span class="nf">tuner_routine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># self.tuneUI.w_End_Cell_Tune_Extra_Variable.hide()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># if self.tuneUI.cb_Tune_Option.currentText() == &#39;L&#39;:</span>
            <span class="c1">#     self.tuneUI.w_End_Cell_Tune_Extra_Variable.show()</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.tuneUI.w_End_Cell_Tune_Extra_Variable.hide()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.generate_shape_space"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.generate_shape_space">[docs]</a>    <span class="k">def</span> <span class="nf">generate_shape_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check if filename is entered or not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Hey chief, seems you forgot to give a name to the shape_space file.&quot;</span><span class="p">)</span>
            <span class="c1"># print_(&quot;Hey chief, seems you forgot to give a name to the shape_space file.&quot;)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="c1"># check if shape space already generated</span>
            <span class="n">resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">continue_check</span><span class="p">()</span>

            <span class="c1"># check if pseudo_shape_space is to be updated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">resume</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span><span class="p">:</span>
                <span class="c1"># check if value set is already written. This is to enable continuation in case of break in program</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                        <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="c1"># self.log(f&#39;last saved key: {self.existing_keys}&#39;)</span>
            <span class="k">elif</span> <span class="n">resume</span> <span class="o">==</span> <span class="s2">&quot;Cancel&quot;</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Freq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="c1"># get variables from ui or from pseudo shape space</span>
        <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="n">inner_half_cell_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">]</span>
        <span class="c1"># print(inner_half_cell_parameters)</span>

        <span class="c1"># ihc = self.create_pseudo_shape_space(inner_half_cell_parameters, lock_list)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">A_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">B_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">a_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">b_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">Ri_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">L_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">Req_o</span> <span class="o">=</span> <span class="n">Req_i</span>

            <span class="n">outer_half_cell_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_o</span><span class="p">,</span> <span class="n">B_o</span><span class="p">,</span> <span class="n">a_o</span><span class="p">,</span> <span class="n">b_o</span><span class="p">,</span> <span class="n">Ri_o</span><span class="p">,</span> <span class="n">L_o</span><span class="p">,</span> <span class="n">Req_o</span><span class="p">]</span>
            <span class="c1"># ihc = self.create_pseudo_shape_space(outer_half_cell_parameters, lock_list)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outer_half_cell_parameters</span> <span class="o">=</span> <span class="n">inner_half_cell_parameters</span>

        <span class="c1"># print(outer_half_cell_parameters)</span>
        <span class="n">lock_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

        <span class="n">ihc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_pseudo_shape_space</span><span class="p">(</span><span class="n">inner_half_cell_parameters</span><span class="p">,</span> <span class="n">lock_list</span><span class="p">,</span> <span class="s2">&quot;Mid Cell&quot;</span><span class="p">)</span>
        <span class="n">ohc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_pseudo_shape_space</span><span class="p">(</span><span class="n">outer_half_cell_parameters</span><span class="p">,</span> <span class="n">lock_list</span><span class="p">,</span> <span class="s2">&quot;End Cell&quot;</span><span class="p">)</span>

        <span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_pseudo_shape_space</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">ihc</span><span class="p">,</span> <span class="n">ohc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pseudo_shape_space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_tune</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">resume</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.generate_shape_space_old"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.generate_shape_space_old">[docs]</a>    <span class="k">def</span> <span class="nf">generate_shape_space_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check if filename is entered or not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Hey chief, seems you forgot to give a name to the shape_space file.&quot;</span><span class="p">)</span>
            <span class="c1"># print_(&quot;Hey chief, seems you forgot to give a name to the shape_space file.&quot;)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="c1"># check if shape space already generated</span>
            <span class="n">resume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">continue_check</span><span class="p">()</span>

            <span class="c1"># check if pseudo_shape_space is to be updated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">resume</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span><span class="p">:</span>
                <span class="c1"># check if value set is already written. This is to enable continuation in case of break in program</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                        <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="c1"># self.log(f&#39;last saved key: {self.existing_keys}&#39;)</span>
            <span class="k">elif</span> <span class="n">resume</span> <span class="o">==</span> <span class="s2">&quot;Cancel&quot;</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Freq</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="c1"># get variables from ui or from pseudo shape space</span>
        <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="c1"># check tune type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
            <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">L_i</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">inner_half_cell_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">Req_i</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">inner_half_cell_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">A_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">B_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">a_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">b_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">Ri_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_o</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                <span class="c1"># update mid cell L_i</span>
                <span class="n">inner_half_cell_parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_Mid_Cell</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="n">L_o</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">L_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable_End_Cell</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="n">Req_o</span> <span class="o">=</span> <span class="n">Req_i</span>
            <span class="n">outer_half_cell_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_o</span><span class="p">,</span> <span class="n">B_o</span><span class="p">,</span> <span class="n">a_o</span><span class="p">,</span> <span class="n">b_o</span><span class="p">,</span> <span class="n">Ri_o</span><span class="p">,</span> <span class="n">L_o</span><span class="p">,</span> <span class="n">Req_o</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outer_half_cell_parameters</span> <span class="o">=</span> <span class="n">inner_half_cell_parameters</span>

        <span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_pseudo_shape_space</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">inner_half_cell_parameters</span><span class="p">,</span>
                                                              <span class="n">outer_half_cell_parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pseudo_shape_space</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_tune</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">resume</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.run_tune"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.run_tune">[docs]</a>    <span class="k">def</span> <span class="nf">run_tune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">resume</span><span class="p">):</span>
        <span class="c1"># set tuner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuner_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">proc_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Processors_Tune</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">tune_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># get iteration settings</span>
        <span class="n">iter_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Iterative_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tolerance</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Iteration</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iter_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">iter_method</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">]</span>

        <span class="c1"># cell type</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Tune_N_Cells</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">cell_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="c1"># boundary conditions</span>
        <span class="n">lbc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBC</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">rbc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBC</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">bc</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">lbc</span> <span class="o">+</span> <span class="n">rbc</span>

        <span class="c1"># save last</span>
        <span class="n">save_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Save_Last</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>

        <span class="c1"># try:</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># split shape_space for different processes/ MPI share process by rank</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># check if number of processors selected is greater than the number of keys in the pseudo shape space</span>
            <span class="k">if</span> <span class="n">proc_count</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                <span class="n">proc_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

            <span class="n">shape_space_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
            <span class="n">share</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">shape_space_len</span> <span class="o">/</span> <span class="n">proc_count</span><span class="p">)</span>

            <span class="c1"># for i in reversed(range(self.tuneUI.gl_PyqtGraph.count())):</span>
            <span class="c1">#     self.tuneUI.gl_PyqtGraph.itemAt(i).widget().setParent(None)</span>
            <span class="c1">#</span>
            <span class="c1"># # insert graphs for convergence monitor</span>
            <span class="c1"># self.pg_list = []</span>
            <span class="c1"># self.pygraph_list = []</span>
            <span class="c1"># graph_order = [(0, 0), (1, 0), (2, 0), (0, 1), (1, 1), (2, 1), (3, 0), (3, 1), (4, 0), (4, 1), (5, 0), (5, 1), (0, 2), (1, 2), (2, 2), (3, 2), (4, 2), (5, 2), (6, 0), (6, 1), (6, 2), (7, 0), (7, 1), (7, 2), (8, 0), (8, 1), (8, 2), (0, 3), (1, 3), (2, 3), (3, 3), (4, 3), (5, 3), (6, 3), (7, 3), (8, 3)]</span>
            <span class="c1"># # print(&quot;pglist before &quot;, self.pg_list)</span>
            <span class="c1"># # print(&quot;pygraph before &quot;, self.pygraph_list)</span>
            <span class="c1">#</span>
            <span class="c1"># for p in range(proc_count):</span>
            <span class="c1">#     self.createPyGraph(graph_order[p][0], graph_order[p][1])</span>

            <span class="c1"># print(&quot;pglist after &quot;, self.pg_list)</span>
            <span class="c1"># print(&quot;pygraph after &quot;, self.pygraph_list)</span>

            <span class="c1"># show progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># progress list</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_list</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># convergence list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
                <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proc_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span> <span class="o">+</span> <span class="n">share</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">overwriteFolder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">copyFiles</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>

                    <span class="n">processor_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proc_keys_list</span><span class="p">:</span>
                            <span class="n">processor_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                    <span class="n">service</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_sequential</span><span class="p">,</span>
                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">processor_shape_space</span><span class="p">,</span> <span class="n">resume</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuner_option</span><span class="p">,</span>
                                               <span class="n">tune_variable</span><span class="p">,</span> <span class="n">iter_set</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress_list</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">,</span> <span class="n">save_last</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">))</span>
                    <span class="n">service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processes_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                <span class="c1"># except Exception as e:</span>
                <span class="c1">#     self.log.info(&quot;Exception in run_MP::&quot;, e)</span>
                <span class="c1">#     # write to log</span>

            <span class="c1"># display progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_progress_bar</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_monitor_thread</span> <span class="o">=</span> <span class="n">ProgressMonitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_monitor_thread</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress_bar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_monitor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># # start convergence monitor</span>
            <span class="c1"># self.convergence_monitor_thread = MonitorConvergence(self)</span>
            <span class="c1"># self.convergence_monitor_thread.sig.connect(self.monitor_convergence)</span>
            <span class="c1"># self.convergence_monitor_thread.start()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tune started&quot;</span><span class="p">)</span>
            <span class="c1"># change process state to running</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_pause_resume_stop_routine</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">end_routine_thread</span> <span class="o">=</span> <span class="n">EndRoutine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_routine_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

        <span class="c1"># except Exception as e:</span>
        <span class="c1">#     self.log.error(fr&quot;TUNE CONTROL:: run_tune:: {e}&quot;)</span>
        <span class="c1">#     print_(&quot;TUNE CONTROL:: run_tune:: &quot;, e)</span>

<div class="viewcode-block" id="TuneControl.createPyGraph"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.createPyGraph">[docs]</a>    <span class="k">def</span> <span class="nf">createPyGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="c1"># add pyqgraph</span>
        <span class="n">pg_</span> <span class="o">=</span> <span class="n">pg</span>
        <span class="n">pygraph</span> <span class="o">=</span> <span class="n">pg_</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">()</span>
        <span class="n">pygraph</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">gl_PyqtGraph</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pygraph</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pg_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pygraph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pygraph</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.monitor_convergence"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.monitor_convergence">[docs]</a>    <span class="k">def</span> <span class="nf">monitor_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conv</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pygraph_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pygraph_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pygraph_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">convergence_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.update_progress_bar"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.update_progress_bar">[docs]</a>    <span class="k">def</span> <span class="nf">update_progress_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">100</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress_bar</span><span class="p">:</span>
            <span class="c1"># reset progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.run_pause_resume_stop_routine"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.run_pause_resume_stop_routine">[docs]</a>    <span class="k">def</span> <span class="nf">run_pause_resume_stop_routine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="c1"># change pause/resume icon to pause icon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pause_icon</span><span class="p">)</span>

            <span class="c1"># disable pause/resume and cancel buttons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Cancel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># enable run button in case it was disabled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Run</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
            <span class="c1"># enable run, pause/resume and cancel buttons</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Cancel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Run</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># change pause/resume icon to pause icon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pause_icon</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">==</span> <span class="s1">&#39;paused&#39;</span><span class="p">:</span>
            <span class="c1"># disable run button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Run</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># change pause/resume button icon to resume icon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Pause_Resume</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resume_icon</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.pause"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.log.info(&quot;Pausing...&quot;)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">suspend</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Paused&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">=</span> <span class="s1">&#39;paused&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pause_resume_stop_routine</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.resume"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.log.info(&quot;Resuming...&quot;)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resumed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pause_resume_stop_routine</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.cancel"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Terminating process...&quot;</span><span class="p">)</span>
        <span class="c1"># signal to progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress_bar</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># lear processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes_id</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># reset application state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_state</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_pause_resume_stop_routine</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Process terminated.&quot;</span><span class="p">)</span>

        <span class="c1"># set exit signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_ended</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tune ended&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.end_routine"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.end_routine">[docs]</a>    <span class="k">def</span> <span class="nf">end_routine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_ids</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="n">proc_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">proc_ids</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">proc_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">p</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
                    <span class="k">pass</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;process </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> ended&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># combine dictionaries</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">combined_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine_dict</span><span class="p">(</span><span class="n">proc_count</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_process_dict</span><span class="p">(</span><span class="n">proc_count</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Some error occurred -&gt; </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.progress_monitor"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.progress_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">progress_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_ids</span><span class="p">):</span>
        <span class="c1"># read progress files and update progress</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress_bar</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">proc_ids</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                            <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">\progress_file.txt&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                                <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">\progress_file.txt&#39;</span><span class="p">,</span>
                                <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                            <span class="n">progress</span> <span class="o">+=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">proc_ids</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error in progress update&quot;</span><span class="p">)</span>
                <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># reset progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TuneControl.change_cell_parameters"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.change_cell_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">change_cell_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">par</span> <span class="o">==</span> <span class="s1">&#39;inner&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># check tune variable</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Req&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable_End_Cell</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;OC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.generate_pseudo_shape_space"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.generate_pseudo_shape_space">[docs]</a>    <span class="k">def</span> <span class="nf">generate_pseudo_shape_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">ihc</span><span class="p">,</span> <span class="n">ohc</span><span class="p">):</span>

        <span class="n">BP</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">BP</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">BP</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IO&quot;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">indx1</span><span class="p">,</span> <span class="n">inner_cell</span> <span class="ow">in</span> <span class="n">ihc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">inner_cell</span> <span class="o">=</span> <span class="n">inner_cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">indx2</span><span class="p">,</span> <span class="n">other_cell</span> <span class="ow">in</span> <span class="n">ohc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="c1"># enforce Req_inner_cell == Req_outer_cell</span>
                    <span class="n">other_cell</span> <span class="o">=</span> <span class="n">other_cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">other_cell</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_cell</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">other_cell</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="n">BP</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                    <span class="n">key</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;II&quot;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">inner_cell</span> <span class="ow">in</span> <span class="n">ihc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="n">BP</span><span class="p">,</span>
                                                <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                <span class="n">key</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># remove duplicates from generated space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicate_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">)</span>

        <span class="n">pseudo_shape_space_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/Cavities/pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pseudo_shape_space_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span></div>

<div class="viewcode-block" id="TuneControl.create_pseudo_shape_space"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.create_pseudo_shape_space">[docs]</a>    <span class="k">def</span> <span class="nf">create_pseudo_shape_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_list</span><span class="p">,</span> <span class="n">lock_list</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span> <span class="o">=</span> <span class="n">var_list</span>
        <span class="n">A_LOCKED</span><span class="p">,</span> <span class="n">B_LOCKED</span><span class="p">,</span> <span class="n">a_LOCKED</span><span class="p">,</span> <span class="n">b_LOCKED</span><span class="p">,</span> <span class="n">Ri_LOCKED</span><span class="p">,</span> <span class="n">L_LOCKED</span><span class="p">,</span> <span class="n">Req_LOCKED</span> <span class="o">=</span> <span class="n">lock_list</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Req&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Req</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">AA</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">RiRi</span><span class="p">,</span> <span class="n">LL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

                <span class="n">space</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>  <span class="c1"># for some reason the first dimension of A is the dimension of B</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ri</span><span class="p">)):</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                                        <span class="c1"># enforce A + a &lt;= L</span>
                                        <span class="k">if</span> <span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">LL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]:</span>
                                            <span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">LL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span>
                                                     <span class="n">o</span><span class="p">],</span>
                                                 <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">AA</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">RiRi</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">ReqReq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">)</span>
                <span class="n">space</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>  <span class="c1"># for some reason the first dimension of A is the dimension of B</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ri</span><span class="p">)):</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Req</span><span class="p">)):</span>
                                            <span class="c1"># enforce A + a &lt; L</span>
                                            <span class="k">if</span> <span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;=</span> \
                                                    <span class="n">LL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                                                <span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">LL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">ReqReq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">AA</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">RiRi</span><span class="p">,</span> <span class="n">ReqReq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">Req</span><span class="p">)</span>

                <span class="n">space</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>  <span class="c1"># for some reason the first dimension of A is the dimension of B</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ri</span><span class="p">)):</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                                        <span class="c1"># enforce Ri + B + b &lt;= Req</span>
                                        <span class="k">if</span> <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">&lt;=</span> \
                                                <span class="n">ReqReq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]:</span>
                                            <span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                                <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">]</span> <span class="o">+</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span>
                                                 <span class="n">ReqReq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">AA</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">RiRi</span><span class="p">,</span> <span class="n">LL</span><span class="p">,</span> <span class="n">ReqReq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Req</span><span class="p">)</span>

                <span class="n">space</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>  <span class="c1"># for some reason the first dimension of A is the dimension of B</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ri</span><span class="p">)):</span>
                                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)):</span>
                                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Req</span><span class="p">)):</span>
                                            <span class="c1"># enforce Ri + B + b &lt;= Req</span>
                                            <span class="k">if</span> <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> \
                                                    <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ReqReq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">]:</span>
                                                <span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="n">BB</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">RiRi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">LL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span>
                                                              <span class="n">ReqReq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">][</span><span class="n">o</span><span class="p">][</span><span class="n">p</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You have to set the field value of the variable to be tuned to zero,&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
        <span class="c1"># print(space)</span>
        <span class="c1"># create list of locked variables</span>
        <span class="n">LOCKED_LIST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A_LOCKED</span><span class="p">,</span> <span class="n">B_LOCKED</span><span class="p">,</span> <span class="n">a_LOCKED</span><span class="p">,</span> <span class="n">b_LOCKED</span><span class="p">,</span> <span class="n">Ri_LOCKED</span><span class="p">,</span> <span class="n">L_LOCKED</span><span class="p">])</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">LOCKED_LIST</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># for ll in LOCKED_LIST:</span>
            <span class="c1"># check if length of all locked lists are same</span>
            <span class="n">dummy_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">LOCKED_LIST</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">dummy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">lock_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">dummy_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dummy_list</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dummy_list</span> <span class="o">==</span> <span class="n">dummy_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Perfect&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please make sure locked variables are of equal lengths.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">A_LOCKED</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">B_LOCKED</span><span class="p">:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a_LOCKED</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b_LOCKED</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Ri_LOCKED</span><span class="p">:</span>
                <span class="n">Ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">L_LOCKED</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Req_LOCKED</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lock_len</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">lock</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ri</span><span class="p">,</span> <span class="n">L</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>

            <span class="nb">slice</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">space</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">lock</span><span class="p">:</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                        <span class="nb">slice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;Ri&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;Req&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">])</span>
            <span class="c1"># print(df)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;Ri&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;Req&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">])</span>
        <span class="c1"># print(df)</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="TuneControl.text_to_list"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.text_to_list">[docs]</a>    <span class="k">def</span> <span class="nf">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># s = &quot;range(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;randrange(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;[16, 23, 10]&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s2">&quot;rand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;randrange&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;randrange&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TuneControl.generate_pseudo_shape_space_old"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.generate_pseudo_shape_space_old">[docs]</a>    <span class="k">def</span> <span class="nf">generate_pseudo_shape_space_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">ihc</span><span class="p">,</span> <span class="n">ohc</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Shape_Space_Generation_Algorithm</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Monte Carlo&#39;</span><span class="p">:</span>
            <span class="n">n_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Shapes_Monte_Carlo</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="c1"># pseudo_shape_space = {}</span>

            <span class="c1"># check input to avoid an infinite loop</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">loop_escape</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">n_shapes</span> <span class="ow">and</span> <span class="n">loop_escape</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
                    <span class="c1"># mid cell</span>
                    <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
                        <span class="n">B_i</span> <span class="o">=</span> <span class="n">A_i</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                        <span class="n">b_i</span> <span class="o">=</span> <span class="n">a_i</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">L_i</span> <span class="o">=</span> <span class="n">A_i</span> <span class="o">+</span> <span class="n">a_i</span>

                        <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ihc</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                        <span class="n">Req_i</span> <span class="o">=</span> <span class="n">B_i</span> <span class="o">+</span> <span class="n">b_i</span> <span class="o">+</span> <span class="n">Ri_i</span>

                    <span class="n">inner_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># This also checks if the right and left bounds are equal in which case it returns a single value</span>
                        <span class="n">A_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
                            <span class="n">B_o</span> <span class="o">=</span> <span class="n">A_o</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">B_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">a_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                            <span class="n">b_o</span> <span class="o">=</span> <span class="n">a_o</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">b_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                        <span class="n">Ri_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
                            <span class="n">L_o</span> <span class="o">=</span> <span class="n">A_o</span> <span class="o">+</span> <span class="n">a_o</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">L_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_range</span><span class="p">(</span><span class="n">ohc</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                        <span class="n">Req_o</span> <span class="o">=</span> <span class="n">Req_i</span>

                        <span class="c1"># update L_i</span>
                        <span class="c1"># L_i = self.process_range(self.text_to_list(self.tuneUI.le_Tune_Variable_End_Cell.text()))</span>
                        <span class="c1"># inner_cell[5] = L_i</span>

                        <span class="n">other_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_o</span><span class="p">,</span> <span class="n">B_o</span><span class="p">,</span> <span class="n">a_o</span><span class="p">,</span> <span class="n">b_o</span><span class="p">,</span> <span class="n">Ri_o</span><span class="p">,</span> <span class="n">L_o</span><span class="p">,</span> <span class="n">Req_o</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">other_cell</span> <span class="o">=</span> <span class="n">inner_cell</span>

                    <span class="k">if</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">loop_escape</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">print_</span><span class="p">(</span><span class="s2">&quot;Encountered a shape with A + a &gt; L&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other_cell</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="ow">or</span> <span class="n">inner_cell</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">inner_cell</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">inner_cell</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
                        <span class="n">loop_escape</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">print_</span><span class="p">(</span><span class="s2">&quot;Encountered a shape with B + b &gt; Req&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="c1"># print_(&#39;6e&#39;)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">other_cell</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">other_cell</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">loop_escape</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reset loop escape</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please check input parameters.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">########## UPDATE CODE TO CHECK FOR ALL THE ITEMS IN THE SHAPE SPACE FOR SHAPES WITH A + a &gt; L</span>
            <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">()</span>

            <span class="n">A_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">B_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">a_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">b_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">Ri_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">A_o</span> <span class="ow">in</span> <span class="n">A_o_space</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">B_o</span> <span class="ow">in</span> <span class="n">B_o_space</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">a_o</span> <span class="ow">in</span> <span class="n">a_o_space</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">b_o</span> <span class="ow">in</span> <span class="n">b_o_space</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">Ri_o</span> <span class="ow">in</span> <span class="n">Ri_o_space</span><span class="p">:</span>

                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Req&#39;</span><span class="p">:</span>
                                    <span class="n">L_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">L_o</span> <span class="ow">in</span> <span class="n">L_o_space</span><span class="p">:</span>
                                        <span class="n">Req_o</span> <span class="o">=</span> <span class="n">B_o</span> <span class="o">+</span> <span class="n">b_o</span> <span class="o">+</span> <span class="n">Ri_o</span>
                                        <span class="n">outer_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_o</span><span class="p">,</span> <span class="n">B_o</span><span class="p">,</span> <span class="n">a_o</span><span class="p">,</span> <span class="n">b_o</span><span class="p">,</span> <span class="n">Ri_o</span><span class="p">,</span> <span class="n">L_o</span><span class="p">,</span> <span class="n">Req_o</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                            <span class="c1"># This also checks if the right and left bounds are equal in which case it returns a single value</span>
                                            <span class="n">A_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                            <span class="n">B_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                            <span class="n">a_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                            <span class="n">b_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                            <span class="n">Ri_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                            <span class="n">L_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                            <span class="n">Req_i</span> <span class="o">=</span> <span class="n">Req_o</span>

                                            <span class="k">for</span> <span class="n">A_i</span> <span class="ow">in</span> <span class="n">A_i_space</span><span class="p">:</span>
                                                <span class="k">for</span> <span class="n">B_i</span> <span class="ow">in</span> <span class="n">B_i_space</span><span class="p">:</span>
                                                    <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_i_space</span><span class="p">:</span>
                                                        <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b_i_space</span><span class="p">:</span>
                                                            <span class="k">for</span> <span class="n">Ri_i</span> <span class="ow">in</span> <span class="n">Ri_i_space</span><span class="p">:</span>
                                                                <span class="k">for</span> <span class="n">L_i</span> <span class="ow">in</span> <span class="n">L_i_space</span><span class="p">:</span>
                                                                    <span class="n">inner_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span>
                                                                                  <span class="mi">0</span><span class="p">]</span>
                                                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                                                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                                                <span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                                                    <span class="k">else</span><span class="p">:</span>
                                                                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                                                <span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                                                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">inner_cell</span> <span class="o">=</span> <span class="n">outer_cell</span>

                                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">Req_o_space</span> <span class="o">=</span> <span class="n">ohc</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">Req_o</span> <span class="ow">in</span> <span class="n">Req_o_space</span><span class="p">:</span>
                                        <span class="n">L_o</span> <span class="o">=</span> <span class="n">A_o</span> <span class="o">+</span> <span class="n">a_o</span>
                                        <span class="n">outer_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_o</span><span class="p">,</span> <span class="n">B_o</span><span class="p">,</span> <span class="n">a_o</span><span class="p">,</span> <span class="n">b_o</span><span class="p">,</span> <span class="n">Ri_o</span><span class="p">,</span> <span class="n">L_o</span><span class="p">,</span> <span class="n">Req_o</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                            <span class="n">A_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                            <span class="n">B_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                            <span class="n">a_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                            <span class="n">b_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                            <span class="n">Ri_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                            <span class="n">L_i_space</span> <span class="o">=</span> <span class="n">ihc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                            <span class="n">Req_i</span> <span class="o">=</span> <span class="n">Req_o</span>

                                            <span class="k">for</span> <span class="n">A_i</span> <span class="ow">in</span> <span class="n">A_i_space</span><span class="p">:</span>
                                                <span class="k">for</span> <span class="n">B_i</span> <span class="ow">in</span> <span class="n">B_i_space</span><span class="p">:</span>
                                                    <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_i_space</span><span class="p">:</span>
                                                        <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b_i_space</span><span class="p">:</span>
                                                            <span class="k">for</span> <span class="n">Ri_i</span> <span class="ow">in</span> <span class="n">Ri_i_space</span><span class="p">:</span>
                                                                <span class="k">for</span> <span class="n">L_i</span> <span class="ow">in</span> <span class="n">L_i_space</span><span class="p">:</span>
                                                                    <span class="n">inner_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span>
                                                                                  <span class="mi">0</span><span class="p">]</span>

                                                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                                                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                                                <span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                                                    <span class="k">else</span><span class="p">:</span>
                                                                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                                                                <span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                                                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">inner_cell</span> <span class="o">=</span> <span class="n">outer_cell</span>

                                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Marker</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
                                                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_keys</span><span class="p">:</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">inner_cell</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">outer_cell</span><span class="p">,</span>
                                                                                    <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
                                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># remove duplicates from generated space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicate_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">pseudo_shape_space_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/Cavities/pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pseudo_shape_space_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_shape_space</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">check</span></div>

<div class="viewcode-block" id="TuneControl.remove_duplicate_values"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.remove_duplicate_values">[docs]</a>    <span class="k">def</span> <span class="nf">remove_duplicate_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="TuneControl.show_hide"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.show_hide">[docs]</a>    <span class="k">def</span> <span class="nf">show_hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Shape_Space_Generation_Algorithm</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Monte Carlo&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_No_Of_Shapes_Monte_Carlo</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_No_Of_Shapes_Monte_Carlo</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;PyTune&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_BC</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_BC</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.animate_width"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.animate_width">[docs]</a>    <span class="k">def</span> <span class="nf">animate_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">min_width</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="c1"># GET WIDTH</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
            <span class="c1"># SET MAX WIDTH</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">widthCollapsed</span> <span class="o">=</span> <span class="n">min_width</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">widthCollapsed</span> <span class="o">=</span> <span class="n">standard</span>
                <span class="c1"># widget.setMinimumWidth(standard)</span>

            <span class="c1"># ANIMATION</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;maximumWidth&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="n">AN_DURATION</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="n">widthCollapsed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.animate_height"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.animate_height">[docs]</a>    <span class="k">def</span> <span class="nf">animate_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">min_height</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="c1"># GET WIDTH</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
            <span class="c1"># SET MAX WIDTH</span>
            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">heightCollapsed</span> <span class="o">=</span> <span class="n">min_height</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heightCollapsed</span> <span class="o">=</span> <span class="n">standard</span>
                <span class="c1"># widget.setMinimumWidth(standard)</span>

            <span class="c1"># ANIMATION</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;maximumHeight&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="n">AN_DURATION</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="n">heightCollapsed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.change_cavity_image"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.change_cavity_image">[docs]</a>    <span class="k">def</span> <span class="nf">change_cavity_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/mid_cell.png&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/end_cell.png&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/mid_cell.png&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/end_cell.png&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/one_cell.png&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Cavity_Image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QPixmap</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;:/imgs/images/end_same_cell.png&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TuneControl.check_input"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.check_input">[docs]</a>    <span class="k">def</span> <span class="nf">check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># s = &quot;range(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;randrange(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;[16, 23, 10]&quot;</span>
        <span class="c1"># s = 1, 2, 3</span>
        <span class="c1"># s = 2</span>

        <span class="k">if</span> <span class="s2">&quot;r&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s2">&quot;rr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;rr&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;rr&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">ll</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="TuneControl.check_input_old"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.check_input_old">[docs]</a>    <span class="k">def</span> <span class="nf">check_input_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">tune_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tune_Variable</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Req&quot;</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">tune_var</span>
            <span class="k">if</span> <span class="n">A_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Req</span> <span class="o">=</span> <span class="n">tune_var</span>
            <span class="k">if</span> <span class="n">b_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ri_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">Req</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Req</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Req</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ri_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Req</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Req</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="TuneControl.slans_tuners_control"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.slans_tuners_control">[docs]</a>    <span class="k">def</span> <span class="nf">slans_tuners_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;SLANS&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># self.tuneUI.l_Tune_Alternate_Variable.setText(&#39;L&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># self.tuneUI.l_Tune_Alternate_Variable.setText(&#39;Req&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># disable monitor convergence</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># hide boundary condition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_BC</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># enable monitor convergence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Monitor_Convergence</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># show boundary conditions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_BC</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.serialize"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">):</span>
        <span class="c1"># update state file</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Freq</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Cell_Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Option&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Shape_Space_Generation_Algorithm</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;No_Of_Shapes_Monte_Carlo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Shapes_Monte_Carlo</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tuner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBC</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;RBC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBC</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Inner_Cell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Outer_Cell&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Expansion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>

        <span class="c1"># cell parameters</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Req_i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_o&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_o</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c1"># settings</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;No_Of_Processors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Processors_Tune</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Iterative_Method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Iterative_Method</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tolerance</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Max_Iteration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Iteration</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="c1">## Optimization control</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Optimization_Algorithm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Optimization_Algorithm</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Cell_Type_Optimization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;UQ_Check&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>

        <span class="c1"># mid cell parameters</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Req_i_opt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Variable</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">dsb_Tune_Frequency</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Norm_Length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">db_Norm_Length</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Cells&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Norm_Length_N_Cells</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Processors_Count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Processors_Count</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Initial_Points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Initial_Points</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Max_Table_Size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Table_Size</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Generation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Generation</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Init_Generation_Method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Sobol_Sequence_Index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Sobol_Sequence_Index</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Optimize_By&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Optimize_By</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Crossover_Factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Crossover_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Elites_To_Cross&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Elites_To_Cross</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Mutation_Factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Mutation_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Chaos_Factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Chaos_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Populate_Objectives&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Populate_Constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Expansion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span>
        <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.deserialize"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.deserialize">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;here at deserializin&quot;</span><span class="p">)</span>
        <span class="c1"># update state file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Freq</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Cell_Type&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Option</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Option&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Shape_Space_Generation_Algorithm</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Shapes_Monte_Carlo</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;No_Of_Shapes_Monte_Carlo&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tuner</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tuner&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBC</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBC&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_RBC</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;RBC&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Inner_Cell</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Inner_Cell&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Outer_Cell</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Outer_Cell&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Expansion&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBP&quot;</span><span class="p">])</span>

        <span class="c1"># cell parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_i&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Req_i&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_o&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_o&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_o&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_o&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_o&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_o</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_i&quot;</span><span class="p">])</span>

        <span class="c1"># settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_No_Of_Processors_Tune</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;No_Of_Processors&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Iterative_Method</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Iterative_Method&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Tolerance</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tolerance&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Iteration</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Max_Iteration&quot;</span><span class="p">])</span>

        <span class="c1">## Optimization control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Optimization_Algorithm</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Optimization_Algorithm&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Cell_Type_Optimization&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;UQ_Check&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;here at deserializin optimization&quot;</span><span class="p">)</span>

        <span class="c1"># mid cell parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;A_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;B_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;a_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;b_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Ri_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;L_i_opt&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i_opt</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Req_i_opt&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Variable</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Variable&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">dsb_Tune_Frequency</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Tune_Frequency&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">db_Norm_Length</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Norm_Length&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Norm_Length_N_Cells</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Cells&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Processors_Count</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Processors_Count&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Initial_Points</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Initial_Points&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Table_Size</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Max_Table_Size&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Generation</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Generation&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Init_Generation_Method&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Sobol_Sequence_Index</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Sobol_Sequence_Index&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Optimize_By</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Optimize_By&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Crossover_Factor</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Crossover_Factor&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Elites_To_Cross</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;N_Elites_To_Cross&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Mutation_Factor</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Mutation_Factor&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Chaos_Factor</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Chaos_Factor&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Populate_Objectives&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="o">.</span><span class="n">setCurrentText</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Populate_Constraints&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Expansion</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;Expansion&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_LBP</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LBP&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TuneControl.ui_effects"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.ui_effects">[docs]</a>    <span class="k">def</span> <span class="nf">ui_effects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">shadow</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">(</span><span class="n">blurRadius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">shadow</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Tune_Input</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span>

        <span class="n">shadow</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">(</span><span class="n">blurRadius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">shadow</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Simulation_Controls</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span>

        <span class="n">shadow</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">(</span><span class="n">blurRadius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">shadow</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Inner_Cell</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span>

        <span class="n">shadow</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">(</span><span class="n">blurRadius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">shadow</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Outer_Cell</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span>

        <span class="n">shadow</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">(</span><span class="n">blurRadius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">xOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">yOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">shadow</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Cell_Component_Control</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.run_sequential"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.run_sequential">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">run_sequential</span><span class="p">(</span><span class="n">pseudo_shape_space_proc</span><span class="p">,</span> <span class="n">resume</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tuner_option</span><span class="p">,</span>
                       <span class="n">tune_variable</span><span class="p">,</span> <span class="n">iter_set</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">progress_list</span><span class="p">,</span> <span class="n">convergence_list</span><span class="p">,</span> <span class="n">save_last</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">):</span>

        <span class="n">tuner</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">pseudo_shape_space_proc</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="n">resume</span><span class="p">,</span> <span class="n">proc</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                   <span class="n">tuner_option</span><span class="o">=</span><span class="n">tuner_option</span><span class="p">,</span> <span class="n">tune_variable</span><span class="o">=</span><span class="n">tune_variable</span><span class="p">,</span> <span class="n">iter_set</span><span class="o">=</span><span class="n">iter_set</span><span class="p">,</span>
                   <span class="n">cell_type</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">progress_list</span><span class="o">=</span><span class="n">progress_list</span><span class="p">,</span> <span class="n">convergence_list</span><span class="o">=</span><span class="n">convergence_list</span><span class="p">,</span>
                   <span class="n">save_last</span><span class="o">=</span><span class="n">save_last</span><span class="p">,</span> <span class="n">n_cell_last_run</span><span class="o">=</span><span class="n">n_cells</span><span class="p">)</span>  <span class="c1"># last_key=last_key This would have to be tested again #val2</span></div>

<div class="viewcode-block" id="TuneControl.overwriteFolder"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.overwriteFolder">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">overwriteFolder</span><span class="p">(</span><span class="n">invar</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">invar</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">dir_util</span><span class="o">.</span><span class="n">_path_created</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.copyFiles"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.copyFiles">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copyFiles</span><span class="p">(</span><span class="n">invar</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parentDir</span><span class="si">}</span><span class="s2">\exe\SLANS_exe&quot;</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">invar</span><span class="si">}</span><span class="s2">\SLANS_exe&quot;</span>

        <span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.cb_show_hide"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.cb_show_hide">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cb_show_hide</span><span class="p">(</span><span class="n">wid1</span><span class="p">,</span> <span class="n">wid2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wid1</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">wid2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wid2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.cb_toggle"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.cb_toggle">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cb_toggle</span><span class="p">(</span><span class="n">wid1</span><span class="p">,</span> <span class="n">wid2</span><span class="p">,</span> <span class="n">wid3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wid1</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">wid2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">wid3</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wid2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">wid3</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.text_to_list_old"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.text_to_list_old">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">text_to_list_old</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s1">&#39;linspace&#39;</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;np.</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">l</span>
        <span class="k">elif</span> <span class="n">txt</span> <span class="ow">in</span> <span class="s2">&quot;ABabRiLReq&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">txt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.continue_check"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.continue_check">[docs]</a>    <span class="k">def</span> <span class="nf">continue_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">main_control</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">/Cavities/pseudo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Generated_Shape_Space_Name</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Resume Simulation&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The pseudo shape space file already exist. Would you love to update or overwrite its content?&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>

            <span class="n">buttonY</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
            <span class="n">buttonY</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">)</span>
            <span class="n">buttonN</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
            <span class="n">buttonN</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Overwrite&#39;</span><span class="p">)</span>

            <span class="n">msg</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">buttonY</span><span class="p">)</span>

            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_clicked</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">16384</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done checking path. Yes selected.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;Yes&quot;</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">65536</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done checking path. No selected.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;No&quot;</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">4194304</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done checking path. Cancel selected.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;Cancel&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Path does not yet exist. Creating...&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;Yes&quot;</span></div>

<div class="viewcode-block" id="TuneControl.button_clicked"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.button_clicked">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">button_clicked</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">text</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.load_shape_space"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.load_shape_space">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_shape_space</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fr</span> <span class="o">=</span> <span class="n">FileReader</span><span class="p">()</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="c1"># check if extension is included</span>
        <span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">.json&#39;</span>

        <span class="n">print_</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">json_reader</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arg</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.open_file"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.open_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">le</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Open File&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Json Files (*.json)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="c1"># populate checkboxes with key</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to open file:: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.input_control"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.input_control">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">input_control</span><span class="p">(</span><span class="n">wid_l_bound</span><span class="p">,</span> <span class="n">wid_r_bound</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wid_r_bound</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">wid_l_bound</span><span class="o">.</span><span class="n">value</span><span class="p">():</span>
            <span class="n">wid_r_bound</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">wid_l_bound</span><span class="o">.</span><span class="n">value</span><span class="p">())</span></div>

<div class="viewcode-block" id="TuneControl.proof_filename"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.proof_filename">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">proof_filename</span><span class="p">(</span><span class="n">dirc</span><span class="p">):</span>
        <span class="c1"># check if extension is included</span>
        <span class="k">if</span> <span class="n">dirc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="n">dirc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dirc</span><span class="si">}</span><span class="s1">.json&#39;</span>

        <span class="k">return</span> <span class="n">dirc</span></div>

<div class="viewcode-block" id="TuneControl.change_tune_option"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.change_tune_option">[docs]</a>    <span class="k">def</span> <span class="nf">change_tune_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">txt</span> <span class="o">==</span> <span class="s1">&#39;Req&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Tune_Alternate_Variable</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Tune_Alternate_Variable_End_Cell</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
            <span class="c1"># self.tuneUI.le_Tune_Variable_End_Cell.setEnabled(True)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Tune_Alternate_Variable</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Req&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">l_Tune_Alternate_Variable_End_Cell</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Req&quot;</span><span class="p">)</span></div>

            <span class="c1"># set end cell Req equal to mid cell Req</span>
            <span class="c1"># self.tuneUI.le_Tune_Variable_End_Cell.setText(self.tuneUI.le_Tune_Variable.text())</span>
            <span class="c1"># self.tuneUI.le_Tune_Variable_End_Cell.setEnabled(False)</span>

<div class="viewcode-block" id="TuneControl.process_range"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.process_range">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">process_range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Seems something is wrong with the input.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TuneControl.change_app_status"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.change_app_status">[docs]</a>    <span class="k">def</span> <span class="nf">change_app_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Application status</span>
        <span class="n">movie</span> <span class="o">=</span> <span class="n">QMovie</span><span class="p">(</span><span class="s1">&#39;:/general/icons/GIF/spinner-icon.gif&#39;</span><span class="p">)</span>
        <span class="n">movie</span><span class="o">.</span><span class="n">setScaledSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">l_Status</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">l_Status</span><span class="o">.</span><span class="n">setMovie</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">l_Status_Text</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Busy&quot;</span><span class="p">)</span>
        <span class="n">movie</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="n">t_status</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app_status</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">movie</span><span class="p">,))</span>
        <span class="n">t_status</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="TuneControl.app_status"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.app_status">[docs]</a>    <span class="k">def</span> <span class="nf">app_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movie</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second thread started&quot;</span><span class="p">)</span>
        <span class="c1"># keep on while t is alive</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_list</span><span class="p">:</span>
            <span class="c1"># while t.isAlive():</span>
            <span class="k">while</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="k">pass</span>

            <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="n">movie</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">l_Status_Text</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Ready&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_list</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="c1"># @staticmethod</span>
<div class="viewcode-block" id="TuneControl.combine_dict"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.combine_dict">[docs]</a>    <span class="k">def</span> <span class="nf">combine_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc_count</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="c1"># Combining dictionaries</span>
        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;Combining dictionaries&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\shape_space</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>

        <span class="c1"># check if extension is included</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.json&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>

        <span class="n">print_</span><span class="p">(</span><span class="s1">&#39;Done combining dictionaries&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="TuneControl.delete_process_dict"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.TuneControl.delete_process_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">delete_process_dict</span><span class="p">(</span><span class="n">proc_count</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\Cavities\shape_space</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="OptimizationControl"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl">[docs]</a><span class="k">class</span> <span class="nc">OptimizationControl</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuneUI</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_freq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span> <span class="o">=</span> <span class="n">tuneUI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">objs_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ng_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Generation</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># shape bounds dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poc</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># pareto optimal count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parentDir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initUI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">()</span>

<div class="viewcode-block" id="OptimizationControl.initUI"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.initUI">[docs]</a>    <span class="k">def</span> <span class="nf">initUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populate_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Mid_Cell_Opt</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Mid_Cell_Opt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Sobol_Sequence_Parameters</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Sobol Sequence&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Sobol_Sequence_Parameters</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="OptimizationControl.signals"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.signals">[docs]</a>    <span class="k">def</span> <span class="nf">signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># add signal to show mid cell parameters for end-mid-cell optimization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_hide_mid_cell_params</span><span class="p">())</span>

        <span class="c1"># populate objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_objectives</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs_dict</span><span class="p">))</span>

        <span class="c1"># add signal to update parameter influence combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_influence_ccb</span><span class="p">())</span>

        <span class="c1"># populate constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_constraints</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Constraints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints_dict</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">pb_Run_Optimization</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentTextChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Sobol_Sequence_Parameters</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Sobol Sequence&#39;</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Sobol_Sequence_Parameters</span><span class="o">.</span><span class="n">hide</span><span class="p">())</span>

        <span class="c1"># sobol sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Sobol_Sequence_Index</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Initial_Points</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Sobol_Sequence_Index</span><span class="o">.</span><span class="n">value</span><span class="p">())))</span></div>

<div class="viewcode-block" id="OptimizationControl.ea"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.ea">[docs]</a>    <span class="k">def</span> <span class="nf">ea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># update lists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ng_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Generation</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_constraints</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_objectives</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_first_men</span><span class="p">()</span>

            <span class="c1"># clear folder to avoid reading from previous optimization attempt</span>
            <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\SLANS&quot;</span><span class="p">,</span>
                       <span class="sa">fr</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\ABCI&quot;</span><span class="p">]</span>

            <span class="c1"># folders = [fr&quot;D:\Dropbox\CavityDesignHub\Cavity800\SimulationData\SLANS&quot;]</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">NotADirectoryError</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">\</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># optimize by page rank</span>
        <span class="c1"># remove the lowest ranking members</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>

        <span class="c1"># compare with global dict and remove duplicates</span>
        <span class="n">compared_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">compared_cols</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">compared_cols</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>  <span class="c1"># this line of code removes duplicates</span>

        <span class="c1"># if self.tuneUI.cb_Optimize_By.currentText() == &quot;Page Rankf&quot;:</span>
        <span class="c1">#     if len(self.df) &gt; 15:</span>
        <span class="c1">#         df = self.df.iloc[:, 0:15]</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         df = self.df.iloc[:, :]</span>

        <span class="c1"># naming convention G&lt;generation number&gt;_C&lt;cavity number&gt;_&lt;type&gt;</span>
        <span class="c1"># type refers to mutation M or crossover C</span>

        <span class="c1"># first_shapes dictionary</span>
        <span class="c1"># convert dataframe to tune dictionary style</span>
        <span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tune_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">dsb_Tune_Frequency</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># key, A, B, a, b, Ri, L, Req, alpha =</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span>

                <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">alpha_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Alpha_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">IC</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span> <span class="n">alpha_i</span><span class="p">,</span> <span class="n">alpha_i</span><span class="p">]</span>
                <span class="c1"># print(type(IC))</span>
                <span class="c1"># print(type(IC))</span>
                <span class="c1"># print(type(rr[1:]))</span>

                <span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">IC</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_freq</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pseudo_shape_space</span><span class="p">[</span><span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_freq</span><span class="p">}</span>

        <span class="n">pseudo_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicate_values</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="p">)</span>

        <span class="c1"># pseudo_shape_space_name = f&#39;{self.projectDir}/Cavities/pseudo_{self.proof_filename(&quot;EA.json&quot;)}&#39;</span>
        <span class="c1">#</span>
        <span class="c1"># with open(pseudo_shape_space_name, &#39;w&#39;) as file:</span>
        <span class="c1">#     file.write(json.dumps(pseudo_shape_space, indent=4, separators=(&#39;,&#39;, &#39;: &#39;)))</span>

        <span class="c1">############################</span>
        <span class="c1"># run tune</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Norm_Length_N_Cells</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">norm_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">db_Norm_Length</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_tune_parallel</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">,</span> <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">,</span> <span class="s2">&quot;R/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;Q0&quot;</span><span class="p">]:</span>
                <span class="c1"># process tune results</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">obj_result</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">tune_result</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">processed_keys</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\cavity_33.svl&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">svl_reader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_objectives_value</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span> <span class="n">norm_length</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>
                        <span class="c1"># print(obj, tr)</span>
                        <span class="c1"># read tune results</span>
                        <span class="n">d_tune_res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\tune_res.json&#39;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                            <span class="n">d_tune_res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

                        <span class="n">obj_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                        <span class="n">tune_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d_tune_res</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                        <span class="n">processed_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="c1"># after removing duplicates, dataframe might change size</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">processed_keys</span><span class="p">)]</span>

                <span class="c1"># replace Req with tuned Req</span>
                <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_i&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_o&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tune_result</span>

                <span class="c1"># append objective column to dataframe only from slans results</span>
                <span class="n">obj_slans</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="k">if</span> <span class="s1">&#39;Z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">ic</span><span class="p">(</span><span class="n">obj_result</span><span class="p">)</span>
                <span class="n">ic</span><span class="p">(</span><span class="n">obj_slans</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="n">obj_slans</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_result</span>
            <span class="c1"># print(&quot;In here to evaluate wakfield&quot;)</span>
            <span class="k">elif</span> <span class="s2">&quot;ZL&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;ZT&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;k_loss&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;k_kick&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In here to evaluate wakfield0&quot;</span><span class="p">)</span>
                <span class="c1"># run wakefield analysis and return shape space</span>
                <span class="n">wake_shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_wakefield_parallel</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="c1"># print(&quot;In here to evaluate wakfield1&quot;)</span>
                <span class="c1"># process wakefield results</span>
                <span class="n">df_wake</span><span class="p">,</span> <span class="n">processed_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wakefield_objectives_value</span><span class="p">(</span><span class="n">wake_shape_space</span><span class="p">,</span>
                                                                                 <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\ABCI&#39;</span><span class="p">)</span>
                <span class="n">ic</span><span class="p">(</span><span class="n">df_wake</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_wake</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
                <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="c1"># print(&quot;In here to evaluate wakfield2&quot;)</span>
                <span class="c1"># remove unprocessed keys from dataframe</span>
                <span class="c1"># df = df.loc[df[&#39;key&#39;].isin(processed_keys)]</span>
                <span class="c1">#</span>
                <span class="c1"># # append wakefield objective column to dataframe</span>
                <span class="c1"># df.loc[:, np.array(obj_abci)[:, 1]] = obj_result</span>

                <span class="c1"># print(&quot;In here to evaluate wakfield3&quot;)</span>
                <span class="k">break</span>

        <span class="c1"># apply UQ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">solver_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;slans&#39;</span><span class="p">:</span> <span class="n">slans_geom_seq</span><span class="p">,</span> <span class="s1">&#39;abci&#39;</span><span class="p">:</span> <span class="n">abci_geom</span><span class="p">}</span>
            <span class="n">beampipes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mid Cell&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;End-End Cell&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;Single Cell&#39;</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span><span class="p">}</span>
            <span class="n">beampipe</span> <span class="o">=</span> <span class="n">beampipes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()]</span>

            <span class="c1"># if self.tuneUI.cb_Cell_Type_Optimization.currentText() == &#39;End-Mid Cell&#39;:</span>
            <span class="c1">#     n_cells = 5</span>
            <span class="c1"># else:</span>
            <span class="c1">#     n_cells = 5</span>

            <span class="n">solver_args_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;slans&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_cells&#39;</span><span class="p">:</span> <span class="n">n_cells</span><span class="p">,</span> <span class="s1">&#39;n_modules&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;f_shift&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bc&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
                                          <span class="s1">&#39;beampipes&#39;</span><span class="p">:</span> <span class="n">beampipe</span><span class="p">,</span>
                                          <span class="s1">&#39;norm_length&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">db_Norm_Length</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>
                                          <span class="s1">&#39;parentDir&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span> <span class="s1">&#39;projectDir&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="p">},</span>
                                <span class="s1">&#39;abci&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_cells&#39;</span><span class="p">:</span> <span class="n">n_cells</span><span class="p">,</span> <span class="s1">&#39;n_modules&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                         <span class="s1">&#39;MROT&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;MT&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;NFS&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;UBT&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;bunch_length&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                                         <span class="s1">&#39;DDR_SIG&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;DDZ_SIG&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                                         <span class="s1">&#39;parentDir&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span> <span class="s1">&#39;projectDir&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="p">,</span> <span class="s1">&#39;progress_list&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="s1">&#39;WG_M&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
                                <span class="p">}</span>

            <span class="n">shape_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uq_parallel</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span> <span class="n">solver_dict</span><span class="p">,</span> <span class="n">solver_args_dict</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">shape_space</span><span class="p">)</span>

            <span class="c1"># get uq_parameters</span>
            <span class="n">uq_result_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">filename_slans</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\uq.json&#39;</span>
                <span class="n">filename_abci</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\ABCI\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\uq.json&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename_slans</span><span class="p">):</span><span class="c1"># and os.path.exists(filename_abci):</span>
                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_slans</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                        <span class="n">uq_d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Req&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;R/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;GR/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">,</span> <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">]:</span>
                                <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="c1"># for equal, calculate |expected_value - design_value| + 6sigma</span>
                                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                                <span class="c1"># ic(uq_result_dict)</span>

                <span class="c1"># filename = fr&#39;{self.projectDir}\SimulationData\ABCI\{key}\uq.json&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename_abci</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uq_result_dict</span><span class="p">:</span>
                        <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_abci</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                        <span class="n">uq_d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Req&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;R/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">,</span> <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">]:</span>
                                <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                                    <span class="n">uq_result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">uq_d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># ic(uq_result_dict)</span>
            <span class="n">uq_column_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
                <span class="n">uq_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="n">uq_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                    <span class="n">uq_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                    <span class="n">uq_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">uq_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

            <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df_uq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">uq_result_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">df_uq</span><span class="p">)</span>
            <span class="n">df_uq</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">uq_column_names</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">uq_column_names</span><span class="p">)</span>
            <span class="n">df_uq</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;key&#39;</span>
            <span class="n">df_uq</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">df_uq</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_uq</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="c1">######################################################</span>
        <span class="c1"># filter by constraints</span>
        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
            <span class="k">elif</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>

        <span class="c1"># update with global dataframe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># # drop duplicates</span>
            <span class="c1"># df = df.drop_duplicates(subset=[&#39;A&#39;, &#39;B&#39;, &#39;a&#39;, &#39;b&#39;, &#39;Ri&#39;, &#39;L&#39;], keep=&#39;first&#39;)</span>

        <span class="c1"># reset total rank</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># rank shapes by objectives</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;rank_|E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;rank_|E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">])</span>
    
                <span class="c1"># if &#39;total_rank&#39; in df.columns:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;rank_|E[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
                <span class="c1"># else:</span>
                <span class="c1">#     if obj[0] == &#39;min&#39;:</span>
                <span class="c1">#         df[f&#39;total_rank&#39;] = df[f&#39;rank_E[{obj[1]}] + 6*std[{obj[1]}]&#39;]</span>
                <span class="c1">#     elif obj[0] == &#39;max&#39;:</span>
                <span class="c1">#         df[f&#39;total_rank&#39;] = df[f&#39;rank_E[{obj[1]}] - 6*std[{obj[1]}]&#39;]</span>
                <span class="c1">#     else:</span>
                <span class="c1">#         df[f&#39;total_rank&#39;] = df[f&#39;rank_std[{obj[1]}]&#39;]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>  <span class="c1"># define properly later</span>
                    <span class="k">continue</span>
    
                <span class="c1"># if &#39;total_rank&#39; in df.columns:</span>
                <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rank_</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
                <span class="c1"># else:</span>
                <span class="c1">#     df[f&#39;total_rank&#39;] = df[f&#39;rank_{obj[1]}&#39;]</span>

        <span class="c1"># reorder</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">tot</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># normalize by sum of weights</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># order shapes by rank</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_rank&#39;</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># pareto condition</span>
        <span class="n">reorder_indx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pareto_front</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reorder_indx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># reset index</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># update global</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Max_Table_Size</span><span class="o">.</span><span class="n">value</span><span class="p">():</span>
            <span class="c1"># self.df_global = df.loc[0:self.tuneUI.cb_Max_Table_Size.value(), :]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="p">)</span>
        
        <span class="c1"># check if df_global is empty</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Unfortunately, none survived the constraints and the program has to end. I can&#39;t even say that this was a good run.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># save dataframe</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Generation</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_global</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">reorder_indx</span><span class="p">)</span>
        <span class="c1"># ic(self.df_global)</span>

        <span class="c1"># birth next generation</span>
        <span class="c1"># crossover</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Crossover&quot;</span><span class="p">)</span>
        <span class="n">df_cross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Crossover_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>  <span class="c1"># , elites[&quot;GR/Q</span>
        <span class="c1"># ic(df_cross)</span>

        <span class="c1"># mutation</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mutation&quot;</span><span class="p">)</span>
        <span class="n">df_mutation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Mutation_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df_mutation</span><span class="p">)</span>

        <span class="c1"># chaos</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chaos&quot;</span><span class="p">)</span>
        <span class="n">df_chaos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chaos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Chaos_Factor</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">n</span><span class="p">)</span>
        <span class="c1"># ic(df_chaos)</span>

        <span class="c1"># take elites from previous generation over to next generation</span>
        <span class="n">df_ng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_cross</span><span class="p">,</span> <span class="n">df_mutation</span><span class="p">,</span> <span class="n">df_chaos</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># update dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df_ng</span>

        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ng_max</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="OptimizationControl.uq_parallel"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.uq_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">uq_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">solver_dict</span><span class="p">,</span> <span class="n">solver_args_dict</span><span class="p">):</span>
        <span class="n">proc_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Processors_Count</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="c1"># marker = self.wakefieldUI.le_Marker.text()</span>

        <span class="c1"># get geometric parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">]]</span>
        <span class="n">shape_space</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">rw</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span>

                <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">alpha_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Alpha_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">IC</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span> <span class="n">alpha_i</span><span class="p">]</span>

                <span class="n">shape_space</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">IC</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC_R&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_space</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC_R&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">}</span>

        <span class="c1"># split shape_space for different processes/ MPI share process by rank</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">shape_space_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">share</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">shape_space_len</span> <span class="o">/</span> <span class="n">proc_count</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proc_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span> <span class="o">+</span> <span class="n">share</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:]</span>

                <span class="n">processor_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proc_keys_list</span><span class="p">:</span>
                        <span class="n">processor_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                <span class="n">solver_args_dict</span><span class="p">[</span><span class="s1">&#39;slans&#39;</span><span class="p">][</span><span class="s1">&#39;proc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                <span class="n">solver_args_dict</span><span class="p">[</span><span class="s1">&#39;abci&#39;</span><span class="p">][</span><span class="s1">&#39;proc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                <span class="n">service</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uq</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">processor_shape_space</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">solver_dict</span><span class="p">,</span> <span class="n">solver_args_dict</span><span class="p">))</span>
                <span class="n">service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in uq_parallel analysis:: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">shape_space</span></div>

<div class="viewcode-block" id="OptimizationControl.uq"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.uq">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">uq</span><span class="p">(</span><span class="n">shape_space</span><span class="p">,</span> <span class="n">objectives</span><span class="p">,</span> <span class="n">solver_dict</span><span class="p">,</span> <span class="n">solver_args_dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">err</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">result_dict_slans</span><span class="p">,</span> <span class="n">result_dict_abci</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
            <span class="n">run_slans</span><span class="p">,</span> <span class="n">run_abci</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">slans_obj_list</span><span class="p">,</span> <span class="n">abci_obj_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objectives</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Req&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;R/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;GR/Q&quot;</span><span class="p">,</span> <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">,</span> <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">]:</span>
                    <span class="n">result_dict_slans</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;expe&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;stdDev&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="n">run_slans</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">slans_obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ZL&#39;</span><span class="p">,</span> <span class="s1">&#39;ZT&#39;</span><span class="p">,</span> <span class="s1">&#39;k_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;k_kick&#39;</span><span class="p">]:</span>
                    <span class="c1"># ic(o)</span>
                    <span class="n">result_dict_abci</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;expe&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;stdDev&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="n">run_abci</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">abci_obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

            <span class="c1"># EXAMPLE: p_true = np.array([1, 2, 3, 4, 5]).T</span>
            <span class="n">p_true</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
            <span class="c1"># ic(p_true)</span>
            <span class="n">rdim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_true</span><span class="p">)</span>  <span class="c1"># How many variabels will be considered as random in our case 5</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1">#  for 1D opti you can use stroud5 (please test your code for stroud3 less quadrature nodes 2rdim)</span>
            <span class="n">flag_stroud</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">flag_stroud</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bpoly</span> <span class="o">=</span> <span class="n">quad_stroud3</span><span class="p">(</span><span class="n">rdim</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">elif</span> <span class="n">flag_stroud</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bpoly</span> <span class="o">=</span> <span class="n">quad_stroud3</span><span class="p">(</span><span class="n">rdim</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>  <span class="c1"># change to stroud 5 later</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;flag_stroud==1 or flag_stroud==2&#39;</span><span class="p">)</span>

            <span class="c1">#  mean value of geometrical parameters</span>
            <span class="n">p_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p_true</span><span class="p">))</span>

            <span class="n">no_parm</span><span class="p">,</span> <span class="n">no_sims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
            <span class="c1"># ic(no_sims)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># or 0.1</span>

            <span class="k">if</span> <span class="n">run_slans</span><span class="p">:</span>
                <span class="n">Ttab_val_f</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">solver</span><span class="p">,</span> <span class="n">solver_args</span> <span class="o">=</span> <span class="n">solver_dict</span><span class="p">[</span><span class="s1">&#39;slans&#39;</span><span class="p">],</span> <span class="n">solver_args_dict</span><span class="p">[</span><span class="s1">&#39;slans&#39;</span><span class="p">]</span>
                <span class="n">bc</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;bc&#39;</span><span class="p">]</span>
                <span class="n">beampipes</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;beampipes&#39;</span><span class="p">]</span>
                <span class="n">norm_length</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;norm_length&#39;</span><span class="p">]</span>
                <span class="n">n_cells</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;n_cells&#39;</span><span class="p">]</span>
                <span class="n">proc</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;proc&#39;</span><span class="p">]</span>
                <span class="n">parentDir</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;parentDir&#39;</span><span class="p">]</span>
                <span class="n">projectDir</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;projectDir&#39;</span><span class="p">]</span>
                <span class="n">sub_dir</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># the simulation runs at the quadrature points are saved to the key of the mean value run</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_sims</span><span class="p">):</span>
                    <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>

                    <span class="n">par_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_init</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">:])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">par_end</span> <span class="o">=</span> <span class="n">par_mid</span>

                    <span class="c1"># perform checks on geometry</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="n">perform_geometry_checks</span><span class="p">(</span><span class="n">par_mid</span><span class="p">,</span> <span class="n">par_end</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                        <span class="n">err</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

                    <span class="n">fid</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_Q</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>

                    <span class="c1"># check if folder exists and skip if it does</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\Cavity</span><span class="si">{</span><span class="n">fid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                        <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="c1"># ic(&quot;Skipped: &quot;, fid, fr&#39;{projectDir}\SimulationData\ABCI\{key}\{fid}&#39;)</span>

                    <span class="c1"># skip analysis if folder already exists.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                        <span class="c1">#  run model using SLANS or CST</span>
                        <span class="c1"># # create folders for all keys</span>
                        <span class="n">solver</span><span class="o">.</span><span class="n">createFolder</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="n">sub_dir</span><span class="p">)</span>

                        <span class="n">solver</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par_mid</span><span class="p">,</span> <span class="n">par_end</span><span class="p">,</span> <span class="n">par_mid</span><span class="p">,</span> <span class="n">f_shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="n">bc</span><span class="p">,</span> <span class="n">beampipes</span><span class="o">=</span><span class="n">beampipes</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="n">fid</span><span class="p">,</span>
                                      <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="n">sub_dir</span><span class="p">)</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\Cavity</span><span class="si">{</span><span class="n">fid</span><span class="si">}</span><span class="s1">\cavity_33.svl&#39;</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">svl_reader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                        <span class="n">obj_result</span><span class="p">,</span> <span class="n">tune_result</span> <span class="o">=</span> <span class="n">get_objectives_value</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">slans_obj_list</span><span class="p">,</span> <span class="n">norm_length</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">)</span>

                        <span class="c1"># sometimes some degenerate shapes are still generated and the solver returns zero</span>
                        <span class="c1"># for the objective functions, such shapes are considered invalid</span>
                        <span class="k">for</span> <span class="n">objr</span> <span class="ow">in</span> <span class="n">obj_result</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">objr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># skip key</span>
                                <span class="n">err</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>

                        <span class="c1"># ic(&#39;SLANS&#39;, obj_result)</span>
                        <span class="n">tab_val_f</span> <span class="o">=</span> <span class="n">obj_result</span>

                        <span class="n">Ttab_val_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_val_f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">err</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># # add original point</span>
                <span class="c1"># filename = fr&#39;{projectDir}\SimulationData\SLANS\{key}\cavity_33.svl&#39;</span>
                <span class="c1"># params = fr.svl_reader(filename)</span>
                <span class="c1"># obj_result, tune_result = get_objectives_value(params, slans_obj_list)</span>
                <span class="c1"># tab_val_f = obj_result</span>
                    <span class="c1"># Ttab_val_f.append(tab_val_f)</span>

                <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">v_expe_fobj</span><span class="p">,</span> <span class="n">v_stdDev_fobj</span> <span class="o">=</span> <span class="n">weighted_mean_obj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">Ttab_val_f</span><span class="p">),</span> <span class="n">weights</span><span class="p">)</span>
                <span class="c1"># ic(v_expe_fobj, v_stdDev_fobj)</span>
                <span class="c1"># append results to dict</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slans_obj_list</span><span class="p">):</span>
                    <span class="n">result_dict_slans</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_expe_fobj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">result_dict_slans</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_stdDev_fobj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">\uq.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_dict_slans</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">run_abci</span><span class="p">:</span>
                <span class="c1"># ic(&quot;here in ANCI UQ&quot;)</span>
                <span class="n">Ttab_val_f</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">solver</span><span class="p">,</span> <span class="n">solver_args</span> <span class="o">=</span> <span class="n">solver_dict</span><span class="p">[</span><span class="s1">&#39;abci&#39;</span><span class="p">],</span> <span class="n">solver_args_dict</span><span class="p">[</span><span class="s1">&#39;abci&#39;</span><span class="p">]</span>
                <span class="n">n_cells</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;n_cells&#39;</span><span class="p">]</span>
                <span class="n">n_modules</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;n_modules&#39;</span><span class="p">]</span>
                <span class="n">MROT</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;MROT&#39;</span><span class="p">]</span>
                <span class="n">MT</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;MT&#39;</span><span class="p">]</span>
                <span class="n">NFS</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;NFS&#39;</span><span class="p">]</span>
                <span class="n">UBT</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;UBT&#39;</span><span class="p">]</span>
                <span class="n">bunch_length</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;bunch_length&#39;</span><span class="p">]</span>
                <span class="n">DDR_SIG</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;DDR_SIG&#39;</span><span class="p">]</span>
                <span class="n">DDZ_SIG</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;DDZ_SIG&#39;</span><span class="p">]</span>
                <span class="n">parentDir</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;parentDir&#39;</span><span class="p">]</span>
                <span class="n">projectDir</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;projectDir&#39;</span><span class="p">]</span>
                <span class="n">progress_list</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;progress_list&#39;</span><span class="p">]</span>
                <span class="n">WG_M</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;WG_M&#39;</span><span class="p">]</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span>

                <span class="n">proc</span> <span class="o">=</span> <span class="n">solver_args</span><span class="p">[</span><span class="s1">&#39;proc&#39;</span><span class="p">]</span>
                <span class="n">sub_dir</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># the simulation runs at the quadrature points are saved to the key of the mean value run</span>
                <span class="n">no_error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_sims</span><span class="p">):</span>
                    <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                    <span class="n">p_init</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_true</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>

                    <span class="n">par_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_init</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">:])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">par_end</span> <span class="o">=</span> <span class="n">par_mid</span>

                    <span class="n">ok</span> <span class="o">=</span> <span class="n">perform_geometry_checks</span><span class="p">(</span><span class="n">par_mid</span><span class="p">,</span> <span class="n">par_end</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                        <span class="n">no_error</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>

                    <span class="n">fid</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_Q</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>

                    <span class="c1"># check if folder exists and skip if it does</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\ABCI\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\Cavity</span><span class="si">{</span><span class="n">fid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                        <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                        <span class="c1">#  run your model using SLANC or CST</span>
                        <span class="c1"># # create folders for all keys</span>
                        <span class="n">solver</span><span class="o">.</span><span class="n">createFolder</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="n">sub_dir</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">wi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MROT</span><span class="p">):</span>
                            <span class="n">solver</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">par_mid</span><span class="p">,</span> <span class="n">par_end</span><span class="p">,</span> <span class="n">par_end</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="n">fid</span><span class="p">,</span> <span class="n">MROT</span><span class="o">=</span><span class="n">wi</span><span class="p">,</span>
                                          <span class="n">DDR_SIG</span><span class="o">=</span><span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="n">DDZ_SIG</span><span class="p">,</span> <span class="n">beampipes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">bunch_length</span><span class="p">,</span>
                                          <span class="n">MT</span><span class="o">=</span><span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="n">UBT</span><span class="p">,</span>
                                          <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span> <span class="n">WG_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                          <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sub_dir</span><span class="o">=</span><span class="n">sub_dir</span>
                                          <span class="p">)</span>

                    <span class="c1"># get objective function values</span>
                    <span class="n">abci_folder</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\ABCI\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abci_folder</span><span class="p">):</span>
                        <span class="c1"># ic(abci_obj_list)</span>
                        <span class="n">obj_result</span> <span class="o">=</span> <span class="n">get_wakefield_objectives_value</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">abci_obj_list</span><span class="p">,</span> <span class="n">abci_folder</span><span class="p">)</span>
                        <span class="c1"># ic(obj_result)</span>

                        <span class="n">tab_val_f</span> <span class="o">=</span> <span class="n">obj_result</span>
                        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">obj_result</span><span class="p">:</span>
                            <span class="n">no_error</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">ic</span><span class="p">(</span><span class="n">obj_result</span><span class="p">)</span>
                            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;Encountered an error&quot;</span><span class="p">)</span>
                            <span class="k">break</span>
                        <span class="n">Ttab_val_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tab_val_f</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">no_error</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">no_error</span><span class="p">:</span>
                    <span class="n">v_expe_fobj</span><span class="p">,</span> <span class="n">v_stdDev_fobj</span> <span class="o">=</span> <span class="n">weighted_mean_obj</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">Ttab_val_f</span><span class="p">),</span> <span class="n">weights</span><span class="p">)</span>
                    <span class="c1"># append results to dict</span>
                    <span class="c1"># ic(v_expe_fobj, v_stdDev_fobj)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">abci_obj_list</span><span class="p">):</span>
                        <span class="n">result_dict_abci</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;expe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_expe_fobj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">result_dict_abci</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;stdDev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_stdDev_fobj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\ABCI\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">\uq.json&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_dict_abci</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="OptimizationControl.stroud"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.stroud">[docs]</a>    <span class="k">def</span> <span class="nf">stroud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c1"># Stroud-3 method</span>
        <span class="c1">#</span>
        <span class="c1"># Input parameters:</span>
        <span class="c1">#  p   number of dimensions</span>
        <span class="c1"># Output parameters:</span>
        <span class="c1">#  nodes   nodes of quadrature rule in [0,1]^p (column-wise)</span>
        <span class="c1">#</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">p</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span><span class="p">))):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r</span>
                <span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeff</span><span class="p">)</span>
                <span class="n">nodes</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">coeff</span><span class="p">)</span>

            <span class="k">if</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">p</span><span class="p">):</span>
                <span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># transform nodes from [-1,+1]^p to [0,1]^p</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">+</span> <span class="mf">0.5</span>

        <span class="k">return</span> <span class="n">nodes</span></div>

<div class="viewcode-block" id="OptimizationControl.quad_stroud3"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.quad_stroud3">[docs]</a>    <span class="k">def</span> <span class="nf">quad_stroud3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdim</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
        <span class="c1"># data for Stroud-3 quadrature in [0,1]^k</span>
        <span class="c1"># nodes and weights</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroud</span><span class="p">(</span><span class="n">rdim</span><span class="p">)</span>
        <span class="n">nodestr</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">nodes</span> <span class="o">-</span> <span class="mf">1.</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># evaluation of Legendre polynomials</span>
        <span class="n">bpoly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rdim</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rdim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rdim</span><span class="p">):</span>
                <span class="n">bpoly</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">bpoly</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodestr</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span>
                    <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nodestr</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bpoly</span><span class="p">[</span>
                        <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># standardisation of Legendre polynomials</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">bpoly</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bpoly</span></div>

<div class="viewcode-block" id="OptimizationControl.weighted_mean_obj"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.weighted_mean_obj">[docs]</a>    <span class="k">def</span> <span class="nf">weighted_mean_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_var</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
        <span class="n">rows_sims_no</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">tab_var</span><span class="p">)</span>
        <span class="n">no_weights</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># z funckji quadr_stroud wekt columnowy</span>

        <span class="k">if</span> <span class="n">rows_sims_no</span> <span class="o">==</span> <span class="n">no_weights</span><span class="p">:</span>
            <span class="n">expe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">outvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                <span class="n">expe</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tab_var</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
                <span class="n">outvar</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tab_var</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
            <span class="n">stdDev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">outvar</span> <span class="o">-</span> <span class="n">expe</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expe</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">stdDev</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ic</span><span class="p">(</span><span class="s1">&#39;Cols_sims_no != No_weights&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">expe</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="n">stdDev</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OptimizationControl.run_tune_parallel"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.run_tune_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">run_tune_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudo_shape_space</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">):</span>
        <span class="n">proc_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Processors_Count</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="c1"># split shape_space for different processes/ MPI share process by rank</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># check if number of processors selected is greater than the number of keys in the pseudo shape space</span>
        <span class="k">if</span> <span class="n">proc_count</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">proc_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

        <span class="n">shape_space_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">share</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">shape_space_len</span> <span class="o">/</span> <span class="n">proc_count</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proc_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span> <span class="o">+</span> <span class="n">share</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">overwriteFolder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copyFiles</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="p">)</span>

                <span class="n">processor_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pseudo_shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proc_keys_list</span><span class="p">:</span>
                        <span class="c1"># check if folder alsready exists</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\SLANS\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">\cavity_33.svl&#39;</span><span class="p">):</span>
                            <span class="n">processor_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                <span class="k">if</span> <span class="s1">&#39;End&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">():</span>
                    <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;End Cell&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cell_type</span> <span class="o">=</span> <span class="s1">&#39;Mid Cell&#39;</span>

                <span class="n">tune_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Tune_Variable</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">service</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_sequential</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">processor_shape_space</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub&quot;</span><span class="p">,</span>
                                           <span class="sa">r</span><span class="s2">&quot;D:\Dropbox\CavityDesignHub\Cavity800&quot;</span><span class="p">,</span> <span class="s2">&quot;EA.json&quot;</span><span class="p">,</span> <span class="s1">&#39;PyTuner&#39;</span><span class="p">,</span>
                                           <span class="n">tune_variable</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Linear Interpolation&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">cell_type</span><span class="p">,</span> <span class="p">[],</span>
                                           <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">))</span>
                <span class="n">service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="OptimizationControl.run_wakefield_parallel"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.run_wakefield_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">run_wakefield_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># get analysis parameters</span>
        <span class="n">n_cells</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="n">n_modules</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># change later</span>
        <span class="n">WG_M</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>  <span class="c1"># half length of beam pipe between cavities in module</span>

        <span class="c1"># change all of these later</span>
        <span class="n">MROT</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># run both longitudinal and transverse wakefield analysis</span>
        <span class="n">MT</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># number of time steps for a beam to move one cell to another default = 3</span>
        <span class="n">bunch_length</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="n">NFS</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># Number of samples in FFT (max 10000)</span>
        <span class="n">UBT</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Wakelength in m</span>
        <span class="n">DDZ_SIG</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">DDR_SIG</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">proc_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Processors_Count</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="c1"># marker = self.wakefieldUI.le_Marker.text()</span>

        <span class="c1"># get geometric parameters</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">]]</span>
        <span class="n">shape_space</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">rw</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span>

                <span class="n">A_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_A_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">B_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_B_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">a_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_a_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_b_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ri_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Ri_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">L_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_L_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Req_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Req_i_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">alpha_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">le_Alpha_opt</span><span class="o">.</span><span class="n">text</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">IC</span> <span class="o">=</span> <span class="p">[</span><span class="n">A_i</span><span class="p">,</span> <span class="n">B_i</span><span class="p">,</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span><span class="p">,</span> <span class="n">Ri_i</span><span class="p">,</span> <span class="n">L_i</span><span class="p">,</span> <span class="n">Req_i</span><span class="p">,</span> <span class="n">alpha_i</span><span class="p">]</span>

                <span class="n">shape_space</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">IC</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC_R&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape_space</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">,</span> <span class="s1">&#39;OC_R&#39;</span><span class="p">:</span> <span class="n">rw</span><span class="p">}</span>

        <span class="c1"># ic(shape_space)</span>

        <span class="c1"># shape_space = self.get_geometric_parameters(&#39;ABCI&#39;)</span>

        <span class="c1"># split shape_space for different processes/ MPI share process by rank</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">shape_space_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">share</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">shape_space_len</span> <span class="o">/</span> <span class="n">proc_count</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">proc_count</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proc_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span> <span class="o">+</span> <span class="n">share</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proc_keys_list</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">share</span><span class="p">:]</span>

                <span class="n">processor_shape_space</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">proc_keys_list</span><span class="p">:</span>
                        <span class="n">processor_shape_space</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

                <span class="n">service</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_sequential_wakefield</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">processor_shape_space</span><span class="p">,</span>
                                           <span class="n">MROT</span><span class="p">,</span> <span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="p">,</span> <span class="n">bunch_length</span><span class="p">,</span>
                                           <span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">parentDir</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">projectDir</span><span class="p">,</span> <span class="p">[],</span>
                                           <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                                           <span class="p">))</span>

                <span class="n">service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in run_MP for wakefield analysis:: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">shape_space</span></div>

<div class="viewcode-block" id="OptimizationControl.generate_first_men"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.generate_first_men">[docs]</a>    <span class="k">def</span> <span class="nf">generate_first_men</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># get range from table</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>

        <span class="c1"># populate</span>
        <span class="n">initial_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Initial_Points</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Uniform&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;G0_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_P&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)],</span>
                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;alpha_i&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;alpha_o&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)}</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Init_Generation_Method</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Random&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;G0_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_P&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)],</span>
                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                       <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                       <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                       <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                       <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                        <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                       <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">initial_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
                                         <span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;alpha_i&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">),</span>
                    <span class="s1">&#39;alpha_o&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)}</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">]</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_Sobol_Sequence_Index</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">l_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="o">.</span><span class="n">values</span><span class="p">()))[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">u_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="o">.</span><span class="n">values</span><span class="p">()))[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">const_var</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">l_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">u_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;it got here&quot;</span><span class="p">)</span>
                    <span class="n">const_var</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="k">del</span> <span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">l_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">l_bounds</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">u_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u_bounds</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="n">reduced_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">sampler</span> <span class="o">=</span> <span class="n">qmc</span><span class="o">.</span><span class="n">Sobol</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">reduced_dim</span><span class="p">,</span> <span class="n">scramble</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">random_base2</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">qmc</span><span class="o">.</span><span class="n">discrepancy</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
            <span class="n">ic</span><span class="p">(</span><span class="n">l_bounds</span><span class="p">,</span> <span class="n">u_bounds</span><span class="p">)</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">qmc</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">l_bounds</span><span class="p">,</span> <span class="n">u_bounds</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;G0_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_P&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)]</span>
            <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">const_var</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">df</span><span class="p">[</span><span class="n">const_var</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)</span><span class="o">*</span><span class="n">const_var</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;alpha_i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;alpha_o&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">initial_points</span><span class="p">)</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;sobol seq&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="OptimizationControl.get_objectives"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.get_objectives">[docs]</a>    <span class="k">def</span> <span class="nf">get_objectives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># objectives, weights, constraints, n, ng_max = [[&quot;min&quot;, &quot;Epk/Eacc&quot;], [&quot;min&quot;, &quot;Bpk/Eacc&quot;], [&quot;max&quot;, &quot;R/Q&quot;]], [5, 1, 1], \</span>
        <span class="c1">#                                               [&quot;Bpk/Eacc &lt; 6.5&quot;, &quot;freq &gt; 400.58&quot;, &#39;freq &lt; 400.99&#39;], 1, 4</span>
        <span class="n">obj_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj_vars</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj_var</span> <span class="o">==</span> <span class="s2">&quot;ZL&quot;</span> <span class="ow">or</span> <span class="n">obj_var</span> <span class="o">==</span> <span class="s2">&quot;ZT&quot;</span><span class="p">:</span>
                <span class="n">goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">freq_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_interval</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freq_ranges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">goal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_var</span><span class="si">}</span><span class="s2"> [max(</span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;f&lt;</span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)]&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">goal</span> <span class="o">==</span> <span class="s1">&#39;equal&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">goal</span><span class="p">,</span> <span class="n">obj_var</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">goal</span><span class="p">,</span> <span class="n">obj_var</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.get_constraints"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.get_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">get_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">const_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Constraints</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">const_vars</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">const_vars</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">const_var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">const_vars</span><span class="p">):</span>
                <span class="n">lower_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Constraints</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Constraints</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">upper_bound</span> <span class="o">!=</span> <span class="n">lower_bound</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">const_var</span><span class="si">}</span><span class="s1"> &gt; </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">const_var</span><span class="si">}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">const_var</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># parameter bounds as constraints</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tw</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">par</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">upper_bound</span> <span class="o">!=</span> <span class="n">lower_bound</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">par</span><span class="si">}</span><span class="s1"> &gt; </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">par</span><span class="si">}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">par</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">ic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.get_objectives_value"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.get_objectives_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_objectives_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">norm_length</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">):</span>
        <span class="n">Req</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CAVITY RADIUS&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># convert to mm</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;LENGTH&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># convert to mm</span>
        <span class="n">Freq</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">E_stored</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;STORED ENERGY&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Rsh</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;SHUNT IMPEDANCE&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MOhm</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;QUALITY FACTOR&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Epk</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM ELEC. FIELD&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
        <span class="n">Hpk</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM MAG. FIELD&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># A/m</span>
        <span class="c1"># Vacc = dict[&#39;ACCELERATION&#39;][n_cells - 1]</span>
        <span class="n">Eavg</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;AVERAGE E.FIELD ON AXIS&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
        <span class="n">r_Q</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;EFFECTIVE IMPEDANCE&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Ohm</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mf">0.00948</span><span class="o">*</span><span class="n">Q</span><span class="o">*</span><span class="p">(</span><span class="n">Freq</span><span class="o">/</span><span class="mi">1300</span><span class="p">)</span>
        <span class="n">GR_Q</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span>

        <span class="n">Vacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span> <span class="o">*</span> <span class="n">E_stored</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Freq</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># factor of 2, remember circuit and accelerator definition</span>
        <span class="c1"># Eacc = Vacc / (374 * 1e-3)  # factor of 2, remember circuit and accelerator definition</span>
        <span class="n">Eacc</span> <span class="o">=</span> <span class="n">Vacc</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">n_cells</span> <span class="o">*</span> <span class="n">norm_length</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># for 1 cell factor of 2, remember circuit and accelerator definition</span>
        <span class="n">Epk_Eacc</span> <span class="o">=</span> <span class="n">Epk</span> <span class="o">/</span> <span class="n">Eacc</span>
        <span class="n">Bpk_Eacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Hpk</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="n">Eacc</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Req&quot;</span><span class="p">:</span> <span class="n">Req</span><span class="p">,</span>
            <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="n">L</span><span class="p">,</span>
            <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">Freq</span><span class="p">,</span>
            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="n">Q</span><span class="p">,</span>
            <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="n">E_stored</span><span class="p">,</span>
            <span class="s2">&quot;R/Q&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span><span class="p">,</span>
            <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">:</span> <span class="n">Epk_Eacc</span><span class="p">,</span>
            <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">:</span> <span class="n">Bpk_Eacc</span><span class="p">,</span>
            <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="n">G</span><span class="p">,</span>
            <span class="s2">&quot;GR/Q&quot;</span><span class="p">:</span> <span class="n">GR_Q</span>
        <span class="p">}</span>

        <span class="n">objective</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># tune_result = []</span>

        <span class="c1"># # append freq and Req</span>
        <span class="c1"># if self.tuneUI.cb_Tune_Variable.currentText() == &quot;Req&quot;:</span>
        <span class="c1">#     tune_result.append(Req)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     tune_result.append(L)</span>
        <span class="c1">#</span>
        <span class="c1"># tune_result.append(Freq)</span>

        <span class="c1"># append objective functions</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">objective</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">objective</span> <span class="c1">#, tune_result</span></div>

<div class="viewcode-block" id="OptimizationControl.get_wakefield_objectives_value"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.get_wakefield_objectives_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_wakefield_objectives_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">abci_data_dir</span><span class="p">):</span>
        <span class="n">k_loss_array_transverse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">k_loss_array_longitudinal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">k_loss_M0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">key_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># create list to hold Z</span>
        <span class="n">Zmax_mon_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Zmax_dip_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xmax_mon_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xmax_dip_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">processed_keys_mon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">processed_keys_dip</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">calc_k_loss</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">abci_data_long</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">abci_data_trans</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># trans</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
                <span class="n">k_loss_trans</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Transverse&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">):</span>
                    <span class="n">print_</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered an exception: Check shape </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># long</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
                <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Loss Factor Spectrum Integrated up to F&#39;</span><span class="p">)</span>

                <span class="n">k_M0</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">y_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">k_loss_long</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abci_data_long</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">])</span>
                <span class="n">k_loss_HOM</span> <span class="o">=</span> <span class="n">k_loss_long</span> <span class="o">-</span> <span class="n">k_M0</span>

                <span class="c1"># append only after successful run</span>
                <span class="n">k_loss_M0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_M0</span><span class="p">)</span>
                <span class="n">k_loss_array_longitudinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_HOM</span><span class="p">)</span>
                <span class="n">k_loss_array_transverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">k_loss_M0</span><span class="p">,</span> <span class="n">k_loss_array_longitudinal</span><span class="p">,</span> <span class="n">k_loss_array_transverse</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_Zmax_L</span><span class="p">(</span><span class="n">mon_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="c1"># print(&quot;2a&quot;)</span>
            <span class="k">if</span> <span class="n">mon_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mon_interval</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">]</span>
            <span class="c1"># print(&quot;2b&quot;)</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># print(&quot;2c&quot;)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">abci_data_mon</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># get longitudinal and transverse impedance plot data</span>
                    <span class="n">xr_mon</span><span class="p">,</span> <span class="n">yr_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_mon</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
                    <span class="n">xi_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_mon</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Longitudinal Impedance&#39;</span><span class="p">)</span>

                    <span class="c1"># print(&quot;2d&quot;)</span>
                    <span class="c1"># Zmax</span>
                    <span class="k">if</span> <span class="n">mon_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mon_interval</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span>

                    <span class="c1"># calculate magnitude</span>
                    <span class="n">ymag_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">)]</span>

                    <span class="c1"># print(&quot;2e&quot;)</span>
                    <span class="c1"># get peaks</span>
                    <span class="n">peaks_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">xp_mon</span><span class="p">,</span> <span class="n">yp_mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">]</span>

                    <span class="c1"># print(&quot;2f&quot;, mon_interval)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">):</span>
                        <span class="c1"># get mask</span>
                        <span class="n">msk_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_mon</span><span class="p">]</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">Zmax_mon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span>

                            <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_mon</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;skipped, yp_mon = [], raise exception&quot;</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>

                    <span class="n">processed_keys_mon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;skipped, yp_mon = []&quot;</span><span class="p">)</span>
                    <span class="c1"># for i, z_bound in enumerate(mon_interval):</span>
                    <span class="c1">#     Zmax_mon_list[i].append(-1)</span>

            <span class="c1"># print(&quot;2g&quot;, Zmax_mon_list)</span>

            <span class="k">return</span> <span class="n">Zmax_mon_list</span>

        <span class="k">def</span> <span class="nf">get_Zmax_T</span><span class="p">(</span><span class="n">dip_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dip_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dip_interval</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">abci_data_dip</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">xr_dip</span><span class="p">,</span> <span class="n">yr_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_dip</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
                    <span class="n">xi_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_dip</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Transverse Impedance&#39;</span><span class="p">)</span>

                    <span class="c1"># Zmax</span>
                    <span class="k">if</span> <span class="n">dip_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dip_interval</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span>

                    <span class="c1"># calculate magnitude</span>
                    <span class="n">ymag_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">)]</span>

                    <span class="c1"># get peaks</span>
                    <span class="n">peaks_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">xp_dip</span><span class="p">,</span> <span class="n">yp_dip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dip_interval</span><span class="p">):</span>
                        <span class="c1"># get mask</span>
                        <span class="n">msk_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_dip</span><span class="p">]</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">Zmax_dip</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span>

                            <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_dip</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;skipped, yp_dip = [], raise exception&quot;</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>

                    <span class="n">processed_keys_dip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;skipped, yp_dip = []&quot;</span><span class="p">)</span>
                    <span class="c1"># for i, z_bound in enumerate(dip_interval):</span>
                    <span class="c1">#     Zmax_dip_list[i].append(-1)</span>

            <span class="k">return</span> <span class="n">Zmax_dip_list</span>

        <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">,</span> <span class="n">dip_interval</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">abci_data_long</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">abci_data_trans</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># get longitudinal and transverse impedance plot data</span>
                <span class="n">xr_mon</span><span class="p">,</span> <span class="n">yr_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
                <span class="n">xi_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Longitudinal Impedance&#39;</span><span class="p">)</span>

                <span class="n">xr_dip</span><span class="p">,</span> <span class="n">yr_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
                <span class="n">xi_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Transverse Impedance&#39;</span><span class="p">)</span>

                <span class="c1"># loss factors</span>
                <span class="c1"># trans</span>
                <span class="n">k_loss_trans</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Transverse&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">):</span>
                    <span class="n">print_</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered an exception: Check shape </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># long</span>
                <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Loss Factor Spectrum Integrated upto F&#39;</span><span class="p">)</span>

                <span class="n">k_M0</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">y_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">k_loss_long</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abci_data_long</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">])</span>
                <span class="n">k_loss_HOM</span> <span class="o">=</span> <span class="n">k_loss_long</span> <span class="o">-</span> <span class="n">k_M0</span>

                <span class="c1"># calculate magnitude</span>
                <span class="n">ymag_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">)]</span>
                <span class="n">ymag_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">)]</span>

                <span class="c1"># get peaks</span>
                <span class="n">peaks_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">xp_mon</span><span class="p">,</span> <span class="n">yp_mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">]</span>

                <span class="n">peaks_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">xp_dip</span><span class="p">,</span> <span class="n">yp_dip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">):</span>
                    <span class="c1"># get mask</span>
                    <span class="n">msk_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_mon</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Zmax_mon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span>
                        <span class="n">xmax_mon</span> <span class="o">=</span> <span class="n">xp_mon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">yp_mon</span> <span class="o">==</span> <span class="n">Zmax_mon</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

                        <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_mon</span><span class="p">)</span>
                        <span class="n">xmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmax_mon</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="n">xmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dip_interval</span><span class="p">):</span>
                    <span class="c1"># get mask</span>
                    <span class="n">msk_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_dip</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Zmax_dip</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span>
                        <span class="n">xmax_dip</span> <span class="o">=</span> <span class="n">xp_dip</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">yp_dip</span> <span class="o">==</span> <span class="n">Zmax_dip</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

                        <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_dip</span><span class="p">)</span>
                        <span class="n">xmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmax_dip</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="n">xmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>

                <span class="c1"># append only after successful run</span>

                <span class="n">k_loss_M0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_M0</span><span class="p">)</span>
                <span class="n">k_loss_array_longitudinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_HOM</span><span class="p">)</span>
                <span class="n">k_loss_array_transverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">ZL</span><span class="p">,</span> <span class="n">ZT</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">df_ZL</span><span class="p">,</span> <span class="n">df_ZT</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1"># print(&quot;here here here&quot;)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="c1"># print(&quot;print ptint pting&quot;)</span>
            <span class="k">if</span> <span class="s2">&quot;ZL&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="c1"># print(&quot;1&quot;)</span>
                <span class="n">freq_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_range</span><span class="p">)):</span>
                    <span class="n">Zmax_mon_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">xmax_mon_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">df_ZL</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2"> [max(</span><span class="si">{</span><span class="n">freq_range</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;f&lt;</span><span class="si">{</span><span class="n">freq_range</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">ZL</span> <span class="o">=</span> <span class="n">get_Zmax_L</span><span class="p">(</span><span class="n">freq_range</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;ZT&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">freq_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Objectives</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_range</span><span class="p">)):</span>
                    <span class="n">Zmax_dip_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">xmax_dip_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="n">df_ZT</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s2"> [max(</span><span class="si">{</span><span class="n">freq_range</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;f&lt;</span><span class="si">{</span><span class="n">freq_range</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">ZT</span> <span class="o">=</span> <span class="n">get_Zmax_T</span><span class="p">(</span><span class="n">freq_range</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;k_loss&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;k_kick&quot;</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># create dataframes from list</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZT</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">processed_keys_mon</span><span class="p">,</span> <span class="n">processed_keys_dip</span><span class="p">)</span>
        <span class="n">df_ZL</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">df_ZT</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZT</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df_ZL</span><span class="p">)</span>
        <span class="n">df_ZL</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_keys_mon</span>
        <span class="n">df_ZT</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_keys_dip</span>

        <span class="n">ic</span><span class="p">(</span><span class="n">df_ZL</span><span class="p">,</span> <span class="n">df_ZT</span><span class="p">)</span>
        <span class="n">processed_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">processed_keys_mon</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">processed_keys_dip</span><span class="p">))</span>

        <span class="c1"># ZL, ZT = np.array(ZL).T, np.array(ZT).T</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ZL</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ZT</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df_wake</span> <span class="o">=</span> <span class="n">df_ZL</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_ZT</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
            <span class="c1"># obj_result = np.hstack((ZL, ZT))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ZL</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">df_wake</span> <span class="o">=</span> <span class="n">df_ZL</span>
            <span class="c1"># obj_result = ZL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_wake</span> <span class="o">=</span> <span class="n">df_ZT</span>
            <span class="c1"># obj_result = ZT</span>

        <span class="k">return</span> <span class="n">df_wake</span><span class="p">,</span> <span class="n">processed_keys</span></div>

<div class="viewcode-block" id="OptimizationControl.crossover"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.crossover">[docs]</a>    <span class="k">def</span> <span class="nf">crossover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">generation</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>  <span class="c1"># , rq, grq</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">elites</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                    <span class="n">elites</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                    <span class="n">elites</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>
                    <span class="n">elites</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                    <span class="n">elites</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                    <span class="n">elites</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">elites</span><span class="p">)</span>
        <span class="n">obj_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                    <span class="n">obj_dict</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elites</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                    <span class="n">obj_dict</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elites</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj_dict</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elites</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;equal&#39;</span><span class="p">:</span>
                    <span class="n">obj_dict</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">elites</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># e, b, rq = obj_list</span>
        <span class="c1"># e = e.reset_index(drop=True)</span>
        <span class="c1"># b = b.reset_index(drop=True)</span>
        <span class="c1"># rq = rq.reset_index(drop=True)</span>

        <span class="c1"># naming convention G&lt;generation number&gt;_C&lt;cavity number&gt;_&lt;type&gt;</span>
        <span class="c1"># type refers to mutation M or crossover C</span>
        <span class="n">df_co</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">])</span>

        <span class="c1"># select only best characteristics</span>
        <span class="n">A_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">B_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">a_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">b_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">Ri_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">L_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="n">Req_inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>

        <span class="n">ic</span><span class="p">(</span><span class="n">elites</span><span class="p">)</span>
        <span class="n">inf_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="n">A_inf</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="n">B_inf</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a_inf</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b_inf</span><span class="p">,</span> <span class="s2">&quot;Ri&quot;</span><span class="p">:</span> <span class="n">Ri_inf</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="n">L_inf</span><span class="p">,</span> <span class="s2">&quot;Req&quot;</span><span class="p">:</span> <span class="n">Req_inf</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">influence</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">influence</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">influence</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;All&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                            <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                            <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                    <span class="n">inf_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ll</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inf_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;equal&#39;</span><span class="p">]</span>

        <span class="n">ic</span><span class="p">(</span><span class="n">elites</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">n_elites_to_cross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">sb_N_Elites_To_Cross</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">ic</span><span class="p">(</span><span class="n">n_elites_to_cross</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elites</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="c1"># (&lt;obj&gt;[&lt;rank&gt;][&lt;variable&gt;] -&gt; (b[c[1]][0]</span>

            <span class="n">df_co</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;G</span><span class="si">{</span><span class="n">generation</span><span class="si">}</span><span class="s2">_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_CO&quot;</span><span class="p">,</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]),</span>  <span class="c1"># A</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]),</span>  <span class="c1"># B</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]),</span>  <span class="c1"># a</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]),</span>  <span class="c1"># b</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;Ri&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;Ri&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;Ri&quot;</span><span class="p">]),</span>  <span class="c1"># Ri</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;L&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]),</span>  <span class="c1"># L</span>
                            <span class="nb">sum</span><span class="p">([</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_elites_to_cross</span> <span class="k">if</span> <span class="n">n_elites_to_cross</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="s2">&quot;Req&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;Req&quot;</span><span class="p">]])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">inf_dict</span><span class="p">[</span><span class="s2">&quot;Req&quot;</span><span class="p">]),</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="mi">0</span>
                            <span class="p">]</span>
        <span class="k">return</span> <span class="n">df_co</span></div>

<div class="viewcode-block" id="OptimizationControl.mutation"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.mutation">[docs]</a>    <span class="k">def</span> <span class="nf">mutation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="c1"># get range from table</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">tw</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">()]</span>

        <span class="c1"># get list based on mutation length</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">ic</span><span class="p">(</span><span class="s2">&quot;It is here&quot;</span><span class="p">)</span>
            <span class="n">ml</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ml</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">ic</span><span class="p">(</span><span class="n">ml</span><span class="p">)</span>
        <span class="n">df_ng_mut</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Req&#39;</span><span class="p">,</span> <span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;Ri&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Ri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;Ri&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Req&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;Req&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Req&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="s2">&quot;Req&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ml</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;alpha_i&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_o&quot;</span><span class="p">]]</span>

        <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_ng_mut</span><span class="p">)):</span>
            <span class="n">key1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;G</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_M&quot;</span><span class="p">)</span>

        <span class="n">df_ng_mut</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key1</span>

        <span class="k">return</span> <span class="n">df_ng_mut</span></div>

<div class="viewcode-block" id="OptimizationControl.chaos"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.chaos">[docs]</a>    <span class="k">def</span> <span class="nf">chaos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;G</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">_C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_CH&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="p">)],</span>
                <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbd</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;alpha_i&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
                <span class="s1">&#39;alpha_o&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">f</span><span class="p">)}</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="OptimizationControl.remove_duplicate_values"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.remove_duplicate_values">[docs]</a>    <span class="k">def</span> <span class="nf">remove_duplicate_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="OptimizationControl.proof_filename"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.proof_filename">[docs]</a>    <span class="k">def</span> <span class="nf">proof_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirc</span><span class="p">):</span>
        <span class="c1"># check if extension is included</span>
        <span class="k">if</span> <span class="n">dirc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="n">dirc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dirc</span><span class="si">}</span><span class="s1">.json&#39;</span>

        <span class="k">return</span> <span class="n">dirc</span></div>

<div class="viewcode-block" id="OptimizationControl.recursive_save"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.recursive_save">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">pareto_index</span><span class="p">):</span>
        <span class="n">styler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_pareto</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poc</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">styler</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="c1"># df.to_excel(filename)</span>
        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">_1.xlsx&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursive_save</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">pareto_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.populate_objectives"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.populate_objectives">[docs]</a>    <span class="k">def</span> <span class="nf">populate_objectives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ccb</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># and one row in the table</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

            <span class="n">cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;equal&#39;</span><span class="p">])</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

            <span class="c1"># check for impedance</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;ZL&quot;</span><span class="p">:</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;Enter interval(s) to evaluate max impedance&quot;</span><span class="p">)</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;1, 2, 5&quot;</span><span class="p">)</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">le</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;ZT&quot;</span><span class="p">:</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s2">&quot;Enter interval(s) to evaluate max impedance&quot;</span><span class="p">)</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0.7, 1.3, 2.25, 5&quot;</span><span class="p">)</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">le</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.populate_constraints"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.populate_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">populate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ccb</span><span class="p">,</span> <span class="n">tw</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># and one row in the table</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

            <span class="n">dsb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="n">dsb</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dsb</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10000000000</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dsb</span><span class="p">)</span>

            <span class="n">dsb2</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="n">dsb2</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dsb2</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10000000000</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dsb2</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.populate_parameters"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.populate_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">populate_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="s1">&#39;Ri&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">85</span><span class="p">],</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">93.5</span><span class="p">,</span> <span class="mf">93.5</span><span class="p">],</span>
              <span class="s1">&#39;Req&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">170</span><span class="p">,</span> <span class="mi">170</span><span class="p">],</span> <span class="p">}</span>
        <span class="c1"># dd = {&#39;A&#39;: [10, 60], &#39;B&#39;: [10, 60], &#39;a&#39;: [5, 40], &#39;b&#39;: [5, 40], &#39;Ri&#39;: [35, 35], &#39;L&#39;: [57.7, 57.7],</span>
        <span class="c1">#       &#39;Req&#39;: [103, 103], }</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">tw_Parameters</span>

        <span class="n">tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="p">))</span>  <span class="c1"># and one row in the table</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">influence_ccb</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

            <span class="n">dsb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="n">dsb</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dsb</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10000000000</span><span class="p">)</span>
            <span class="n">dsb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dsb</span><span class="p">)</span>

            <span class="n">dsb2</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="n">dsb2</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dsb2</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">10000000000</span><span class="p">)</span>
            <span class="n">dsb2</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dsb2</span><span class="p">)</span>

            <span class="n">ccb</span> <span class="o">=</span> <span class="n">QCheckableComboBox</span><span class="p">()</span>
            <span class="n">ccb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">influence_ccb</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccb</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ccb</span><span class="p">)</span>

            <span class="n">cb</span> <span class="o">=</span> <span class="n">QCheckableComboBox</span><span class="p">()</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;Yes&quot;</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="OptimizationControl.update_influence_ccb"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.update_influence_ccb">[docs]</a>    <span class="k">def</span> <span class="nf">update_influence_ccb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ccb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_ccb</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">ccb</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">ccb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>
            <span class="n">ccb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">ccb_Populate_Objectives</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="OptimizationControl.pareto_front"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.pareto_front">[docs]</a>    <span class="k">def</span> <span class="nf">pareto_front</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="c1"># datapoints = np.array([reverse_list(x), reverse_list(y), reverse_list(z)])</span>
        <span class="c1"># reverse list or not based on objective goal: minimize or maximize</span>
        <span class="c1"># datapoints = [self.negate_list(df.loc[:, o[1]], o[0]) for o in self.objectives]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;equal&#39;</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

            <span class="c1"># ic(obj)</span>
            <span class="n">datapoints</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datapoints</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">]]</span>

        <span class="c1"># ic(datapoints)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">datapoints</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datapoints</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] + 6*std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">datapoints</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">datapoints</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;equal&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_UQ</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">datapoints</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datapoints</span><span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;|E[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">] - </span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">| + std[</span><span class="si">{</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># ic(datapoints)</span>
        <span class="c1"># convert datapoints to numpy array</span>

        <span class="n">pareto</span> <span class="o">=</span> <span class="n">oapackage</span><span class="o">.</span><span class="n">ParetoDoubleLong</span><span class="p">()</span>
        <span class="c1"># ic(datapoints)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">datapoints</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">oapackage</span><span class="o">.</span><span class="n">doubleVector</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">datapoints</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">pareto</span><span class="o">.</span><span class="n">addvalue</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
        <span class="n">pareto</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Prints out the results from pareto</span>

        <span class="n">lst</span> <span class="o">=</span> <span class="n">pareto</span><span class="o">.</span><span class="n">allindices</span><span class="p">()</span>  <span class="c1"># the indices of the Pareto optimal designs</span>
        <span class="c1"># ic(lst)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="c1"># ic(self.poc)</span>
        <span class="n">reorder_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
        <span class="c1"># ic(reorder_idx)</span>
        <span class="c1"># ic(lst)</span>
        <span class="c1"># optimal_datapoints = df.loc[lst, :]</span>
        <span class="c1"># ic(optimal_datapoints)</span>
        <span class="c1"># ic([optimal_datapoints.loc[i, :] for i in range(len(lst))])</span>

        <span class="c1"># return [optimal_datapoints[i, :] for i in range(datapoints.shape[0])]</span>
        <span class="k">return</span> <span class="n">reorder_idx</span></div>

<div class="viewcode-block" id="OptimizationControl.check_input"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.check_input">[docs]</a>    <span class="k">def</span> <span class="nf">check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># s = &quot;range(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;randrange(16, 23, 10)&quot;</span>
        <span class="c1"># s = &quot;[16, 23, 10]&quot;</span>
        <span class="c1"># s = 1, 2, 3</span>
        <span class="c1"># s = 2</span>

        <span class="k">if</span> <span class="s2">&quot;r&quot;</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">and</span> <span class="s2">&quot;rr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;rr&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;rr&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ll</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">ll</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">ll</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check inputs.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="OptimizationControl.negate_list"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.negate_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">negate_list</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">l</span>  <span class="c1"># to find the pareto maxima</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>  <span class="c1"># to find the pareto minima</span></div>

<div class="viewcode-block" id="OptimizationControl.overwriteFolder"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.overwriteFolder">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">overwriteFolder</span><span class="p">(</span><span class="n">invar</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">invar</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">dir_util</span><span class="o">.</span><span class="n">_path_created</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.copyFiles"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.copyFiles">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copyFiles</span><span class="p">(</span><span class="n">invar</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parentDir</span><span class="si">}</span><span class="s2">\exe\SLANS_exe&quot;</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s2">\SimulationData\SLANS\Cavity_process_</span><span class="si">{</span><span class="n">invar</span><span class="si">}</span><span class="s2">\SLANS_exe&quot;</span>

        <span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.run_sequential"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.run_sequential">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">run_sequential</span><span class="p">(</span><span class="n">pseudo_shape_space_proc</span><span class="p">,</span> <span class="n">resume</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">tuner_option</span><span class="p">,</span>
                       <span class="n">tune_variable</span><span class="p">,</span> <span class="n">iter_set</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">,</span> <span class="n">progress_list</span><span class="p">,</span> <span class="n">convergence_list</span><span class="p">,</span> <span class="n">save_last</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">):</span>

        <span class="n">tuner</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">pseudo_shape_space_proc</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="n">resume</span><span class="p">,</span> <span class="n">proc</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                   <span class="n">tuner_option</span><span class="o">=</span><span class="n">tuner_option</span><span class="p">,</span> <span class="n">tune_variable</span><span class="o">=</span><span class="n">tune_variable</span><span class="p">,</span> <span class="n">iter_set</span><span class="o">=</span><span class="n">iter_set</span><span class="p">,</span>
                   <span class="n">cell_type</span><span class="o">=</span><span class="n">cell_type</span><span class="p">,</span> <span class="n">progress_list</span><span class="o">=</span><span class="n">progress_list</span><span class="p">,</span> <span class="n">convergence_list</span><span class="o">=</span><span class="n">convergence_list</span><span class="p">,</span>
                   <span class="n">save_last</span><span class="o">=</span><span class="n">save_last</span><span class="p">,</span> <span class="n">n_cell_last_run</span><span class="o">=</span><span class="n">n_cells</span><span class="p">)</span>  <span class="c1"># last_key=last_key This would have to be tested again #val2</span></div>

<div class="viewcode-block" id="OptimizationControl.text_to_list"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.text_to_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">text_to_list</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="OptimizationControl.process_interval"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.process_interval">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">process_interval</span><span class="p">(</span><span class="n">interval_list</span><span class="p">):</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">interval</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">interval_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interval_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">interval</span></div>

    <span class="c1"># def continue_check(self):</span>
    <span class="c1">#     path = f&#39;{self.main_control.projectDir}/Cavities/pseudo_{self.proof_filename(self.tuneUI.le_Generated_Shape_Space_Name.text())}&#39;</span>
    <span class="c1">#     print(path)</span>
    <span class="c1">#     if os.path.exists(path):</span>
    <span class="c1">#         msg = QMessageBox()</span>
    <span class="c1">#         msg.setWindowTitle(&quot;Resume Simulation&quot;)</span>
    <span class="c1">#         msg.setText(&quot;The pseudo shape space file already exist. Would you love to update or overwrite its content?&quot;)</span>
    <span class="c1">#         msg.setIcon(QMessageBox.Question)</span>
    <span class="c1">#         msg.setStandardButtons(QMessageBox.Yes | QMessageBox.No | QMessageBox.Cancel)</span>
    <span class="c1">#</span>
    <span class="c1">#         buttonY = msg.button(QMessageBox.Yes)</span>
    <span class="c1">#         buttonY.setText(&#39;Update&#39;)</span>
    <span class="c1">#         buttonN = msg.button(QMessageBox.No)</span>
    <span class="c1">#         buttonN.setText(&#39;Overwrite&#39;)</span>
    <span class="c1">#</span>
    <span class="c1">#         msg.setDefaultButton(buttonY)</span>
    <span class="c1">#</span>
    <span class="c1">#         msg.buttonClicked.connect(self.button_clicked)</span>
    <span class="c1">#</span>
    <span class="c1">#         x = msg.exec_()</span>
    <span class="c1">#</span>
    <span class="c1">#         if x == 16384:</span>
    <span class="c1">#             print(&quot;Done checking path. Yes selected.&quot;)</span>
    <span class="c1">#             return &quot;Yes&quot;</span>
    <span class="c1">#         elif x == 65536:</span>
    <span class="c1">#             print(&quot;Done checking path. No selected.&quot;)</span>
    <span class="c1">#             return &quot;No&quot;</span>
    <span class="c1">#         elif x == 4194304:</span>
    <span class="c1">#             print(&quot;Done checking path. Cancel selected.&quot;)</span>
    <span class="c1">#             return &quot;Cancel&quot;</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         print(&quot;Path does not yet exist. Creating...&quot;)</span>
    <span class="c1">#         return &quot;Yes&quot;</span>

<div class="viewcode-block" id="OptimizationControl.color_pareto"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.color_pareto">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">color_pareto</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">no_pareto_optimal</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="c1"># if row.isnull().values.any():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="n">no_pareto_optimal</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;background-color: #6bbcd1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># Save Styler Object for Later</span>
        <span class="n">styler</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span>
        <span class="c1"># Apply Styles (This can be chained or on separate lines)</span>
        <span class="n">styler</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Export the styler to excel</span>
        <span class="k">return</span> <span class="n">styler</span></div>

<div class="viewcode-block" id="OptimizationControl.show_hide_mid_cell_params"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.OptimizationControl.show_hide_mid_cell_params">[docs]</a>    <span class="k">def</span> <span class="nf">show_hide_mid_cell_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">cb_Cell_Type_Optimization</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;End-Mid Cell&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Mid_Cell_Opt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuneUI</span><span class="o">.</span><span class="n">w_Mid_Cell_Opt</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="run_sequential_wakefield"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.run_sequential_wakefield">[docs]</a><span class="k">def</span> <span class="nf">run_sequential_wakefield</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">processor_shape_space</span><span class="p">,</span>
                             <span class="n">MROT</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">MT</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                             <span class="n">DDR_SIG</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                             <span class="n">parentDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">WG_M</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># get length of processor</span>
    <span class="n">total_no_of_shapes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">processor_shape_space</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">processor_shape_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">projectDir</span><span class="si">}</span><span class="s1">\SimulationData\ABCI\Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
            <span class="c1"># run abci code</span>
            <span class="c1"># run both polarizations if MROT == 2</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">MROT</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">abci_geom</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC_R&#39;</span><span class="p">],</span>
                                         <span class="n">fid</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">MROT</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">MT</span><span class="o">=</span><span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="n">UBT</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">bunch_length</span><span class="p">,</span>
                                         <span class="n">DDR_SIG</span><span class="o">=</span><span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="n">DDZ_SIG</span><span class="p">,</span> <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span>
                                         <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span>
                                         <span class="n">WG_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">abci_geom</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC_R&#39;</span><span class="p">],</span>
                                     <span class="n">fid</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">MROT</span><span class="o">=</span><span class="n">MROT</span><span class="p">,</span> <span class="n">MT</span><span class="o">=</span><span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="n">UBT</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">bunch_length</span><span class="p">,</span>
                                     <span class="n">DDR_SIG</span><span class="o">=</span><span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="n">DDZ_SIG</span><span class="p">,</span> <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span>
                                     <span class="n">WG_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">MROT</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="n">abci_geom</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span>
                                         <span class="n">fid</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">MROT</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">MT</span><span class="o">=</span><span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="n">UBT</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">bunch_length</span><span class="p">,</span>
                                         <span class="n">DDR_SIG</span><span class="o">=</span><span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="n">DDZ_SIG</span><span class="p">,</span> <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span>
                                         <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span>
                                         <span class="n">WG_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">abci_geom</span><span class="o">.</span><span class="n">cavity</span><span class="p">(</span><span class="n">n_cells</span><span class="p">,</span> <span class="n">n_modules</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;IC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">],</span>
                                     <span class="n">fid</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">MROT</span><span class="o">=</span><span class="n">MROT</span><span class="p">,</span> <span class="n">MT</span><span class="o">=</span><span class="n">MT</span><span class="p">,</span> <span class="n">NFS</span><span class="o">=</span><span class="n">NFS</span><span class="p">,</span> <span class="n">UBT</span><span class="o">=</span><span class="n">UBT</span><span class="p">,</span> <span class="n">bunch_length</span><span class="o">=</span><span class="n">bunch_length</span><span class="p">,</span>
                                     <span class="n">DDR_SIG</span><span class="o">=</span><span class="n">DDR_SIG</span><span class="p">,</span> <span class="n">DDZ_SIG</span><span class="o">=</span><span class="n">DDZ_SIG</span><span class="p">,</span> <span class="n">parentDir</span><span class="o">=</span><span class="n">parentDir</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="n">projectDir</span><span class="p">,</span>
                                     <span class="n">WG_M</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">print_</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">. Time: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># update progress</span>
        <span class="n">progress_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">progress</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_no_of_shapes</span><span class="p">)</span></div>


<span class="c1"># def stroud(p):</span>
<span class="c1">#     # Stroud-3 method</span>
<span class="c1">#     #</span>
<span class="c1">#     # Input parameters:</span>
<span class="c1">#     #  p   number of dimensions</span>
<span class="c1">#     # Output parameters:</span>
<span class="c1">#     #  nodes   nodes of quadrature rule in [0,1]^p (column-wise)</span>
<span class="c1">#     #</span>
<span class="c1">#</span>
<span class="c1">#     nodes = np.zeros((p, 2 * p))</span>
<span class="c1">#     coeff = np.pi / p</span>
<span class="c1">#     fac = np.sqrt(2 / 3)</span>
<span class="c1">#</span>
<span class="c1">#     for i in range(2 * p):</span>
<span class="c1">#         for r in range(int(np.floor(0.5 * p))):</span>
<span class="c1">#             k = 2 * r</span>
<span class="c1">#             nodes[k, i] = fac * np.cos((k + 1) * (i + 1) * coeff)</span>
<span class="c1">#             nodes[k + 1, i] = fac * np.sin((k + 1) * (i + 1) * coeff)</span>
<span class="c1">#</span>
<span class="c1">#         if 0.5 * p != np.floor(0.5 * p):</span>
<span class="c1">#             nodes[-1, i] = ((-1) ** (i + 1)) / np.sqrt(3)</span>
<span class="c1">#</span>
<span class="c1">#     # transform nodes from [-1,+1]^p to [0,1]^p</span>
<span class="c1">#     nodes = 0.5 * nodes + 0.5</span>
<span class="c1">#</span>
<span class="c1">#     return nodes</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># def quad_stroud3(rdim, degree):</span>
<span class="c1">#     # data for Stroud-3 quadrature in [0,1]^k</span>
<span class="c1">#     # nodes and weights</span>
<span class="c1">#     nodes = stroud(rdim)</span>
<span class="c1">#     nodestr = 2. * nodes - 1.</span>
<span class="c1">#     weights = (1 / (2 * rdim)) * np.ones((2 * rdim, 1))</span>
<span class="c1">#</span>
<span class="c1">#     # evaluation of Legendre polynomials</span>
<span class="c1">#     bpoly = np.zeros((degree + 1, rdim, 2 * rdim))</span>
<span class="c1">#     for l in range(rdim):</span>
<span class="c1">#         for j in range(2 * rdim):</span>
<span class="c1">#             bpoly[0, l, j] = 1</span>
<span class="c1">#             bpoly[1, l, j] = nodestr[l, j]</span>
<span class="c1">#             for i in range(1, degree):</span>
<span class="c1">#                 bpoly[i + 1, l, j] = ((2 * (i + 1) - 1) * nodestr[l, j] * bpoly[i, l, j] - i * bpoly[</span>
<span class="c1">#                     i - 1, l, j]) / (i + 1)</span>
<span class="c1">#</span>
<span class="c1">#     # standardisation of Legendre polynomials</span>
<span class="c1">#     for i in range(1, degree + 1):</span>
<span class="c1">#         bpoly[i, :, :] = bpoly[i, :, :] * np.sqrt(2 * (i + 1) - 1)</span>
<span class="c1">#</span>
<span class="c1">#     return nodes, weights, bpoly</span>


<span class="c1"># def weighted_mean_obj(tab_var, weights):</span>
<span class="c1">#         rows_sims_no, cols = np.shape(tab_var)</span>
<span class="c1">#         no_weights, dummy = np.shape(weights)  # z funckji quadr_stroud wekt columnowy</span>
<span class="c1">#</span>
<span class="c1">#         if rows_sims_no == no_weights:</span>
<span class="c1">#             expe = np.zeros((cols, 1))</span>
<span class="c1">#             outvar = np.zeros((cols, 1))</span>
<span class="c1">#             for i in range(cols):</span>
<span class="c1">#                 expe[i, 0] = np.dot(tab_var[:, i], weights)</span>
<span class="c1">#                 outvar[i, 0] = np.dot(tab_var[:, i]**2, weights)</span>
<span class="c1">#             stdDev = np.sqrt(abs(outvar - expe**2))</span>
<span class="c1">#         else:</span>
<span class="c1">#             expe = 0</span>
<span class="c1">#             stdDev = 0</span>
<span class="c1">#             ic(&#39;Cols_sims_no != No_weights&#39;)</span>
<span class="c1">#</span>
<span class="c1">#         return list(expe.T[0]), list(stdDev.T[0])</span>


<div class="viewcode-block" id="get_objectives_value"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.get_objectives_value">[docs]</a><span class="k">def</span> <span class="nf">get_objectives_value</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">norm_length</span><span class="p">,</span> <span class="n">n_cells</span><span class="p">):</span>
    <span class="n">Req</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CAVITY RADIUS&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># convert to mm</span>
    <span class="n">Freq</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">E_stored</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;STORED ENERGY&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Rsh</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;SHUNT IMPEDANCE&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MOhm</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;QUALITY FACTOR&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Epk</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM ELEC. FIELD&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
    <span class="n">Hpk</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;MAXIMUM MAG. FIELD&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># A/m</span>
    <span class="c1"># Vacc = dict[&#39;ACCELERATION&#39;][n_cells - 1]</span>
    <span class="n">Eavg</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;AVERAGE E.FIELD ON AXIS&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># MV/m</span>
    <span class="n">r_Q</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;EFFECTIVE IMPEDANCE&#39;</span><span class="p">][</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Ohm</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mf">0.00948</span><span class="o">*</span><span class="n">Q</span><span class="o">*</span><span class="p">(</span><span class="n">Freq</span><span class="o">/</span><span class="mi">1300</span><span class="p">)</span>
    <span class="n">GR_Q</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span>

    <span class="n">Vacc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span> <span class="o">*</span> <span class="n">E_stored</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Freq</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># factor of 2, remember circuit and accelerator definition</span>
    <span class="c1"># Eacc = Vacc / (374 * 1e-3)  # factor of 2, remember circuit and accelerator definition</span>
    <span class="n">Eacc</span> <span class="o">=</span> <span class="n">Vacc</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_cells</span><span class="o">*</span><span class="n">norm_length</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># for 1 cell factor of 2, remember circuit and accelerator definition</span>
    <span class="n">Epk_Eacc</span> <span class="o">=</span> <span class="n">Epk</span> <span class="o">/</span> <span class="n">Eacc</span>
    <span class="n">Bpk_Eacc</span> <span class="o">=</span> <span class="p">(</span><span class="n">Hpk</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="n">Eacc</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Req&quot;</span><span class="p">:</span> <span class="n">Req</span><span class="p">,</span>
        <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">Freq</span><span class="p">,</span>
        <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="n">Q</span><span class="p">,</span>
        <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="n">E_stored</span><span class="p">,</span>
        <span class="s2">&quot;R/Q&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r_Q</span><span class="p">,</span>
        <span class="s2">&quot;Epk/Eacc&quot;</span><span class="p">:</span> <span class="n">Epk_Eacc</span><span class="p">,</span>
        <span class="s2">&quot;Bpk/Eacc&quot;</span><span class="p">:</span> <span class="n">Bpk_Eacc</span><span class="p">,</span>
        <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="n">G</span><span class="p">,</span>
        <span class="s2">&quot;GR/Q&quot;</span><span class="p">:</span> <span class="n">GR_Q</span>
    <span class="p">}</span>

    <span class="n">objective</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># append freq and Req</span>
    <span class="n">tune_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">Req</span><span class="p">,</span> <span class="n">Freq</span><span class="p">]</span>


    <span class="c1"># append objective functions</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">objective</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">objective</span><span class="p">,</span> <span class="n">tune_result</span></div>


<div class="viewcode-block" id="get_wakefield_objectives_value"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.get_wakefield_objectives_value">[docs]</a><span class="k">def</span> <span class="nf">get_wakefield_objectives_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">abci_data_dir</span><span class="p">):</span>
    <span class="n">k_loss_transverse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k_loss_longitudinal</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k_loss_M0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">key_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># create list to hold Z</span>
    <span class="n">Zmax_mon_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Zmax_dip_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xmax_mon_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xmax_dip_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">processed_keys</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">calc_k_loss</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">abci_data_long</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">abci_data_trans</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># trans</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
        <span class="n">k_loss_trans</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Transverse&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">):</span>
            <span class="n">print_</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered an exception: Check shape </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># long</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
        <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Loss Factor Spectrum Integrated up to F&#39;</span><span class="p">)</span>

        <span class="n">k_M0</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">y_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k_loss_long</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abci_data_long</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">])</span>
        <span class="n">k_loss_HOM</span> <span class="o">=</span> <span class="n">k_loss_long</span> <span class="o">-</span> <span class="n">k_M0</span>

        <span class="c1"># append only after successful run</span>
        <span class="n">k_loss_M0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_M0</span><span class="p">)</span>
        <span class="n">k_loss_longitudinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_HOM</span><span class="p">)</span>
        <span class="n">k_loss_transverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">k_loss_M0</span><span class="p">,</span> <span class="n">k_loss_longitudinal</span><span class="p">,</span> <span class="n">k_loss_transverse</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_Zmax_L</span><span class="p">(</span><span class="n">mon_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># print(&quot;2a&quot;)</span>
        <span class="k">if</span> <span class="n">mon_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mon_interval</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">abci_data_mon</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># get longitudinal and transverse impedance plot data</span>
            <span class="n">xr_mon</span><span class="p">,</span> <span class="n">yr_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_mon</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
            <span class="n">xi_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_mon</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Longitudinal Impedance&#39;</span><span class="p">)</span>

            <span class="c1"># print(&quot;2d&quot;)</span>
            <span class="c1"># Zmax</span>
            <span class="k">if</span> <span class="n">mon_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mon_interval</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span>

            <span class="c1"># calculate magnitude</span>
            <span class="n">ymag_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">)]</span>

            <span class="c1"># print(&quot;2e&quot;)</span>
            <span class="c1"># get peaks</span>
            <span class="n">peaks_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">xp_mon</span><span class="p">,</span> <span class="n">yp_mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">]</span>

            <span class="c1"># print(&quot;2f&quot;, mon_interval)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">):</span>
                <span class="c1"># get mask</span>
                <span class="n">msk_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_mon</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Zmax_mon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span>

                    <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_mon</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>

            <span class="n">processed_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>

        <span class="c1"># print(&quot;2g&quot;, Zmax_mon_list)</span>

        <span class="k">return</span> <span class="n">Zmax_mon_list</span>

    <span class="k">def</span> <span class="nf">get_Zmax_T</span><span class="p">(</span><span class="n">dip_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dip_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dip_interval</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2e10</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">abci_data_dip</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">xr_dip</span><span class="p">,</span> <span class="n">yr_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_dip</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
            <span class="n">xi_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_dip</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Transverse Impedance&#39;</span><span class="p">)</span>

            <span class="c1"># Zmax</span>
            <span class="k">if</span> <span class="n">dip_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dip_interval</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span>

            <span class="c1"># calculate magnitude</span>
            <span class="n">ymag_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">)]</span>

            <span class="c1"># get peaks</span>
            <span class="n">peaks_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">xp_dip</span><span class="p">,</span> <span class="n">yp_dip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dip_interval</span><span class="p">):</span>
                <span class="c1"># get mask</span>
                <span class="n">msk_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_dip</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Zmax_dip</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span>

                    <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_dip</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>

            <span class="n">processed_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Zmax_dip_list</span>

    <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">,</span> <span class="n">dip_interval</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing for Cavity </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">abci_data_long</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">abci_data_trans</span> <span class="o">=</span> <span class="n">ABCIData</span><span class="p">(</span><span class="n">abci_data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cavity</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># get longitudinal and transverse impedance plot data</span>
        <span class="n">xr_mon</span><span class="p">,</span> <span class="n">yr_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Longitudinal Impedance&#39;</span><span class="p">)</span>
        <span class="n">xi_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Longitudinal Impedance&#39;</span><span class="p">)</span>

        <span class="n">xr_dip</span><span class="p">,</span> <span class="n">yr_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Real Part of Transverse Impedance&#39;</span><span class="p">)</span>
        <span class="n">xi_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of Transverse Impedance&#39;</span><span class="p">)</span>

        <span class="c1"># loss factors</span>
        <span class="c1"># trans</span>
        <span class="n">k_loss_trans</span> <span class="o">=</span> <span class="n">abci_data_trans</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Transverse&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">):</span>
            <span class="n">print_</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered an exception: Check shape </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># long</span>
        <span class="n">abci_data_long</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;Loss Factor Spectrum Integrated upto F&#39;</span><span class="p">)</span>

        <span class="n">k_M0</span> <span class="o">=</span> <span class="n">abci_data_long</span><span class="o">.</span><span class="n">y_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">k_loss_long</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abci_data_long</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">[</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">])</span>
        <span class="n">k_loss_HOM</span> <span class="o">=</span> <span class="n">k_loss_long</span> <span class="o">-</span> <span class="n">k_M0</span>

        <span class="c1"># calculate magnitude</span>
        <span class="n">ymag_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_mon</span><span class="p">,</span> <span class="n">yi_mon</span><span class="p">)]</span>
        <span class="n">ymag_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">yr_dip</span><span class="p">,</span> <span class="n">yi_dip</span><span class="p">)]</span>

        <span class="c1"># get peaks</span>
        <span class="n">peaks_mon</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">xp_mon</span><span class="p">,</span> <span class="n">yp_mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_mon</span><span class="p">)[</span><span class="n">peaks_mon</span><span class="p">]</span>

        <span class="n">peaks_dip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">xp_dip</span><span class="p">,</span> <span class="n">yp_dip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xr_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymag_dip</span><span class="p">)[</span><span class="n">peaks_dip</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mon_interval</span><span class="p">):</span>
            <span class="c1"># get mask</span>
            <span class="n">msk_mon</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_mon</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Zmax_mon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">[</span><span class="n">msk_mon</span><span class="p">])</span>
                <span class="n">xmax_mon</span> <span class="o">=</span> <span class="n">xp_mon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">yp_mon</span> <span class="o">==</span> <span class="n">Zmax_mon</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_mon</span><span class="p">)</span>
                <span class="n">xmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmax_mon</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_mon</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Zmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">xmax_mon_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dip_interval</span><span class="p">):</span>
            <span class="c1"># get mask</span>
            <span class="n">msk_dip</span> <span class="o">=</span> <span class="p">[(</span><span class="n">z_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xp_dip</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Zmax_dip</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">[</span><span class="n">msk_dip</span><span class="p">])</span>
                <span class="n">xmax_dip</span> <span class="o">=</span> <span class="n">xp_dip</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">yp_dip</span> <span class="o">==</span> <span class="n">Zmax_dip</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zmax_dip</span><span class="p">)</span>
                <span class="n">xmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmax_dip</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yp_dip</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Zmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">xmax_dip_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="c1"># append only after successful run</span>

        <span class="n">k_loss_M0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_M0</span><span class="p">)</span>
        <span class="n">k_loss_longitudinal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_HOM</span><span class="p">)</span>
        <span class="n">k_loss_transverse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_loss_trans</span><span class="p">)</span>

    <span class="n">ZL</span><span class="p">,</span> <span class="n">ZT</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">freq_range_ZL</span><span class="p">,</span> <span class="n">freq_range_ZT</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1"># print(&quot;here here here&quot;)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="c1"># print(&quot;print ptint pting&quot;)</span>
        <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ZL&#39;</span><span class="p">:</span>
            <span class="n">freq_range_ZL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ZT&#39;</span><span class="p">:</span>
            <span class="n">freq_range_ZT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;k_loss&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;k_kick&quot;</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># ic(&quot;about to evaluate ZL&quot;, freq_range_ZL)</span>
    <span class="k">if</span> <span class="n">freq_range_ZL</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_range_ZL</span><span class="p">)):</span>
            <span class="n">Zmax_mon_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">xmax_mon_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="n">ZL</span> <span class="o">=</span> <span class="n">get_Zmax_L</span><span class="p">(</span><span class="n">freq_range_ZL</span><span class="p">)</span>

    <span class="c1"># ic(&quot;about to evaluate ZT&quot;, freq_range_ZT)</span>
    <span class="k">if</span> <span class="n">freq_range_ZT</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq_range_ZT</span><span class="p">)):</span>
            <span class="n">Zmax_dip_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">xmax_dip_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="n">ZT</span> <span class="o">=</span> <span class="n">get_Zmax_T</span><span class="p">(</span><span class="n">freq_range_ZT</span><span class="p">)</span>

    <span class="c1"># ic(&quot;Donbr rvasluating impedances&quot;)</span>
    <span class="n">ZL</span><span class="p">,</span> <span class="n">ZT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ZT</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># ic(ZL, ZT)</span>

    <span class="k">if</span> <span class="n">ZL</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ZT</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">obj_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ZL</span><span class="p">,</span> <span class="n">ZT</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">ZL</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">obj_result</span> <span class="o">=</span> <span class="n">ZL</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj_result</span> <span class="o">=</span> <span class="n">ZT</span>

    <span class="c1"># ic(obj_result)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="process_interval"><a class="viewcode-back" href="../../frame_controls.html#frame_controls.tune_control.process_interval">[docs]</a><span class="k">def</span> <span class="nf">process_interval</span><span class="p">(</span><span class="n">interval_list</span><span class="p">):</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">interval</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">interval_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interval_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">interval</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Sosoho-abasi Udongwo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>